##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.31A/W32 EVALUATION    07/Jan/2016  21:50:30 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\EKF\Filter.c                                #
#    Command line    =  H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\EKF\Filter.c -lC                            #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Lis #
#                       t\ -o H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6- #
#                       27ËøÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»® #
#                       +LQR_2014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Deb #
#                       ug\Obj\ -z9 --debug --cpu_mode thumb --endian        #
#                       little --cpu ARM7TDMI --stack_align 4 --interwork    #
#                       -e --fpu None --ec++ --dlib_config                   #
#                       D:\IAREWE431\ARM\LIB\dl4tptinl8n.h -I                #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\srcIAR\ -I      #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\src\ -I      #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\ -I       #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\kalman\   #
#                       -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27Ë #
#                       øÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\pcm\   #
#                       -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27Ë #
#                       øÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\spi\   #
#                       -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27Ë #
#                       øÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\timer\ #
#                        -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27 #
#                       ËøÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+L #
#                       QR_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\pid\  #
#                       -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27Ë #
#                       øÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\avcs\  #
#                       -I D:\IAREWE431\ARM\INC\                             #
#    List file       =  H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Lis #
#                       t\Filter.lst                                         #
#    Object file     =  H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Obj #
#                       \Filter.r79                                          #
#                                                                            #
#                                                                            #
##############################################################################

H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2014_7_31\EKF\Filter.c
      1          /****************************************************************
      2           *ÎÄ ¼þ Ãû: Filter.c
      3           *Ãè    Êö:
      4           *          À©Õ¹KalmanÂË²¨ÊµÏÖ
      5           *          ÎÄ¼þ×¢ÊÍÖÐ¹«Ê½±êºÅÈ«²¿ÎªÕÅÇ«ÂÛÎÄÖÐµÄ¹«Ê½±êºÅ
      6           *
      7           *×÷    Õß£ºÉêÎÄ±ó
      8           *µ±Ç°°æ±¾: 1.0
      9           *Íê³ÉÈÕÆÚ: 2011-3-22
     10           *
     11           *È¡´ú°æ±¾£º
     12           *Ô­ ×÷ Õß£º
     13           *Íê³ÉÈÕÆÚ£º
     14           *
     15           *°æÈ¨ËùÓÐ£º
     16           ****************************************************************/
     17          #include<includs.h>

   \                                 In segment DATA_Z, align 4, align-sorted
     18          double K_Quat[4];//={0.0,0.0,0.0,0.0};
   \                     K_Quat:
   \   00000000                      DS8 32

   \                                 In segment DATA_Z, align 4, align-sorted
     19          double ahrs_theta[3];
   \                     ahrs_theta:
   \   00000000                      DS8 24

   \                                 In segment DATA_Z, align 4, align-sorted
     20          double raw_K_Quat[4];
     21          double raw_ahrs_theta[3];
     22          double accel_g = 0.0;
     23          double est_Kalman_State[11];
     24          double raw_input_uvw[3];
     25          double Cnb[3][3];
     26          double Cbn[3][3];
   \                     Cbn:
   \   00000000                      DS8 72
   \                     accel_g:
   \   00000048                      DS8 8
   \                     raw_K_Quat:
   \   00000050                      DS8 32
   \                     raw_ahrs_theta:
   \   00000070                      DS8 24

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     est_Kalman_State:
   \   00000000                      DS8 88

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     raw_input_uvw:
   \   00000000                      DS8 24

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     Cnb:
   \   00000000                      DS8 72
     27          #define offset_p 0.24

   \                                 In segment DATA_Z, align 4, align-sorted
     28          double offset_x=0.0;
   \                     offset_x:
   \   00000000                      DS8 8

   \                                 In segment DATA_Z, align 4, align-sorted
     29          double offset_y=0.0;
   \                     offset_y:
   \   00000000                      DS8 8

   \                                 In segment DATA_Z, align 4, align-sorted
     30          double Z_K_Quat[4];
   \                     Z_K_Quat:
   \   00000000                      DS8 32
     31          
     32          /*--------------------------------------------------------------------------------------*/ 

   \                                 In segment CODE, align 4, keep-with-next
     33          void ahrs_init(void)
     34          {
   \                     ??ahrs_init:
   \   00000000   10B5               PUSH        {R4,LR}
     35          	accel2euler( raw_ahrs_theta, imu_accel, ahrs_compass );
   \   00000002   ....               LDR         R4,??DataTable2    ;; Cbn
   \   00000004   ....               LDR         R2,??DataTable3    ;; ahrs_compass
   \   00000006   0949               LDR         R1,??ahrs_init_1   ;; imu_accel
   \   00000008   201C               MOV         R0,R4
   \   0000000A   7030               ADD         R0,#+112
   \   0000000C   ........           _BLF        ??accel2euler,??accel2euler??rT
     36                  
     37          	euler2quat( raw_K_Quat, raw_ahrs_theta );
   \   00000010   211C               MOV         R1,R4
   \   00000012   7031               ADD         R1,#+112
   \   00000014   201C               MOV         R0,R4
   \   00000016   5030               ADD         R0,#+80
   \   00000018   ........           _BLF        ??euler2quat,??euler2quat??rT
     38          	
     39          	norm( raw_K_Quat );
   \   0000001C   5034               ADD         R4,#+80
   \   0000001E   201C               MOV         R0,R4
   \   00000020   ........           _BLF        ??norm,??norm??rT
     40          	
     41          	//printf("INIT_q0=%f\tq1=%f\tq2=%f\tq3=%f\n",quat[0],quat[1],quat[2],quat[3] );
     42          	//bias[0] = ahrs_pqr[0];
     43          	//bias[1] = ahrs_pqr[1];
     44          	//bias[2] = ahrs_pqr[2];
     45          }
   \   00000024   10BC               POP         {R4}
   \   00000026   01BC               POP         {R0}
   \   00000028   0047               BX          R0                 ;; return
   \   0000002A   C046               NOP         
   \                     ??ahrs_init_1:
   \   0000002C   ........           DC32        imu_accel

   \                                 In segment CODE, align 4, keep-with-next
     46          void state_init(void)
     47          {
   \                     ??state_init:
   \   00000000   F0B5               PUSH        {R4-R7,LR}
     48                accel_g=sqrt(ahrs_accel[0]*ahrs_accel[0] + ahrs_accel[1]*ahrs_accel[1] + ahrs_accel[2]*ahrs_accel[2]);      
   \   00000002   1B4C               LDR         R4,??state_init_1  ;; ahrs_accel
   \   00000004   201C               MOV         R0,R4
   \   00000006   1030               ADD         R0,#+16
   \   00000008   03C8               LDMIA       R0!,{R0,R1}
   \   0000000A   ....               LDR         R5,??DataTable2    ;; Cbn
   \   0000000C   021C               MOV         R2,R0
   \   0000000E   0B1C               MOV         R3,R1
   \   00000010   ........           _BLF        __dMul,??__dMul??rT
   \   00000014   03B4               PUSH        {R0,R1}
   \   00000016   201C               MOV         R0,R4
   \   00000018   0830               ADD         R0,#+8
   \   0000001A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000001C   201C               MOV         R0,R4
   \   0000001E   0830               ADD         R0,#+8
   \   00000020   03C8               LDMIA       R0!,{R0,R1}
   \   00000022   ........           _BLF        __dMul,??__dMul??rT
   \   00000026   061C               MOV         R6,R0
   \   00000028   0F1C               MOV         R7,R1
   \   0000002A   0CCC               LDMIA       R4!,{R2,R3}
   \   0000002C   083C               SUB         R4,#+8
   \   0000002E   03CC               LDMIA       R4!,{R0,R1}
   \   00000030   083C               SUB         R4,#+8
   \   00000032   ........           _BLF        __dMul,??__dMul??rT
   \   00000036   321C               MOV         R2,R6
   \   00000038   3B1C               MOV         R3,R7
   \   0000003A   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000003E   0CBC               POP         {R2,R3}
   \   00000040   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000044   ........           _BLF        sqrt,??sqrt??rT
   \   00000048   A864               STR         R0,[R5, #+72]
   \   0000004A   E964               STR         R1,[R5, #+76]
     49                accel2euler( raw_ahrs_theta, ahrs_accel, ahrs_compass );      
   \   0000004C   ....               LDR         R2,??DataTable3    ;; ahrs_compass
   \   0000004E   211C               MOV         R1,R4
   \   00000050   281C               MOV         R0,R5
   \   00000052   7030               ADD         R0,#+112
   \   00000054   ........           _BLF        ??accel2euler,??accel2euler??rT
     50                euler2quat( raw_K_Quat, raw_ahrs_theta );
   \   00000058   291C               MOV         R1,R5
   \   0000005A   7031               ADD         R1,#+112
   \   0000005C   281C               MOV         R0,R5
   \   0000005E   5030               ADD         R0,#+80
   \   00000060   ........           _BLF        ??euler2quat,??euler2quat??rT
     51                norm( raw_K_Quat );
   \   00000064   5035               ADD         R5,#+80
   \   00000066   281C               MOV         R0,R5
   \   00000068   ........           _BLF        ??norm,??norm??rT
     52          }
   \   0000006C   ....               B           ?Subroutine18
   \   0000006E   C046               NOP         
   \                     ??state_init_1:
   \   00000070   ........           DC32        ahrs_accel

   \                                 In segment CODE, align 4, keep-with-next
   \                     ?Subroutine18:
   \   00000000   F0BC               POP         {R4-R7}
   \   00000002   01BC               POP         {R0}
   \   00000004   0047               BX          R0                 ;; return
     53          /*double uvw2_update()
     54          {
     55              static double last_Z = 0.0; 
     56              double vel_z_current =0.0 ; 
     57              float sum_vel_z =0.0; 
     58              static float window_vel_z[8] = {0.0} ;  // zÏòËÙ¶ÈÆ½¾ùÖµÂË²¨
     59              double uvw;
     60              static int UVW2_LEN=1;
     61              
     62              vel_z_current = (position.raw_current_xyz[2] - last_Z)*30;
     63              for( char i =UVW2_LEN-1 ; i != 0 ; --i )
     64              {
     65                  window_vel_z[i] = window_vel_z[i-1];
     66                  sum_vel_z += window_vel_z[i];
     67              }
     68              window_vel_z[0] = vel_z_current ;
     69              sum_vel_z += window_vel_z[0] ;
     70              uvw = sum_vel_z/UVW2_LEN ;
     71          	
     72              if(UVW2_LEN >= 8)
     73                   UVW2_LEN = 8;
     74                else UVW2_LEN++;
     75           
     76              last_Z = position.raw_current_xyz[2];
     77               
     78              return uvw;   
     79          }*/

   \                                 In segment CODE, align 4, keep-with-next
     80          double uvw2_update(double raw_uvw)
     81          {
   \                     ??uvw2_update:
   \   00000000   F3B5               PUSH        {R0,R1,R4-R7,LR}
   \   00000002   82B0               SUB         SP,#+8
     82             double vel_z_current =0.0 ; 
     83             float sum_vel_z =0.0; 
   \   00000004   0026               MOV         R6,#+0
     84             static float window_vel_z[3] = {0.0} ;  // zÏòËÙ¶ÈÆ½¾ùÖµÂË²¨
     85             static int UVW2_LEN=1;
     86          
     87              for( char i =UVW2_LEN-1 ; i != 0 ; --i )
   \   00000006   194C               LDR         R4,??uvw2_update_1  ;; ??window_vel_z
   \   00000008   E568               LDR         R5,[R4, #+12]
   \   0000000A   6F1E               SUB         R7,R5,#+1
   \   0000000C   3F06               LSL         R7,R7,#+24
   \   0000000E   3F0E               LSR         R7,R7,#+24
   \   00000010   09E0               B           ??uvw2_update_2
     88              {
     89                  window_vel_z[i] = window_vel_z[i-1];
   \                     ??uvw2_update_3:
   \   00000012   B800               LSL         R0,R7,#+2
   \   00000014   2118               ADD         R1,R4,R0
   \   00000016   081F               SUB         R0,R1,#+4
   \   00000018   0068               LDR         R0,[R0, #+0]
   \   0000001A   0860               STR         R0,[R1, #+0]
     90                  sum_vel_z += window_vel_z[i];
   \   0000001C   311C               MOV         R1,R6
   \   0000001E   ........           _BLF        __fAdd,??__fAdd??rT
   \   00000022   061C               MOV         R6,R0
     91              }
   \   00000024   7F1E               SUB         R7,R7,#+1
   \                     ??uvw2_update_2:
   \   00000026   3806               LSL         R0,R7,#+24
   \   00000028   F3D1               BNE         ??uvw2_update_3
     92              window_vel_z[0] = raw_uvw;
   \   0000002A   02A8               ADD         R0,SP,#+8
   \   0000002C   03C8               LDMIA       R0!,{R0,R1}
   \   0000002E   ........           _BLF        __doubleToFloat,??__doubleToFloat??rT
   \   00000032   2060               STR         R0,[R4, #+0]
     93              sum_vel_z += window_vel_z[0] ;
     94              vel_z_current = sum_vel_z/UVW2_LEN ;
   \   00000034   6F46               MOV         R7,SP
   \   00000036   311C               MOV         R1,R6
   \   00000038   ........           _BLF        __fAdd,??__fAdd??rT
   \   0000003C   061C               MOV         R6,R0
   \   0000003E   281C               MOV         R0,R5
   \   00000040   ........           _BLF        __longToFloat,??__longToFloat??rT
   \   00000044   011C               MOV         R1,R0
   \   00000046   301C               MOV         R0,R6
   \   00000048   ........           _BLF        __fDiv,??__fDiv??rT
   \   0000004C   ........           _BLF        __floatToDouble,??__floatToDouble??rT
   \   00000050   03C7               STMIA       R7!,{R0,R1}
     95          	
     96              if(UVW2_LEN >= 3)
   \   00000052   032D               CMP         R5,#+3
   \   00000054   01DB               BLT         ??uvw2_update_4
     97                   UVW2_LEN = 3;
   \   00000056   0325               MOV         R5,#+3
   \   00000058   00E0               B           ??uvw2_update_5
     98                else UVW2_LEN++;   
   \                     ??uvw2_update_4:
   \   0000005A   6D1C               ADD         R5,R5,#+1
   \                     ??uvw2_update_5:
   \   0000005C   E560               STR         R5,[R4, #+12]
     99          	  
    100              return vel_z_current;   
   \   0000005E   6846               MOV         R0,SP
   \   00000060   03C8               LDMIA       R0!,{R0,R1}
   \   00000062   04B0               ADD         SP,#+16
   \   00000064   F0BC               POP         {R4-R7}
   \   00000066   04BC               POP         {R2}
   \   00000068   1047               BX          R2                 ;; return
   \   0000006A   C046               NOP         
   \                     ??uvw2_update_1:
   \   0000006C   ........           DC32        ??window_vel_z
    101          }

   \                                 In segment DATA_I, align 4, align-sorted
   \                     ??window_vel_z:
   \   00000000                      DS8 12
   \   0000000C                      REQUIRE `?<Initializer for window_vel_z>`
   \   0000000C                      DS8 4
   \   00000010                      REQUIRE `?<Initializer for UVW2_LEN>`
    102          

   \                                 In segment CODE, align 4, keep-with-next
    103          void Cnb_update(double*q)
    104          {  
   \                     ??Cnb_update:
   \   00000000   F0B5               PUSH        {R4-R7,LR}
   \   00000002   94B0               SUB         SP,#+80
    105          	//´Ë´¦Cnb±íÊ¾´ÓNED×ø±êÏµµ½»úÌå×ø±êÏµµÄ×ª»»¾ØÕó£¨ÓÃCbn±íÊ¾¸üºÏÊÊ£©
    106              double q0=q[0],q1=q[1],q2=q[2],q3=q[3];
   \   00000004   06A9               ADD         R1,SP,#+24
   \   00000006   0CC8               LDMIA       R0!,{R2,R3}
   \   00000008   0838               SUB         R0,#+8
   \   0000000A   0CC1               STMIA       R1!,{R2,R3}
   \   0000000C   6946               MOV         R1,SP
   \   0000000E   021C               MOV         R2,R0
   \   00000010   0832               ADD         R2,#+8
   \   00000012   0CCA               LDMIA       R2!,{R2,R3}
   \   00000014   0CC1               STMIA       R1!,{R2,R3}
   \   00000016   021C               MOV         R2,R0
   \   00000018   1032               ADD         R2,#+16
   \   0000001A   0CCA               LDMIA       R2!,{R2,R3}
   \   0000001C   0CC1               STMIA       R1!,{R2,R3}
   \   0000001E   04AA               ADD         R2,SP,#+16
   \   00000020   1830               ADD         R0,#+24
   \   00000022   03C8               LDMIA       R0!,{R0,R1}
   \   00000024   03C2               STMIA       R2!,{R0,R1}
    107              Cbn[0][0] =  1-2*(q2*q2 + q3*q3);
   \   00000026   0AAC               ADD         R4,SP,#+40
   \   00000028   04A8               ADD         R0,SP,#+16
   \   0000002A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000002C   04A8               ADD         R0,SP,#+16
   \   0000002E   03C8               LDMIA       R0!,{R0,R1}
   \   00000030   ........           _BLF        __dMul,??__dMul??rT
   \   00000034   03C4               STMIA       R4!,{R0,R1}
   \   00000036   02A8               ADD         R0,SP,#+8
   \   00000038   0CC8               LDMIA       R0!,{R2,R3}
   \   0000003A   02A8               ADD         R0,SP,#+8
   \   0000003C   03C8               LDMIA       R0!,{R0,R1}
   \   0000003E   ........           _BLF        __dMul,??__dMul??rT
   \   00000042   03C4               STMIA       R4!,{R0,R1}
   \   00000044   ....               LDR         R4,??DataTable4    ;; Cbn
   \   00000046   0CA8               ADD         R0,SP,#+48
   \   00000048   0CC8               LDMIA       R0!,{R2,R3}
   \   0000004A   0AA8               ADD         R0,SP,#+40
   \   0000004C   03C8               LDMIA       R0!,{R0,R1}
   \   0000004E   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000052   0022               MOV         R2,#+0
   \   00000054   8023               MOV         R3,#+128
   \   00000056   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   00000058   ........           _BLF        __dMul,??__dMul??rT
   \   0000005C   021C               MOV         R2,R0
   \   0000005E   0B1C               MOV         R3,R1
   \   00000060   0020               MOV         R0,#+0
   \   00000062   ....               LDR         R1,??DataTable7    ;; 0x3ff00000
   \   00000064   ........           _BLF        __dSub,??__dSub??rT
   \   00000068   03C4               STMIA       R4!,{R0,R1}
   \   0000006A   083C               SUB         R4,#+8
    108              Cbn[0][1] =  2*(q1*q2 - q0*q3);
   \   0000006C   08AD               ADD         R5,SP,#+32
   \   0000006E   06A8               ADD         R0,SP,#+24
   \   00000070   03C8               LDMIA       R0!,{R0,R1}
   \   00000072   04AA               ADD         R2,SP,#+16
   \   00000074   0CCA               LDMIA       R2!,{R2,R3}
   \   00000076   ........           _BLF        __dMul,??__dMul??rT
   \   0000007A   03C5               STMIA       R5!,{R0,R1}
   \   0000007C   6846               MOV         R0,SP
   \   0000007E   0CC8               LDMIA       R0!,{R2,R3}
   \   00000080   03C8               LDMIA       R0!,{R0,R1}
   \   00000082   ........           _BLF        __dMul,??__dMul??rT
   \   00000086   061C               MOV         R6,R0
   \   00000088   0F1C               MOV         R7,R1
   \   0000008A   251C               MOV         R5,R4
   \   0000008C   0835               ADD         R5,#+8
   \   0000008E   08AA               ADD         R2,SP,#+32
   \   00000090   0CCA               LDMIA       R2!,{R2,R3}
   \   00000092   ........           _BLF        __dSub,??__dSub??rT
   \   00000096   021C               MOV         R2,R0
   \   00000098   0B1C               MOV         R3,R1
   \   0000009A   0020               MOV         R0,#+0
   \   0000009C   8021               MOV         R1,#+128
   \   0000009E   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   000000A0   ........           _BLF        __dMul,??__dMul??rT
   \   000000A4   03C5               STMIA       R5!,{R0,R1}
    109              Cbn[0][2] =  2*(q1*q3+q0*q2);
   \   000000A6   0EAD               ADD         R5,SP,#+56
   \   000000A8   06A8               ADD         R0,SP,#+24
   \   000000AA   0CC8               LDMIA       R0!,{R2,R3}
   \   000000AC   02A8               ADD         R0,SP,#+8
   \   000000AE   03C8               LDMIA       R0!,{R0,R1}
   \   000000B0   ........           _BLF        __dMul,??__dMul??rT
   \   000000B4   03C5               STMIA       R5!,{R0,R1}
   \   000000B6   6846               MOV         R0,SP
   \   000000B8   0CC8               LDMIA       R0!,{R2,R3}
   \   000000BA   04A8               ADD         R0,SP,#+16
   \   000000BC   03C8               LDMIA       R0!,{R0,R1}
   \   000000BE   ........           _BLF        __dMul,??__dMul??rT
   \   000000C2   03C5               STMIA       R5!,{R0,R1}
   \   000000C4   251C               MOV         R5,R4
   \   000000C6   1035               ADD         R5,#+16
   \   000000C8   10A8               ADD         R0,SP,#+64
   \   000000CA   0CC8               LDMIA       R0!,{R2,R3}
   \   000000CC   0EA8               ADD         R0,SP,#+56
   \   000000CE   03C8               LDMIA       R0!,{R0,R1}
   \   000000D0   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000D4   021C               MOV         R2,R0
   \   000000D6   0B1C               MOV         R3,R1
   \   000000D8   0020               MOV         R0,#+0
   \   000000DA   8021               MOV         R1,#+128
   \   000000DC   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   000000DE   ........           _BLF        __dMul,??__dMul??rT
   \   000000E2   03C5               STMIA       R5!,{R0,R1}
    110              
    111              Cbn[1][0] =   2*(q1*q2 + q0*q3);
   \   000000E4   251C               MOV         R5,R4
   \   000000E6   1835               ADD         R5,#+24
   \   000000E8   321C               MOV         R2,R6
   \   000000EA   3B1C               MOV         R3,R7
   \   000000EC   08A8               ADD         R0,SP,#+32
   \   000000EE   03C8               LDMIA       R0!,{R0,R1}
   \   000000F0   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000F4   021C               MOV         R2,R0
   \   000000F6   0B1C               MOV         R3,R1
   \   000000F8   0020               MOV         R0,#+0
   \   000000FA   8021               MOV         R1,#+128
   \   000000FC   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   000000FE   ........           _BLF        __dMul,??__dMul??rT
   \   00000102   03C5               STMIA       R5!,{R0,R1}
    112              Cbn[1][1] =   1-2*(q1*q1+q3*q3);
   \   00000104   6846               MOV         R0,SP
   \   00000106   0CC8               LDMIA       R0!,{R2,R3}
   \   00000108   6846               MOV         R0,SP
   \   0000010A   03C8               LDMIA       R0!,{R0,R1}
   \   0000010C   ........           _BLF        __dMul,??__dMul??rT
   \   00000110   061C               MOV         R6,R0
   \   00000112   0F1C               MOV         R7,R1
   \   00000114   251C               MOV         R5,R4
   \   00000116   2035               ADD         R5,#+32
   \   00000118   0AA8               ADD         R0,SP,#+40
   \   0000011A   03C8               LDMIA       R0!,{R0,R1}
   \   0000011C   321C               MOV         R2,R6
   \   0000011E   3B1C               MOV         R3,R7
   \   00000120   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000124   021C               MOV         R2,R0
   \   00000126   0B1C               MOV         R3,R1
   \   00000128   0020               MOV         R0,#+0
   \   0000012A   8021               MOV         R1,#+128
   \   0000012C   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   0000012E   ........           _BLF        __dMul,??__dMul??rT
   \   00000132   021C               MOV         R2,R0
   \   00000134   0B1C               MOV         R3,R1
   \   00000136   0020               MOV         R0,#+0
   \   00000138   ....               LDR         R1,??DataTable7    ;; 0x3ff00000
   \   0000013A   ........           _BLF        __dSub,??__dSub??rT
   \   0000013E   03C5               STMIA       R5!,{R0,R1}
    113              Cbn[1][2] =   2*(q2*q3-q0*q1);
   \   00000140   12AD               ADD         R5,SP,#+72
   \   00000142   06A8               ADD         R0,SP,#+24
   \   00000144   0CC8               LDMIA       R0!,{R2,R3}
   \   00000146   6846               MOV         R0,SP
   \   00000148   03C8               LDMIA       R0!,{R0,R1}
   \   0000014A   ........           _BLF        __dMul,??__dMul??rT
   \   0000014E   03C5               STMIA       R5!,{R0,R1}
   \   00000150   6D46               MOV         R5,SP
   \   00000152   02A8               ADD         R0,SP,#+8
   \   00000154   0CC8               LDMIA       R0!,{R2,R3}
   \   00000156   03C8               LDMIA       R0!,{R0,R1}
   \   00000158   ........           _BLF        __dMul,??__dMul??rT
   \   0000015C   03C5               STMIA       R5!,{R0,R1}
   \   0000015E   251C               MOV         R5,R4
   \   00000160   2835               ADD         R5,#+40
   \   00000162   6846               MOV         R0,SP
   \   00000164   03C8               LDMIA       R0!,{R0,R1}
   \   00000166   12AA               ADD         R2,SP,#+72
   \   00000168   0CCA               LDMIA       R2!,{R2,R3}
   \   0000016A   ........           _BLF        __dSub,??__dSub??rT
   \   0000016E   021C               MOV         R2,R0
   \   00000170   0B1C               MOV         R3,R1
   \   00000172   0020               MOV         R0,#+0
   \   00000174   8021               MOV         R1,#+128
   \   00000176   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   00000178   ........           _BLF        __dMul,??__dMul??rT
   \   0000017C   03C5               STMIA       R5!,{R0,R1}
    114              
    115              Cbn[2][0] =   2*(q1*q3 - q0*q2);
   \   0000017E   251C               MOV         R5,R4
   \   00000180   3035               ADD         R5,#+48
   \   00000182   10A8               ADD         R0,SP,#+64
   \   00000184   03C8               LDMIA       R0!,{R0,R1}
   \   00000186   0EAA               ADD         R2,SP,#+56
   \   00000188   0CCA               LDMIA       R2!,{R2,R3}
   \   0000018A   ........           _BLF        __dSub,??__dSub??rT
   \   0000018E   021C               MOV         R2,R0
   \   00000190   0B1C               MOV         R3,R1
   \   00000192   0020               MOV         R0,#+0
   \   00000194   8021               MOV         R1,#+128
   \   00000196   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   00000198   ........           _BLF        __dMul,??__dMul??rT
   \   0000019C   03C5               STMIA       R5!,{R0,R1}
    116              Cbn[2][1] =   2*(q2*q3+q0*q1);
   \   0000019E   251C               MOV         R5,R4
   \   000001A0   3835               ADD         R5,#+56
   \   000001A2   6846               MOV         R0,SP
   \   000001A4   0CC8               LDMIA       R0!,{R2,R3}
   \   000001A6   12A8               ADD         R0,SP,#+72
   \   000001A8   03C8               LDMIA       R0!,{R0,R1}
   \   000001AA   ........           _BLF        __dAdd,??__dAdd??rT
   \   000001AE   021C               MOV         R2,R0
   \   000001B0   0B1C               MOV         R3,R1
   \   000001B2   0020               MOV         R0,#+0
   \   000001B4   8021               MOV         R1,#+128
   \   000001B6   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   000001B8   ........           _BLF        __dMul,??__dMul??rT
   \   000001BC   03C5               STMIA       R5!,{R0,R1}
    117              Cbn[2][2] =   1-2*(q1*q1+q2*q2); 
   \   000001BE   0CA8               ADD         R0,SP,#+48
   \   000001C0   03C8               LDMIA       R0!,{R0,R1}
   \   000001C2   321C               MOV         R2,R6
   \   000001C4   3B1C               MOV         R3,R7
   \   000001C6   ........           _BLF        __dAdd,??__dAdd??rT
   \   000001CA   0022               MOV         R2,#+0
   \   000001CC   8023               MOV         R3,#+128
   \   000001CE   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   000001D0   ........           _BLF        __dMul,??__dMul??rT
   \   000001D4   021C               MOV         R2,R0
   \   000001D6   0B1C               MOV         R3,R1
   \   000001D8   0020               MOV         R0,#+0
   \   000001DA   ....               LDR         R1,??DataTable7    ;; 0x3ff00000
   \   000001DC   ........           _BLF        __dSub,??__dSub??rT
   \   000001E0   2064               STR         R0,[R4, #+64]
   \   000001E2   6164               STR         R1,[R4, #+68]
    118              for(int i=0;i<3;i++)
   \   000001E4   0023               MOV         R3,#+0
    119                 for(int j=0;j<3;j++)
   \                     ??Cnb_update_1:
   \   000001E6   0025               MOV         R5,#+0
    120                   {
    121                     Cnb[i][j]=Cbn[j][i];
   \                     ??Cnb_update_2:
   \   000001E8   E800               LSL         R0,R5,#+3
   \   000001EA   1821               MOV         R1,#+24
   \   000001EC   5943               MUL         R1,R3
   \   000001EE   ....               LDR         R6,??DataTable9    ;; Cnb
   \   000001F0   7118               ADD         R1,R6,R1
   \   000001F2   0E18               ADD         R6,R1,R0
   \   000001F4   1820               MOV         R0,#+24
   \   000001F6   6843               MUL         R0,R5
   \   000001F8   D900               LSL         R1,R3,#+3
   \   000001FA   6118               ADD         R1,R4,R1
   \   000001FC   0818               ADD         R0,R1,R0
   \   000001FE   03C8               LDMIA       R0!,{R0,R1}
   \   00000200   03C6               STMIA       R6!,{R0,R1}
    122                   }
   \   00000202   6D1C               ADD         R5,R5,#+1
   \   00000204   032D               CMP         R5,#+3
   \   00000206   EFDB               BLT         ??Cnb_update_2
   \   00000208   5B1C               ADD         R3,R3,#+1
   \   0000020A   032B               CMP         R3,#+3
   \   0000020C   EBDB               BLT         ??Cnb_update_1
    123          }
   \   0000020E   14B0               ADD         SP,#+80
   \   00000210                      REQUIRE ?Subroutine18
   \   00000210                      ;; // Fall through to label ?Subroutine18

   \                                 In segment CODE, align 4, keep-with-next
    124          void ahrs_update(void)
    125          {
   \                     ??ahrs_update:
   \   00000000   00B5               PUSH        {LR}
    126            state_init();//µÃµ½¹Û²âÖµ
   \   00000002   ........           BL          ??state_init
    127          
    128          //  position.raw_current_xyz[2]=bmp_height;
    129          //  
    130          //  static double height_array[6];                //mei2015-4-20
    131          //  static double aux_sum;
    132          //  static int aux_height_num = 3;             //mei2015-4-20 Îª6/2
    133          //  static int height_num = 0;                    //mei2015-4-20  
    134          //  aux_sum += height_array[height_num];          //mei2015-4-20 ¼ÓÉÏ×î¾ÉµÄÊý¾Ý£¬Ïàµ±ÓÚ×î¾ÉÊý¾ÝÇåÁã
    135          //  height_array[height_num] = bmp_height;        //mei2015-4-20
    136          //  aux_sum += height_array[height_num];          //mei2015-4-20 ¼ÓÉÏ×îÐÂµÄÊý¾Ý£¬ÒýÈë×îÐÂÊý¾Ý
    137          //  aux_sum -= height_array[aux_height_num];      
    138          //  aux_sum -= height_array[aux_height_num];      //mei2015-4-20 ¼õÈ¥Á½±¶µÄÖÐ¼ä¹ý¶ÉÊý£¬Ïàµ±ÓÚÓÉ¼Ó±ä³É¼õ
    139          //  position.raw_current_uvw[2] = aux_sum*30/9; //mei2015-4-20//9Îª3^3
    140          //  height_num++;                                     //mei2015-4-20
    141          //  aux_height_num++;                                 //mei2015-4-20
    142          //  if (height_num == 6) height_num = 0;              //mei2015-4-20
    143          //  if (aux_height_num == 6) aux_height_num = 0;      //mei2015-4-20
    144            
    145          //  static double height_array[4];        //mei2015-4-20
    146          //  static double bmp_height_0;            //mei2015-4-20
    147          //  static int height_num = 0;            //mei2015-4-20  
    148          //  bmp_height_0 = height_array[height_num];          //mei2015-4-20×¢Òâbmp_height_0ºÍheight_array[4]×Ü¹²5¸öÊý
    149          //  height_array[height_num] = bmp_height;            //mei2015-4-20
    150          //  position.raw_current_uvw[2] = (height_array[height_num] - bmp_height_0)*30/4;//mei2015-4-20
    151          //  height_num++;                                     //mei2015-4-20
    152          //  if (height_num == 4) height_num = 0;              //mei2015-4-20
    153            
    154          //mei2015-4-20  position.raw_current_uvw[2] = (position.raw_current_xyz[2] - last_bmp_height)*30;
    155          //  last_bmp_height = position.raw_current_xyz[2];
    156            //position.raw_current_uvw[2]=uvw2_update();
    157            
    158            //×¢Òâ£ºkalmanÂË²¨ÐèÒªµÄËÙ¶ÈÏîµÄÊäÈëÖµÎª»úÌå×ø±êÏµÏÂµÄÖµ---ÔÚEKFÀïÃæ×ª»»³É»úÌåÏÂÖµ//
    159          //  double Kalman_State[11]={position.raw_current_xyz[0],position.raw_current_xyz[1],position.raw_current_xyz[2],
    160          //                           position.raw_current_uvw[0],position.raw_current_uvw[1],position.raw_current_uvw[2],
    161          //                           raw_K_Quat[0],raw_K_Quat[1],raw_K_Quat[2],raw_K_Quat[3],accel_g};
    162          //  double Obs_State[9] =  {position.raw_current_xyz[0],position.raw_current_xyz[1],position.raw_current_xyz[2],
    163          //                           position.raw_current_uvw[0],position.raw_current_uvw[1],position.raw_current_uvw[2],
    164          //                           raw_ahrs_theta[0],raw_ahrs_theta[1],raw_ahrs_theta[2]};
    165          //  double Need_Param[6] = {ahrs_pqr[0],ahrs_pqr[1],ahrs_pqr[2],
    166          //                          ahrs_accel[0],ahrs_accel[1],ahrs_accel[2]};
    167          //  
    168          //  EKF(Kalman_State,Obs_State,Need_Param,est_Kalman_State);
    169          //    
    170          //  for(int i =0 ; i!=3; ++i) 
    171          //  position.current_xyz[i] = est_Kalman_State[i];
    172          //  
    173          //  for(int i =3 ; i!=6; ++i) 
    174          //  input_uvw[i-3] = est_Kalman_State[i];//ÂË²¨ºóµÃµ½±ê×¼»úÌå×ø±êÏµÏÂ·É»úÈýÖáÏßËÙ¶È
    175          //  
    176          //  for(int i =6 ; i!=10; ++i) 
    177          //  K_Quat[i-6] = est_Kalman_State[i];
    178          //  
    179          //  quat2euler( ahrs_theta, K_Quat );
    180          //  accel_g = est_Kalman_State[10];
    181          //
    182          //   //·É»úµÄ¸ß¶ÈÏî¿ØÖÆÁ¿¾ù²ÉÓÃnedÏÂÎ»ÖÃËÙ¶È  position.current_uvwÎªÂË²¨ºónedÏÂËÙ¶ÈÖµ
    183          //  //position.current_uvw[0]=Cbn[0][0]*input_uvw[0]+Cbn[0][1]*input_uvw[1]+Cbn[0][2]*input_uvw[2];
    184          //  //position.current_uvw[1]=Cbn[1][0]*input_uvw[0]+Cbn[1][1]*input_uvw[1]+Cbn[1][2]*input_uvw[2];
    185          //  position.current_uvw[2]=Cbn[2][0]*input_uvw[0]+Cbn[2][1]*input_uvw[1]+Cbn[2][2]*input_uvw[2];
    186          //  //input_uvw[2] = position.current_uvw[2];
    187          //  input_uvw[2] = uvw2_update(position.current_uvw[2]);
    188          //  //---------------gps²¹³¥-----------------//
    189          //  offset_x=cos(ahrs_theta[2])*offset_p;
    190          //  offset_y=sin(ahrs_theta[2])*offset_p;
    191          //  position.current_xyz[0]=position.current_xyz[0]+offset_x;
    192          //  position.current_xyz[1]=position.current_xyz[1]+offset_y;  //º½Ïò½Ç²»×¼ ²¹³¥»á³öÏÖÎÊÌâ
    193          }
   \   00000006   01BC               POP         {R0}
   \   00000008   0047               BX          R0                 ;; return
    194          
    195          
    196          /****************************************************************
    197           *º¯ Êý Ãû: EKF()
    198           *²Î    Êý:
    199           *         state: ÂË²¨Ç°×´Ì¬x, y, z, u, v, w, q0, q1, q2, q3, g
    200           *         obs  : ¹Û²âÁ¿x, y, z, u, v, w, phi, theta, psi
    201           *         param: ÐèÒªµÄ²ÎÊý p, q, r, ax, ay, az
    202           *         est  : ÂË²¨ºóµÄ×´Ì¬x, y, z, u, v, w, q0, q1, q2, q3, g
    203           *
    204           *¹¦    ÄÜ£º¶ÔÎ»ÖÃ¡¢ËÙ¶È¡¢ËÄÔªÊý¡¢ÖØÁ¦¼ÓËÙ¶È½øÐÐEKFÂË²¨
    205           *
    206           *·µ »Ø Öµ:
    207           *          ³É¹¦: OK
    208           *          ÊäÈëÊä³öÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
    209           *
    210           *×÷    Õß£ºÉêÎÄ±ó
    211           *Íê³ÉÈÕÆÚ£º2011-3-22
    212           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    213          void EKF(const double *state, const double *obs, const double *param, double *est)
    214          {
   \                     ??EKF:
   \   00000000   F8B5               PUSH        {R3-R7,LR}
   \   00000002   C0B0               SUB         SP,#+256
   \   00000004   051C               MOV         R5,R0
   \   00000006   0C1C               MOV         R4,R1
    215              // Î»ÖÃËÙ¶ÈÂË²¨³õÊ¼Öµ
    216              double pvState[LEN_PV_STATE];    // ÂË²¨Ç°×´Ì¬ x, y, z, u, v, w
    217              double pvObs[LEN_PV_OBS];        // ¹Û²âÁ¿x, y, z, u, v, w
    218          
    219              // ËÄÔªÊý¡¢¼ÓËÙ¶ÈÂË²¨³õÊ¼Öµ
    220              double qgState[LEN_QG_STATE];    // ÂË²¨Ç°×´Ì¬q0, q1, q2, q3, g
    221              double qgObs[LEN_QG_OBS];        // ¹Û²âÁ¿phi, theta, psi
    222          
    223              // ÂË²¨ÐèÒªµÄ¸¨Öú²ÎÊýp, q, r, ax, ay, az, q0, q1, q2, q3¹²10¸ö
    224              // ¶ÔËÄÔªÊý¡¢¼ÓËÙ¶ÈÂË²¨Ê±ÓÃµ½Ç°6¸ö
    225              // ¶ÔÎ»ÖÃ¡¢ËÙ¶ÈÂË²¨Ê±È«²¿ÓÃµ½
    226              double othParam[10];
    227              int    qgLenParam = 6;
    228              int    pvLenParam = 10;
    229              int i, j;                    // Ñ­»·±äÁ¿
    230              // ¶ÔËÄÔªÊý¡¢¼ÓËÙ¶ÈÂË²¨²ÎÊý³õÊ¼»¯
    231              for (i=0; i<LEN_QG_STATE; i++)
   \   00000008   0026               MOV         R6,#+0
   \   0000000A   0023               MOV         R3,#+0
    232              {
    233                  qgState[i] = state[i+ LEN_PV_STATE];        // ×´Ì¬Á¿
   \                     ??EKF_1:
   \   0000000C   D800               LSL         R0,R3,#+3
   \   0000000E   36A9               ADD         R1,SP,#+216
   \   00000010   0F18               ADD         R7,R1,R0
   \   00000012   291C               MOV         R1,R5
   \   00000014   3031               ADD         R1,#+48
   \   00000016   0818               ADD         R0,R1,R0
   \   00000018   03C8               LDMIA       R0!,{R0,R1}
   \   0000001A   03C7               STMIA       R7!,{R0,R1}
    234              }
   \   0000001C   5B1C               ADD         R3,R3,#+1
   \   0000001E   052B               CMP         R3,#+5
   \   00000020   F4DB               BLT         ??EKF_1
    235              for (i=0; i<LEN_QG_OBS; i++)
   \   00000022   0023               MOV         R3,#+0
    236              {
    237                  qgObs[i] = obs[i+ LEN_PV_OBS];        // ¹Û²âÁ¿
   \                     ??EKF_2:
   \   00000024   D800               LSL         R0,R3,#+3
   \   00000026   1CA9               ADD         R1,SP,#+112
   \   00000028   0F18               ADD         R7,R1,R0
   \   0000002A   211C               MOV         R1,R4
   \   0000002C   3031               ADD         R1,#+48
   \   0000002E   0818               ADD         R0,R1,R0
   \   00000030   03C8               LDMIA       R0!,{R0,R1}
   \   00000032   03C7               STMIA       R7!,{R0,R1}
    238              }
   \   00000034   5B1C               ADD         R3,R3,#+1
   \   00000036   032B               CMP         R3,#+3
   \   00000038   F4DB               BLT         ??EKF_2
    239              for (i=0; i<qgLenParam; i++)
   \   0000003A   0023               MOV         R3,#+0
    240              {
    241                  othParam[i] = param[i];               // ¸¨Öú²ÎÊý
   \                     ??EKF_3:
   \   0000003C   D800               LSL         R0,R3,#+3
   \   0000003E   22A9               ADD         R1,SP,#+136
   \   00000040   0F18               ADD         R7,R1,R0
   \   00000042   1018               ADD         R0,R2,R0
   \   00000044   03C8               LDMIA       R0!,{R0,R1}
   \   00000046   03C7               STMIA       R7!,{R0,R1}
    242              }
   \   00000048   5B1C               ADD         R3,R3,#+1
   \   0000004A   062B               CMP         R3,#+6
   \   0000004C   F6DB               BLT         ??EKF_3
    243              // ¶ÔËÄÔªÊý¡¢¼ÓËÙ¶ÈÂË²¨£¬ÂË²¨ºóËÄÔªËØµÄ´æ´¢Ê×µØÖ·Îªest+LEN_PV_STATE
    244              QGEKF(qgState, qgObs, othParam, est+LEN_PV_STATE);
   \   0000004E   409B               LDR         R3,[SP, #+256]
   \   00000050   3033               ADD         R3,#+48
   \   00000052   22AA               ADD         R2,SP,#+136
   \   00000054   1CA9               ADD         R1,SP,#+112
   \   00000056   36A8               ADD         R0,SP,#+216
   \   00000058   ........           BL          ??QGEKF
    245              
    246          	// ¶ÔËÙ¶ÈÎ»ÖÃÂË²¨²ÎÊý³õÊ¼»¯	
    247          	j = LEN_PV_STATE;
   \   0000005C   0622               MOV         R2,#+6
    248              for (i=qgLenParam; i<pvLenParam; i++)
   \   0000005E   0623               MOV         R3,#+6
    249              {
    250                  othParam[i] = est[j++];       // ½«ÂË²¨ºóµÄËÄÔªÊý¸øothParam
   \                     ??EKF_4:
   \   00000060   D800               LSL         R0,R3,#+3
   \   00000062   22A9               ADD         R1,SP,#+136
   \   00000064   0F18               ADD         R7,R1,R0
   \   00000066   D000               LSL         R0,R2,#+3
   \   00000068   4099               LDR         R1,[SP, #+256]
   \   0000006A   0818               ADD         R0,R1,R0
   \   0000006C   03C8               LDMIA       R0!,{R0,R1}
   \   0000006E   03C7               STMIA       R7!,{R0,R1}
   \   00000070   521C               ADD         R2,R2,#+1
    251              }   
   \   00000072   5B1C               ADD         R3,R3,#+1
   \   00000074   0A2B               CMP         R3,#+10
   \   00000076   F3DB               BLT         ??EKF_4
    252              for (i=0; i<LEN_PV_STATE; i++)
    253              {
    254                  pvState[i] = state[i];        // ×´Ì¬Á¿
   \                     ??EKF_5:
   \   00000078   F200               LSL         R2,R6,#+3
   \   0000007A   04A8               ADD         R0,SP,#+16
   \   0000007C   8318               ADD         R3,R0,R2
   \   0000007E   A818               ADD         R0,R5,R2
   \   00000080   03C8               LDMIA       R0!,{R0,R1}
   \   00000082   03C3               STMIA       R3!,{R0,R1}
    255                  // ¹Û²âÁ¿,ËüºÍ×´Ì¬Á¿ÏàÍ¬£¬ËùÒÔ¿ÉÒÔÔÚÍ¬Ò»¸öÑ­»·ÀïÃæ½øÐÐ
    256                  pvObs[i] = obs[i];
   \   00000084   10A8               ADD         R0,SP,#+64
   \   00000086   8318               ADD         R3,R0,R2
   \   00000088   A018               ADD         R0,R4,R2
   \   0000008A   03C8               LDMIA       R0!,{R0,R1}
   \   0000008C   03C3               STMIA       R3!,{R0,R1}
    257              }	
   \   0000008E   761C               ADD         R6,R6,#+1
   \   00000090   062E               CMP         R6,#+6
   \   00000092   F1DB               BLT         ??EKF_5
    258          	//--------------------------------------syc-------------------------------//
    259          	//°ÑNEDÏÂµÄËÙ¶È×ª»¯Îª»úÌå×ø±êÏÂµÄËÙ¶È  ×÷ÎªkalmanµÄÊäÈëÖµ
    260          	Cnb_update(est+LEN_PV_STATE);      
   \   00000094   4098               LDR         R0,[SP, #+256]
   \   00000096   3030               ADD         R0,#+48
   \   00000098   ........           BL          ??Cnb_update
    261          	pvObs[3]=Cnb[0][0]*obs[3]+Cnb[0][1]*obs[4]+Cnb[0][2]*obs[5];
   \   0000009C   ....               LDR         R5,??DataTable9    ;; Cnb
   \   0000009E   6A46               MOV         R2,SP
   \   000000A0   04B4               PUSH        {R2}
   \   000000A2   281C               MOV         R0,R5
   \   000000A4   1030               ADD         R0,#+16
   \   000000A6   0CC8               LDMIA       R0!,{R2,R3}
   \   000000A8   201C               MOV         R0,R4
   \   000000AA   2830               ADD         R0,#+40
   \   000000AC   03C8               LDMIA       R0!,{R0,R1}
   \   000000AE   ........           _BLF        __dMul,??__dMul??rT
   \   000000B2   03B4               PUSH        {R0,R1}
   \   000000B4   281C               MOV         R0,R5
   \   000000B6   0830               ADD         R0,#+8
   \   000000B8   0CC8               LDMIA       R0!,{R2,R3}
   \   000000BA   201C               MOV         R0,R4
   \   000000BC   2030               ADD         R0,#+32
   \   000000BE   03C8               LDMIA       R0!,{R0,R1}
   \   000000C0   ........           _BLF        __dMul,??__dMul??rT
   \   000000C4   061C               MOV         R6,R0
   \   000000C6   0F1C               MOV         R7,R1
   \   000000C8   0CCD               LDMIA       R5!,{R2,R3}
   \   000000CA   083D               SUB         R5,#+8
   \   000000CC   201C               MOV         R0,R4
   \   000000CE   1830               ADD         R0,#+24
   \   000000D0   03C8               LDMIA       R0!,{R0,R1}
   \   000000D2   ........           _BLF        __dMul,??__dMul??rT
   \   000000D6   321C               MOV         R2,R6
   \   000000D8   3B1C               MOV         R3,R7
   \   000000DA   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000DE   0CBC               POP         {R2,R3}
   \   000000E0   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000E4   04BC               POP         {R2}
   \   000000E6   03C2               STMIA       R2!,{R0,R1}
   \   000000E8   10AA               ADD         R2,SP,#+64
   \   000000EA   1832               ADD         R2,#+24
   \   000000EC   6846               MOV         R0,SP
   \   000000EE   03C8               LDMIA       R0!,{R0,R1}
   \   000000F0   03C2               STMIA       R2!,{R0,R1}
    262              pvObs[4]=Cnb[1][0]*obs[3]+Cnb[1][1]*obs[4]+Cnb[1][2]*obs[5];
   \   000000F2   02AA               ADD         R2,SP,#+8
   \   000000F4   04B4               PUSH        {R2}
   \   000000F6   281C               MOV         R0,R5
   \   000000F8   2830               ADD         R0,#+40
   \   000000FA   0CC8               LDMIA       R0!,{R2,R3}
   \   000000FC   201C               MOV         R0,R4
   \   000000FE   2830               ADD         R0,#+40
   \   00000100   03C8               LDMIA       R0!,{R0,R1}
   \   00000102   ........           _BLF        __dMul,??__dMul??rT
   \   00000106   03B4               PUSH        {R0,R1}
   \   00000108   281C               MOV         R0,R5
   \   0000010A   2030               ADD         R0,#+32
   \   0000010C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000010E   201C               MOV         R0,R4
   \   00000110   2030               ADD         R0,#+32
   \   00000112   03C8               LDMIA       R0!,{R0,R1}
   \   00000114   ........           _BLF        __dMul,??__dMul??rT
   \   00000118   061C               MOV         R6,R0
   \   0000011A   0F1C               MOV         R7,R1
   \   0000011C   281C               MOV         R0,R5
   \   0000011E   1830               ADD         R0,#+24
   \   00000120   0CC8               LDMIA       R0!,{R2,R3}
   \   00000122   201C               MOV         R0,R4
   \   00000124   1830               ADD         R0,#+24
   \   00000126   03C8               LDMIA       R0!,{R0,R1}
   \   00000128   ........           _BLF        __dMul,??__dMul??rT
   \   0000012C   321C               MOV         R2,R6
   \   0000012E   3B1C               MOV         R3,R7
   \   00000130   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000134   0CBC               POP         {R2,R3}
   \   00000136   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000013A   04BC               POP         {R2}
   \   0000013C   03C2               STMIA       R2!,{R0,R1}
   \   0000013E   10AA               ADD         R2,SP,#+64
   \   00000140   2032               ADD         R2,#+32
   \   00000142   02A8               ADD         R0,SP,#+8
   \   00000144   03C8               LDMIA       R0!,{R0,R1}
   \   00000146   03C2               STMIA       R2!,{R0,R1}
    263              pvObs[5]=Cnb[2][0]*obs[3]+Cnb[2][1]*obs[4]+Cnb[2][2]*obs[5];
   \   00000148   286C               LDR         R0,[R5, #+64]
   \   0000014A   696C               LDR         R1,[R5, #+68]
   \   0000014C   221C               MOV         R2,R4
   \   0000014E   2832               ADD         R2,#+40
   \   00000150   0CCA               LDMIA       R2!,{R2,R3}
   \   00000152   ........           _BLF        __dMul,??__dMul??rT
   \   00000156   03B4               PUSH        {R0,R1}
   \   00000158   281C               MOV         R0,R5
   \   0000015A   3830               ADD         R0,#+56
   \   0000015C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000015E   201C               MOV         R0,R4
   \   00000160   2030               ADD         R0,#+32
   \   00000162   03C8               LDMIA       R0!,{R0,R1}
   \   00000164   ........           _BLF        __dMul,??__dMul??rT
   \   00000168   061C               MOV         R6,R0
   \   0000016A   0F1C               MOV         R7,R1
   \   0000016C   3035               ADD         R5,#+48
   \   0000016E   0CCD               LDMIA       R5!,{R2,R3}
   \   00000170   1834               ADD         R4,#+24
   \   00000172   03CC               LDMIA       R4!,{R0,R1}
   \   00000174   ........           _BLF        __dMul,??__dMul??rT
   \   00000178   321C               MOV         R2,R6
   \   0000017A   3B1C               MOV         R3,R7
   \   0000017C   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000180   0CBC               POP         {R2,R3}
   \   00000182   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000186   10AA               ADD         R2,SP,#+64
   \   00000188   2832               ADD         R2,#+40
   \   0000018A   03C2               STMIA       R2!,{R0,R1}
    264              pvState[3]= pvObs[3];
   \   0000018C   04AC               ADD         R4,SP,#+16
   \   0000018E   1834               ADD         R4,#+24
   \   00000190   6A46               MOV         R2,SP
   \   00000192   0CCA               LDMIA       R2!,{R2,R3}
   \   00000194   0CC4               STMIA       R4!,{R2,R3}
    265              pvState[4]= pvObs[4];
   \   00000196   04AC               ADD         R4,SP,#+16
   \   00000198   2034               ADD         R4,#+32
   \   0000019A   02AA               ADD         R2,SP,#+8
   \   0000019C   0CCA               LDMIA       R2!,{R2,R3}
   \   0000019E   0CC4               STMIA       R4!,{R2,R3}
    266              pvState[5]= pvObs[5];
   \   000001A0   04AA               ADD         R2,SP,#+16
   \   000001A2   2832               ADD         R2,#+40
   \   000001A4   03C2               STMIA       R2!,{R0,R1}
    267              // ¶ÔÎ»ÖÃ¡¢ËÙ¶ÈÂË²¨£¬ÂË²¨ºóµÄ´æ´¢Ê×µØÖ·Îªest
    268              PosVelEKF(pvState, pvObs, othParam, est);
   \   000001A6   409B               LDR         R3,[SP, #+256]
   \   000001A8   22AA               ADD         R2,SP,#+136
   \   000001AA   10A9               ADD         R1,SP,#+64
   \   000001AC   04A8               ADD         R0,SP,#+16
   \   000001AE   ........           BL          ??PosVelEKF
    269          }
   \   000001B2   41B0               ADD         SP,#+260
   \   000001B4   ....               B           ?Subroutine18
    270          
    271          /****************************************************************
    272           *º¯ Êý Ãû: DoEKF()
    273           *²Î    Êý:
    274           *               pModel model: ÐèÒª½øÐÐEKFÂË²¨µÄÄ£ÐÍ
    275           *         pModelParam mParam: ×´Ì¬Á¿¡¢¹Û²âÁ¿¼°¹À¼ÆÖµ±£´æµØÖ·
    276           *         pEKFParam ekfParam: KFÂË²¨ËùÐèÒªµÄ²ÎÊý
    277           *
    278           *¹¦    ÄÜ£º¶ÔmodelËùÊ¾µÄÄ£ÐÍ½øÐÐEKFÂË²¨
    279           *          ¿¼ÂÇÁËPkk-1ºÍPkÎª¶Ô³Æ¾ØÕó£¬µ±Çó½âÕâÁ½ÏîÊ±µÄËã·¨ºÍ
    280           *          ÆÕÍ¨¾ØÕóµÄ³Ë·¨²»Ò»Ñù¡£
    281           *
    282           *·µ »Ø Öµ:
    283           *          ³É¹¦: OK
    284           *          ÊäÈëÊä³öÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
    285           *
    286           *×÷    Õß£ºÉêÎÄ±ó
    287           *Íê³ÉÈÕÆÚ£º2011-3-22
    288           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    289          int DoEKF(pModel model, pModelParam mParam, pEKFParam ekfParam)
    290          {
   \                     ??DoEKF:
   \   00000000   F7B5               PUSH        {R0-R2,R4-R7,LR}
   \   00000002   DE4B               LDR         R3,??DoEKF_1       ;; 0xfffff54c
   \   00000004   9D44               ADD         SP,R3
    291              const double T = 0.033;      // ²ÉÑùÖÜÆÚ
    292              int i, j, k;                // Ñ­»·±äÁ¿
    293          
    294              // ÒÔÏÂÎªÂË²¨¹ý³ÌÖÐÒªÓÃµÄÁÙÊ±±äÁ¿
    295              // ÕâÀïÍ³Ò»ÓÃÒ»Î¬Êý×é±íÊ¾¾ØÕó,ÎªÁË¸´ÓÃµØÖ·£¬ÕâÀï°´×î´óÐèÇó¿ª±Ù
    296              // ÓÉÓÚÔÚÃ»ÓÐ²Ù×÷ÏµÍ³µÄARM7ÉÏ²»¿ÉÒÔ¶¯Ì¬¿ª±Ù¿Õ¼ä£¬ËùÒÔÕâÀïÖ»ÄÜÓÃ
    297              // ÕâÖÖ±È½Ï±¿µÄ·½·¨ÁË¡£
    298              double fx[MAX_STATE];    // ±£´æ×´Ì¬·½³Ì¼ÆËãÖµ
    299              double Xhatkk_1[MAX_STATE];
    300              double Hk[MAX_OBS * MAX_STATE];            // ±£´æ¹Û²â¾ØÕóHk
    301              double Phikk_1[MAX_STATE * MAX_STATE];
    302              double tmp[MAX_STATE * MAX_STATE];
    303              double Pkk_1[MAX_STATE * MAX_STATE];
    304              double Kk[MAX_STATE * MAX_OBS];
    305              double PxHk[MAX_STATE * MAX_OBS];
    306              double TranHk[MAX_STATE * MAX_OBS];
    307              double KkTmp[MAX_OBS * MAX_OBS];
    308              double h[MAX_OBS];
    309              double KkxHk[MAX_STATE * MAX_STATE];
    310          
    311              //double TranPhikk_1[MAX_STATE * MAX_STATE];
    312                
    313          #ifdef __DEBUG__
    314              if ( (model == NULL) || (mParam == NULL) || (ekfParam == NULL) )
    315              {
    316                  return ERR_MEM_NONE;        // ÊäÈëÊä³öÖ¸ÕëÎª¿Õ
    317              }
    318          #endif
    319          
    320              if (*ekfParam->isFirst == 1)        // µÚÒ»´ÎÖ´ÐÐÂË²¨
   \   00000006   D368               LDR         R3,[R2, #+12]
   \   00000008   1069               LDR         R0,[R2, #+16]
   \   0000000A   0168               LDR         R1,[R0, #+0]
   \   0000000C   0129               CMP         R1,#+1
   \   0000000E   21D1               BNE         ??DoEKF_2
    321              {
    322                  
    323                  *ekfParam->isFirst = 0;
   \   00000010   0021               MOV         R1,#+0
   \   00000012   0160               STR         R1,[R0, #+0]
    324                  // ½«´«ÈëµÄ×´Ì¬Ö±½Óµ±×÷¹À¼ÆÖµ
    325                  for (i=0; i<mParam->lenState; i++)
   \   00000014   0022               MOV         R2,#+0
   \   00000016   11E0               B           ??DoEKF_3
    326                  {
    327                      ekfParam->preEst[i] = mParam->state[i];
   \                     ??DoEKF_4:
   \   00000018   D400               LSL         R4,R2,#+3
   \   0000001A   D948               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   0000001C   6844               ADD         R0,SP
   \   0000001E   0068               LDR         R0,[R0, #+0]
   \   00000020   0068               LDR         R0,[R0, #+0]
   \   00000022   0519               ADD         R5,R0,R4
   \   00000024   1E19               ADD         R6,R3,R4
   \   00000026   03CD               LDMIA       R5!,{R0,R1}
   \   00000028   083D               SUB         R5,#+8
   \   0000002A   03C6               STMIA       R6!,{R0,R1}
    328                      mParam->est[i] = mParam->state[i];
   \   0000002C   D448               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   0000002E   6844               ADD         R0,SP
   \   00000030   0068               LDR         R0,[R0, #+0]
   \   00000032   8068               LDR         R0,[R0, #+8]
   \   00000034   0419               ADD         R4,R0,R4
   \   00000036   03CD               LDMIA       R5!,{R0,R1}
   \   00000038   03C4               STMIA       R4!,{R0,R1}
    329                  }
   \   0000003A   521C               ADD         R2,R2,#+1
   \                     ??DoEKF_3:
   \   0000003C   D048               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   0000003E   6844               ADD         R0,SP
   \   00000040   0068               LDR         R0,[R0, #+0]
   \   00000042   0069               LDR         R0,[R0, #+16]
   \   00000044   8242               CMP         R2,R0
   \   00000046   E7DB               BLT         ??DoEKF_4
    330                  return OK;
   \                     ??DoEKF_5:
   \   00000048   0020               MOV         R0,#+0
   \   0000004A   AC21               MOV         R1,#+172
   \   0000004C   0901               LSL         R1,R1,#+4          ;; #+2752
   \   0000004E   8D44               ADD         SP,R1
   \   00000050   ........           BL          ?Subroutine19
    331              }//if
    332          
    333          // EKFÂË²¨¹ý³Ì
    334             
    335              
    336              // ½øÒ»²½ÂË²¨Xhatkk_1 = Xhatk_1 + T * fxu(Xhatk_1) Ê½(3-60)
    337              model->fxu(ekfParam->preEst, mParam->othParam, fx);
   \                     ??DoEKF_2:
   \   00000054   CB4A               LDR         R2,??DoEKF_1+0x8   ;; 0xa84
   \   00000056   6A44               ADD         R2,SP
   \   00000058   C948               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   0000005A   6844               ADD         R0,SP
   \   0000005C   0068               LDR         R0,[R0, #+0]
   \   0000005E   C168               LDR         R1,[R0, #+12]
   \   00000060   181C               MOV         R0,R3
   \   00000062   C94B               LDR         R3,??DoEKF_1+0xC   ;; 0xab4
   \   00000064   6B44               ADD         R3,SP
   \   00000066   1B68               LDR         R3,[R3, #+0]
   \   00000068   1B68               LDR         R3,[R3, #+0]
   \   0000006A   ........           BL          ??rT_BX_R3
    338              for (i=0; i<mParam->lenState; i++)
   \   0000006E   0024               MOV         R4,#+0
   \   00000070   0BE0               B           ??DoEKF_6
    339              {
    340                  fx[i] *= T;
   \                     ??DoEKF_7:
   \   00000072   E000               LSL         R0,R4,#+3
   \   00000074   C349               LDR         R1,??DoEKF_1+0x8   ;; 0xa84
   \   00000076   6944               ADD         R1,SP
   \   00000078   0D18               ADD         R5,R1,R0
   \   0000007A   0CCD               LDMIA       R5!,{R2,R3}
   \   0000007C   083D               SUB         R5,#+8
   \   0000007E   C348               LDR         R0,??DoEKF_1+0x10  ;; 0x4189374c
   \   00000080   C349               LDR         R1,??DoEKF_1+0x14  ;; 0x3fa0e560
   \   00000082   ........           _BLF        __dMul,??__dMul??rT
   \   00000086   03C5               STMIA       R5!,{R0,R1}
    341              }
   \   00000088   641C               ADD         R4,R4,#+1
   \                     ??DoEKF_6:
   \   0000008A   BD48               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   0000008C   6844               ADD         R0,SP
   \   0000008E   0068               LDR         R0,[R0, #+0]
   \   00000090   0369               LDR         R3,[R0, #+16]
   \   00000092   9C42               CMP         R4,R3
   \   00000094   EDDB               BLT         ??DoEKF_7
    342              AddMatrix(ekfParam->preEst, fx, Xhatkk_1,  mParam->lenState, 1);
   \   00000096   0120               MOV         R0,#+1
   \   00000098   01B4               PUSH        {R0}
   \   0000009A   02AA               ADD         R2,SP,#+8
   \   0000009C   BD49               LDR         R1,??DoEKF_1+0x18  ;; 0xa88
   \   0000009E   6944               ADD         R1,SP
   \   000000A0   AC20               MOV         R0,#+172
   \   000000A2   0001               LSL         R0,R0,#+4          ;; #+2752
   \   000000A4   6844               ADD         R0,SP
   \   000000A6   0068               LDR         R0,[R0, #+0]
   \   000000A8   C068               LDR         R0,[R0, #+12]
   \   000000AA   ........           _BLF        ??AddMatrix,??AddMatrix??rT
   \   000000AE   B448               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   000000B0   6844               ADD         R0,SP
   \   000000B2   0068               LDR         R0,[R0, #+0]
   \   000000B4   0068               LDR         R0,[R0, #+0]
   \   000000B6   B849               LDR         R1,??DoEKF_1+0x1C  ;; ??QGFxu
   \   000000B8   01B0               ADD         SP,#+4
   \   000000BA   8842               CMP         R0,R1
   \   000000BC   02D1               BNE         ??DoEKF_8
    343          
    344              if ( model->fxu == QGFxu)      // Èç¹û×´Ì¬·½³ÌÎªËÄÔªÊýµÄÔòÐèÒª¹éÒ»Q
    345              {
    346                  Norm(Xhatkk_1);       // ¹éÒ»Q
   \   000000BE   01A8               ADD         R0,SP,#+4
   \   000000C0   ........           BL          ??Norm
    347              }
    348          
    349              // ÇóµÃ¹Û²â¾ØÕó¶Ô×´Ì¬µÄÇóµ¼£¬Hk±»ÓÃµÄ´óÐ¡ÎªmParam->lenObs * mParam->lenState
    350              model->hxDot(Xhatkk_1, Hk); 
   \                     ??DoEKF_8:
   \   000000C4   19A9               ADD         R1,SP,#+100
   \   000000C6   01A8               ADD         R0,SP,#+4
   \   000000C8   AF4A               LDR         R2,??DoEKF_1+0xC   ;; 0xab4
   \   000000CA   6A44               ADD         R2,SP
   \   000000CC   1268               LDR         R2,[R2, #+0]
   \   000000CE   D268               LDR         R2,[R2, #+12]
   \   000000D0   ........           BL          ??rT_BX_R2
    351          
    352              // ×´Ì¬×ªÒÆ¾ØÕó,ÀëÉ¢»¯µ¼ÖÂ¾Ø×´Ì¬×ªÒÆÕóÇ°ÃæÐèÒª³ËÒÔT
    353              // Phikk_1±»ÓÃµÄ´óÐ¡ÎªmParam->lenState * mParam->lenState
    354              model->fxDot(ekfParam->preEst, mParam->othParam, Phikk_1);
   \   000000D4   61AA               ADD         R2,SP,#+388
   \   000000D6   AA48               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   000000D8   6844               ADD         R0,SP
   \   000000DA   0068               LDR         R0,[R0, #+0]
   \   000000DC   C168               LDR         R1,[R0, #+12]
   \   000000DE   AF48               LDR         R0,??DoEKF_1+0x20  ;; 0xabc
   \   000000E0   6844               ADD         R0,SP
   \   000000E2   0068               LDR         R0,[R0, #+0]
   \   000000E4   C068               LDR         R0,[R0, #+12]
   \   000000E6   A84B               LDR         R3,??DoEKF_1+0xC   ;; 0xab4
   \   000000E8   6B44               ADD         R3,SP
   \   000000EA   1B68               LDR         R3,[R3, #+0]
   \   000000EC   5B68               LDR         R3,[R3, #+4]
   \   000000EE   ........           BL          ??rT_BX_R3
    355              for (i=0; i<mParam->lenState; i++)
   \   000000F2   0025               MOV         R5,#+0
   \   000000F4   12E0               B           ??DoEKF_9
    356              {
    357                  for (j=0; j<mParam->lenState; j++)
    358                  {
    359                      Phikk_1[i * mParam->lenState + j] *= T;
   \                     ??DoEKF_10:
   \   000000F6   281C               MOV         R0,R5
   \   000000F8   7843               MUL         R0,R7
   \   000000FA   0019               ADD         R0,R0,R4
   \   000000FC   C000               LSL         R0,R0,#+3
   \   000000FE   61A9               ADD         R1,SP,#+388
   \   00000100   0E18               ADD         R6,R1,R0
   \   00000102   03CE               LDMIA       R6!,{R0,R1}
   \   00000104   083E               SUB         R6,#+8
   \   00000106   021C               MOV         R2,R0
   \   00000108   0B1C               MOV         R3,R1
   \   0000010A   A048               LDR         R0,??DoEKF_1+0x10  ;; 0x4189374c
   \   0000010C   A049               LDR         R1,??DoEKF_1+0x14  ;; 0x3fa0e560
   \   0000010E   ........           _BLF        __dMul,??__dMul??rT
   \   00000112   03C6               STMIA       R6!,{R0,R1}
    360                  }
   \   00000114   641C               ADD         R4,R4,#+1
   \                     ??DoEKF_11:
   \   00000116   BC42               CMP         R4,R7
   \   00000118   EDDB               BLT         ??DoEKF_10
   \   0000011A   6D1C               ADD         R5,R5,#+1
   \                     ??DoEKF_9:
   \   0000011C   9848               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   0000011E   6844               ADD         R0,SP
   \   00000120   0068               LDR         R0,[R0, #+0]
   \   00000122   0769               LDR         R7,[R0, #+16]
   \   00000124   BD42               CMP         R5,R7
   \   00000126   01DA               BGE         ??DoEKF_12
   \   00000128   0024               MOV         R4,#+0
   \   0000012A   F4E7               B           ??DoEKF_11
    361              }
    362          
    363              // Ô¤²âÎó²î·½²î¾ØÕóPkk_1
    364              // ¼ÆËãPkk_1£¬ÕâÀï¿¼ÂÇPkk_1Îª¶Ô³Æ¾ØÕó
    365              // ÖÐ¼ä±äÁ¿tmpÓÃµ½µÄ´óÐ¡ÎªmParam->lenState * mParam->lenState
    366              MulMatrix(Phikk_1, ekfParam->Pk, tmp,
    367                        mParam->lenState, mParam->lenState, mParam->lenState);
   \                     ??DoEKF_12:
   \   0000012C   391C               MOV         R1,R7
   \   0000012E   381C               MOV         R0,R7
   \   00000130   03B4               PUSH        {R0,R1}
   \   00000132   3B1C               MOV         R3,R7
   \   00000134   ABAA               ADD         R2,SP,#+684
   \   00000136   9A48               LDR         R0,??DoEKF_1+0x24  ;; 0xac4
   \   00000138   6844               ADD         R0,SP
   \   0000013A   0068               LDR         R0,[R0, #+0]
   \   0000013C   8168               LDR         R1,[R0, #+8]
   \   0000013E   63A8               ADD         R0,SP,#+396
   \   00000140   ........           _BLF        ??MulMatrix,??MulMatrix??rT
    368              // ÕâÀïÁ½¾ØÕóÏà³ËÎª¶Ô³Æ¾ØÕó£¬ËùÒÔ¿ÉÒÔ¼ò»¯
    369              // ³õÊ¼»¯Pkk_1,±»ÓÃµ½µÄ´óÐ¡ÎªmParam->lenState * mParam->lenState
    370              for (i=0; i<mParam->lenState; i++)
   \   00000144   0022               MOV         R2,#+0
   \   00000146   02B0               ADD         SP,#+8
   \   00000148   0DE0               B           ??DoEKF_13
    371              {
    372                  for (j=0; j<=i; j++)
   \                     ??DoEKF_14:
   \   0000014A   0024               MOV         R4,#+0
    373                  {
    374                      Pkk_1[i * mParam->lenState + j] = 0.0;    // ½«Êä³ö¾ØÕóÏÂÈý½Ç³õÊ¼»¯Îª0
   \                     ??DoEKF_15:
   \   0000014C   101C               MOV         R0,R2
   \   0000014E   7843               MUL         R0,R7
   \   00000150   0019               ADD         R0,R0,R4
   \   00000152   C000               LSL         R0,R0,#+3
   \   00000154   F1A9               ADD         R1,SP,#+964
   \   00000156   0B18               ADD         R3,R1,R0
   \   00000158   0020               MOV         R0,#+0
   \   0000015A   0021               MOV         R1,#+0
   \   0000015C   03C3               STMIA       R3!,{R0,R1}
    375                  }
   \   0000015E   641C               ADD         R4,R4,#+1
   \   00000160   A242               CMP         R2,R4
   \   00000162   F3DA               BGE         ??DoEKF_15
    376              }
   \   00000164   521C               ADD         R2,R2,#+1
   \                     ??DoEKF_13:
   \   00000166   8648               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   00000168   6844               ADD         R0,SP
   \   0000016A   0068               LDR         R0,[R0, #+0]
   \   0000016C   0769               LDR         R7,[R0, #+16]
   \   0000016E   BA42               CMP         R2,R7
   \   00000170   EBDB               BLT         ??DoEKF_14
    377              for (i=0; i<mParam->lenState; i++)        // ¾ØÕóÏà³Ë
   \   00000172   0020               MOV         R0,#+0
   \   00000174   2BE0               B           ??DoEKF_16
    378              {
    379                  for (j=0; j<=i; j++)
    380                  {
    381                      for (k=0; k<mParam->lenState; k++)
    382                      {
    383                          // ÕâÀï³ËÒÔPhikk_1µÄ×ªÖÃ
    384                          Pkk_1[i * mParam->lenState + j] += 
    385                              tmp[i * mParam->lenState + k] *  Phikk_1[j * mParam->lenState + k];
   \                     ??DoEKF_17:
   \   00000176   4019               ADD         R0,R0,R5
   \   00000178   C000               LSL         R0,R0,#+3
   \   0000017A   A9A9               ADD         R1,SP,#+676
   \   0000017C   0818               ADD         R0,R1,R0
   \   0000017E   03C8               LDMIA       R0!,{R0,R1}
   \   00000180   03B4               PUSH        {R0,R1}
   \   00000182   5019               ADD         R0,R2,R5
   \   00000184   C000               LSL         R0,R0,#+3
   \   00000186   63A9               ADD         R1,SP,#+396
   \   00000188   0818               ADD         R0,R1,R0
   \   0000018A   03C8               LDMIA       R0!,{R0,R1}
   \   0000018C   0CBC               POP         {R2,R3}
   \   0000018E   ........           _BLF        __dMul,??__dMul??rT
   \   00000192   021C               MOV         R2,R0
   \   00000194   0B1C               MOV         R3,R1
   \   00000196   03CE               LDMIA       R6!,{R0,R1}
   \   00000198   083E               SUB         R6,#+8
   \   0000019A   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000019E   03C6               STMIA       R6!,{R0,R1}
    386                      }
   \   000001A0   6D1C               ADD         R5,R5,#+1
   \                     ??DoEKF_18:
   \   000001A2   0098               LDR         R0,[SP, #+0]
   \   000001A4   7843               MUL         R0,R7
   \   000001A6   0119               ADD         R1,R0,R4
   \   000001A8   C900               LSL         R1,R1,#+3
   \   000001AA   F1AA               ADD         R2,SP,#+964
   \   000001AC   5618               ADD         R6,R2,R1
   \   000001AE   221C               MOV         R2,R4
   \   000001B0   7A43               MUL         R2,R7
   \   000001B2   BD42               CMP         R5,R7
   \   000001B4   DFDB               BLT         ??DoEKF_17
    387                      Pkk_1[j * mParam->lenState + i] = Pkk_1[i * mParam->lenState + j];        // ¶Ô³ÆµÄÔªËØ
   \   000001B6   0098               LDR         R0,[SP, #+0]
   \   000001B8   1018               ADD         R0,R2,R0
   \   000001BA   C000               LSL         R0,R0,#+3
   \   000001BC   F1A9               ADD         R1,SP,#+964
   \   000001BE   0A18               ADD         R2,R1,R0
   \   000001C0   03CE               LDMIA       R6!,{R0,R1}
   \   000001C2   03C2               STMIA       R2!,{R0,R1}
   \   000001C4   641C               ADD         R4,R4,#+1
   \   000001C6   0098               LDR         R0,[SP, #+0]
   \   000001C8   A042               CMP         R0,R4
   \   000001CA   05DA               BGE         ??DoEKF_19
   \   000001CC   401C               ADD         R0,R0,#+1
   \                     ??DoEKF_16:
   \   000001CE   0090               STR         R0,[SP, #+0]
   \   000001D0   0098               LDR         R0,[SP, #+0]
   \   000001D2   B842               CMP         R0,R7
   \   000001D4   02DA               BGE         ??DoEKF_20
   \   000001D6   0024               MOV         R4,#+0
   \                     ??DoEKF_19:
   \   000001D8   0025               MOV         R5,#+0
   \   000001DA   E2E7               B           ??DoEKF_18
    388                  }
    389              }
    390          
    391              for (i=0; i<mParam->lenState; i++)
   \                     ??DoEKF_20:
   \   000001DC   0024               MOV         R4,#+0
   \   000001DE   14E0               B           ??DoEKF_21
    392              {
    393                  // ¼ÓÉÏQÕó£¬ÕâÀïÖ»Òª¼ÓÉÏ¶Ô½ÇÏßÉÏµÄÔªËØ¼´¿É
    394                  Pkk_1[i * mParam->lenState + i] += ekfParam->Q[i];
   \                     ??DoEKF_22:
   \   000001E0   201C               MOV         R0,R4
   \   000001E2   7843               MUL         R0,R7
   \   000001E4   0019               ADD         R0,R0,R4
   \   000001E6   C000               LSL         R0,R0,#+3
   \   000001E8   F1A9               ADD         R1,SP,#+964
   \   000001EA   0D18               ADD         R5,R1,R0
   \   000001EC   03CD               LDMIA       R5!,{R0,R1}
   \   000001EE   083D               SUB         R5,#+8
   \   000001F0   021C               MOV         R2,R0
   \   000001F2   0B1C               MOV         R3,R1
   \   000001F4   E000               LSL         R0,R4,#+3
   \   000001F6   6949               LDR         R1,??DoEKF_1+0x20  ;; 0xabc
   \   000001F8   6944               ADD         R1,SP
   \   000001FA   0968               LDR         R1,[R1, #+0]
   \   000001FC   0968               LDR         R1,[R1, #+0]
   \   000001FE   0818               ADD         R0,R1,R0
   \   00000200   03C8               LDMIA       R0!,{R0,R1}
   \   00000202   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000206   03C5               STMIA       R5!,{R0,R1}
    395              }
   \   00000208   641C               ADD         R4,R4,#+1
   \                     ??DoEKF_21:
   \   0000020A   BC42               CMP         R4,R7
   \   0000020C   E8DB               BLT         ??DoEKF_22
    396          
    397              // ÇóÈ¡ÂË²¨ÔöÒæ¾ØÕó Ê½(3-62)
    398              TranMatrix(Hk, TranHk, mParam->lenObs, mParam->lenState);
   \   0000020E   3B1C               MOV         R3,R7
   \   00000210   5B48               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   00000212   6844               ADD         R0,SP
   \   00000214   0068               LDR         R0,[R0, #+0]
   \   00000216   4269               LDR         R2,[R0, #+20]
   \   00000218   CE49               LDR         R1,??DoEKF_23      ;; 0x724
   \   0000021A   6944               ADD         R1,SP
   \   0000021C   19A8               ADD         R0,SP,#+100
   \   0000021E   ........           _BLF        ??TranMatrix,??TranMatrix??rT
    399              // PxHk±»ÓÃµ½µÄ´óÐ¡Îª mParam->lenState * mParam->lenObs
    400              MulMatrix(Pkk_1, TranHk, PxHk, mParam->lenState, mParam->lenState, mParam->lenObs);
   \   00000222   5748               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   00000224   6844               ADD         R0,SP
   \   00000226   0068               LDR         R0,[R0, #+0]
   \   00000228   0369               LDR         R3,[R0, #+16]
   \   0000022A   5548               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   0000022C   6844               ADD         R0,SP
   \   0000022E   0068               LDR         R0,[R0, #+0]
   \   00000230   4169               LDR         R1,[R0, #+20]
   \   00000232   181C               MOV         R0,R3
   \   00000234   03B4               PUSH        {R0,R1}
   \   00000236   C84A               LDR         R2,??DoEKF_23+0x4  ;; 0x60c
   \   00000238   6A44               ADD         R2,SP
   \   0000023A   C849               LDR         R1,??DoEKF_23+0x8  ;; 0x72c
   \   0000023C   6944               ADD         R1,SP
   \   0000023E   F3A8               ADD         R0,SP,#+972
   \   00000240   ........           _BLF        ??MulMatrix,??MulMatrix??rT
    401              // KkTmp±»ÓÃµ½µÄ´óÐ¡ÎªmParam->lenObs * mParam->lenObs
    402              MulMatrix(Hk, PxHk, KkTmp, mParam->lenObs, mParam->lenState, mParam->lenObs);
   \   00000244   AC20               MOV         R0,#+172
   \   00000246   0001               LSL         R0,R0,#+4          ;; #+2752
   \   00000248   6844               ADD         R0,SP
   \   0000024A   0068               LDR         R0,[R0, #+0]
   \   0000024C   4369               LDR         R3,[R0, #+20]
   \   0000024E   191C               MOV         R1,R3
   \   00000250   AC20               MOV         R0,#+172
   \   00000252   0001               LSL         R0,R0,#+4          ;; #+2752
   \   00000254   6844               ADD         R0,SP
   \   00000256   0068               LDR         R0,[R0, #+0]
   \   00000258   0069               LDR         R0,[R0, #+16]
   \   0000025A   03B4               PUSH        {R0,R1}
   \   0000025C   C04A               LDR         R2,??DoEKF_23+0xC  ;; 0x854
   \   0000025E   6A44               ADD         R2,SP
   \   00000260   C049               LDR         R1,??DoEKF_23+0x10  ;; 0x614
   \   00000262   6944               ADD         R1,SP
   \   00000264   1DA8               ADD         R0,SP,#+116
   \   00000266   ........           _BLF        ??MulMatrix,??MulMatrix??rT
    403          
    404              // Hk*Pkk_1*Hk' + R£¬¿¼ÂÇµ½RÎª¶Ô½Ç¾ØÕó£¬ËùÒÔ²»ÓÃ°´Ò»°ãÏà³Ë¼ÆËã
    405              // Ö»ÐèÒª¼Ó¶Ô½ÇÏßÔªËØ¼´¿É
    406              for (i=0; i<mParam->lenObs; i++)
   \   0000026A   0024               MOV         R4,#+0
   \   0000026C   04B0               ADD         SP,#+16
   \   0000026E   12E0               B           ??DoEKF_24
    407              {
    408                  KkTmp[i * mParam->lenObs + i] += ekfParam->R[i];
   \                     ??DoEKF_25:
   \   00000270   6243               MUL         R2,R4
   \   00000272   1019               ADD         R0,R2,R4
   \   00000274   C000               LSL         R0,R0,#+3
   \   00000276   BC49               LDR         R1,??DoEKF_23+0x14  ;; 0x844
   \   00000278   6944               ADD         R1,SP
   \   0000027A   0D18               ADD         R5,R1,R0
   \   0000027C   03CD               LDMIA       R5!,{R0,R1}
   \   0000027E   083D               SUB         R5,#+8
   \   00000280   E200               LSL         R2,R4,#+3
   \   00000282   464B               LDR         R3,??DoEKF_1+0x20  ;; 0xabc
   \   00000284   6B44               ADD         R3,SP
   \   00000286   1B68               LDR         R3,[R3, #+0]
   \   00000288   5B68               LDR         R3,[R3, #+4]
   \   0000028A   9A18               ADD         R2,R3,R2
   \   0000028C   0CCA               LDMIA       R2!,{R2,R3}
   \   0000028E   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000292   03C5               STMIA       R5!,{R0,R1}
    409              }
   \   00000294   641C               ADD         R4,R4,#+1
   \                     ??DoEKF_24:
   \   00000296   3A48               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   00000298   6844               ADD         R0,SP
   \   0000029A   0068               LDR         R0,[R0, #+0]
   \   0000029C   4269               LDR         R2,[R0, #+20]
   \   0000029E   9442               CMP         R4,R2
   \   000002A0   E6DB               BLT         ??DoEKF_25
    410          
    411              // Hk*Pkk_1*Hk' + R ¶Ô³Æ¾ØÕó
    412              if ( InvSymMtrx(KkTmp, KkTmp, mParam->lenObs) != OK )
   \   000002A2   B149               LDR         R1,??DoEKF_23+0x14  ;; 0x844
   \   000002A4   6944               ADD         R1,SP
   \   000002A6   B048               LDR         R0,??DoEKF_23+0x14  ;; 0x844
   \   000002A8   6844               ADD         R0,SP
   \   000002AA   ........           _BLF        ??InvSymMtrx,??InvSymMtrx??rT
   \   000002AE   0028               CMP         R0,#+0
   \   000002B0   1ED0               BEQ         ??DoEKF_26
    413              {
    414                  // Èç¹ûHk*Pkk_1*Hk' + RÆæÒìÎÞ·¨ÇóÄæ
    415                  // Ôò½«´«ÈëµÄ×´Ì¬Ö±½Óµ±×÷¹À¼ÆÖµ
    416                  for (i=0; i<mParam->lenState; i++)
   \   000002B2   0022               MOV         R2,#+0
   \                     ??DoEKF_27:
   \   000002B4   3248               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   000002B6   6844               ADD         R0,SP
   \   000002B8   0068               LDR         R0,[R0, #+0]
   \   000002BA   0069               LDR         R0,[R0, #+16]
   \   000002BC   8242               CMP         R2,R0
   \   000002BE   ....               BLT         .+5
   \   000002C0   C2E6               B           ??DoEKF_5
    417                  {
    418                      ekfParam->preEst[i] = mParam->state[i];
   \   000002C2   D300               LSL         R3,R2,#+3
   \   000002C4   2E48               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   000002C6   6844               ADD         R0,SP
   \   000002C8   0068               LDR         R0,[R0, #+0]
   \   000002CA   0068               LDR         R0,[R0, #+0]
   \   000002CC   C418               ADD         R4,R0,R3
   \   000002CE   3348               LDR         R0,??DoEKF_1+0x20  ;; 0xabc
   \   000002D0   6844               ADD         R0,SP
   \   000002D2   0068               LDR         R0,[R0, #+0]
   \   000002D4   C068               LDR         R0,[R0, #+12]
   \   000002D6   C518               ADD         R5,R0,R3
   \   000002D8   03CC               LDMIA       R4!,{R0,R1}
   \   000002DA   083C               SUB         R4,#+8
   \   000002DC   03C5               STMIA       R5!,{R0,R1}
    419                      mParam->est[i] = mParam->state[i];
   \   000002DE   2848               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   000002E0   6844               ADD         R0,SP
   \   000002E2   0068               LDR         R0,[R0, #+0]
   \   000002E4   8068               LDR         R0,[R0, #+8]
   \   000002E6   C318               ADD         R3,R0,R3
   \   000002E8   03CC               LDMIA       R4!,{R0,R1}
   \   000002EA   03C3               STMIA       R3!,{R0,R1}
    420                  }
   \   000002EC   521C               ADD         R2,R2,#+1
   \   000002EE   E1E7               B           ??DoEKF_27
    421                  return OK;
    422              }
    423          
    424              // Kk±»ÓÃµ½µÄ´óÐ¡ÎªmParam->lenState * mParam->lenObs
    425              MulMatrix(PxHk, KkTmp, Kk, mParam->lenState, mParam->lenObs, mParam->lenObs);
   \                     ??DoEKF_26:
   \   000002F0   2348               LDR         R0,??DoEKF_1+0x4   ;; 0xab8
   \   000002F2   6844               ADD         R0,SP
   \   000002F4   0068               LDR         R0,[R0, #+0]
   \   000002F6   4069               LDR         R0,[R0, #+20]
   \   000002F8   011C               MOV         R1,R0
   \   000002FA   03B4               PUSH        {R0,R1}
   \   000002FC   AC20               MOV         R0,#+172
   \   000002FE   0001               LSL         R0,R0,#+4          ;; #+2752
   \   00000300   6844               ADD         R0,SP
   \   00000302   0068               LDR         R0,[R0, #+0]
   \   00000304   0369               LDR         R3,[R0, #+16]
   \   00000306   FFAA               ADD         R2,SP,#+1020
   \   00000308   F032               ADD         R2,#+240
   \   0000030A   9849               LDR         R1,??DoEKF_23+0x18  ;; 0x84c
   \   0000030C   6944               ADD         R1,SP
   \   0000030E   9248               LDR         R0,??DoEKF_23+0x4  ;; 0x60c
   \   00000310   6844               ADD         R0,SP
   \   00000312   ........           _BLF        ??MulMatrix,??MulMatrix??rT
    426          
    427              // ×´Ì¬¹À¼Æ
    428              model->hx(Xhatkk_1, h);
   \   00000316   0FA9               ADD         R1,SP,#+60
   \   00000318   03A8               ADD         R0,SP,#+12
   \   0000031A   204A               LDR         R2,??DoEKF_1+0x20  ;; 0xabc
   \   0000031C   6A44               ADD         R2,SP
   \   0000031E   1268               LDR         R2,[R2, #+0]
   \   00000320   9268               LDR         R2,[R2, #+8]
   \   00000322   ........           BL          ??rT_BX_R2
    429              SubMatrix( mParam->obs, h, h, mParam->lenObs, 1);        // h = obs - hx(Xhatkk_1)
   \   00000326   0120               MOV         R0,#+1
   \   00000328   01B4               PUSH        {R0}
   \   0000032A   1D48               LDR         R0,??DoEKF_1+0x24  ;; 0xac4
   \   0000032C   6844               ADD         R0,SP
   \   0000032E   0068               LDR         R0,[R0, #+0]
   \   00000330   4369               LDR         R3,[R0, #+20]
   \   00000332   10AA               ADD         R2,SP,#+64
   \   00000334   10A9               ADD         R1,SP,#+64
   \   00000336   1A48               LDR         R0,??DoEKF_1+0x24  ;; 0xac4
   \   00000338   6844               ADD         R0,SP
   \   0000033A   0068               LDR         R0,[R0, #+0]
   \   0000033C   4068               LDR         R0,[R0, #+4]
   \   0000033E   ........           _BLF        ??SubMatrix,??SubMatrix??rT
    430               //----------------------- syc 2011.11.14------------------------------//
    431             if ( model->fxu == QGFxu)     // Èç¹û×´Ì¬·½³ÌÎªËÄÔªÊýµÄÔòÐèÒªµ÷Õû½Ç¶È
   \   00000342   AC20               MOV         R0,#+172
   \   00000344   0001               LSL         R0,R0,#+4          ;; #+2752
   \   00000346   6844               ADD         R0,SP
   \   00000348   0068               LDR         R0,[R0, #+0]
   \   0000034A   0068               LDR         R0,[R0, #+0]
   \   0000034C   1249               LDR         R1,??DoEKF_1+0x1C  ;; ??QGFxu
   \   0000034E   03B0               ADD         SP,#+12
   \   00000350   8842               CMP         R0,R1
   \   00000352   39D1               BNE         ??DoEKF_28
    432              {
    433                for(int i=0;i<3;i++)
   \   00000354   0026               MOV         R6,#+0
    434                {
    435                  if(h[i]>PI)
   \                     ??DoEKF_29:
   \   00000356   F000               LSL         R0,R6,#+3
   \   00000358   0DA9               ADD         R1,SP,#+52
   \   0000035A   0F18               ADD         R7,R1,R0
   \   0000035C   30CF               LDMIA       R7!,{R4,R5}
   \   0000035E   083F               SUB         R7,#+8
   \   00000360   201C               MOV         R0,R4
   \   00000362   291C               MOV         R1,R5
   \   00000364   824A               LDR         R2,??DoEKF_23+0x1C  ;; 0x53c8d4f2
   \   00000366   834B               LDR         R3,??DoEKF_23+0x20  ;; 0x400921fb
   \   00000368   ........           _BLF        __dGreaterEqual,??__dGreaterEqual??rT
   \   0000036C   0028               CMP         R0,#+0
   \   0000036E   19D0               BEQ         ??DoEKF_30
    436                    h[i]-=2.0*PI;
   \   00000370   221C               MOV         R2,R4
   \   00000372   2B1C               MOV         R3,R5
   \   00000374   8048               LDR         R0,??DoEKF_23+0x24  ;; 0x53c8d4f1
   \   00000376   8149               LDR         R1,??DoEKF_23+0x28  ;; 0xc01921fb
   \   00000378   20E0               B           ??DoEKF_31
   \   0000037A   C046               NOP         
   \                     ??DoEKF_1:
   \   0000037C   4CF5FFFF           DC32        0xfffff54c
   \   00000380   B80A0000           DC32        0xab8
   \   00000384   840A0000           DC32        0xa84
   \   00000388   B40A0000           DC32        0xab4
   \   0000038C   4C378941           DC32        0x4189374c
   \   00000390   60E5A03F           DC32        0x3fa0e560
   \   00000394   880A0000           DC32        0xa88
   \   00000398   ........           DC32        ??QGFxu
   \   0000039C   BC0A0000           DC32        0xabc
   \   000003A0   C40A0000           DC32        0xac4
    437                  else
    438                    if(h[i]<-PI)
   \                     ??DoEKF_30:
   \   000003A4   201C               MOV         R0,R4
   \   000003A6   291C               MOV         R1,R5
   \   000003A8   734A               LDR         R2,??DoEKF_23+0x24  ;; 0x53c8d4f1
   \   000003AA   754B               LDR         R3,??DoEKF_23+0x2C  ;; 0xc00921fb
   \   000003AC   ........           _BLF        __dLess,??__dLess??rT
   \   000003B0   0028               CMP         R0,#+0
   \   000003B2   06D0               BEQ         ??DoEKF_32
    439                      h[i]+=2.0*PI; 
   \   000003B4   221C               MOV         R2,R4
   \   000003B6   2B1C               MOV         R3,R5
   \   000003B8   6F48               LDR         R0,??DoEKF_23+0x24  ;; 0x53c8d4f1
   \   000003BA   7249               LDR         R1,??DoEKF_23+0x30  ;; 0x401921fb
   \                     ??DoEKF_31:
   \   000003BC   ........           _BLF        __dAdd,??__dAdd??rT
   \   000003C0   03C7               STMIA       R7!,{R0,R1}
    440                }
   \                     ??DoEKF_32:
   \   000003C2   761C               ADD         R6,R6,#+1
   \   000003C4   032E               CMP         R6,#+3
   \   000003C6   C6DB               BLT         ??DoEKF_29
    441              }
    442              //------------------------------------------------------------------//
    443              MulMatrix(Kk, h, ekfParam->preEst, mParam->lenState, mParam->lenObs, 1);
   \                     ??DoEKF_28:
   \   000003C8   0120               MOV         R0,#+1
   \   000003CA   01B4               PUSH        {R0}
   \   000003CC   6E48               LDR         R0,??DoEKF_23+0x34  ;; 0xabc
   \   000003CE   6844               ADD         R0,SP
   \   000003D0   0068               LDR         R0,[R0, #+0]
   \   000003D2   4069               LDR         R0,[R0, #+20]
   \   000003D4   01B4               PUSH        {R0}
   \   000003D6   AC20               MOV         R0,#+172
   \   000003D8   0001               LSL         R0,R0,#+4          ;; #+2752
   \   000003DA   6844               ADD         R0,SP
   \   000003DC   0068               LDR         R0,[R0, #+0]
   \   000003DE   0369               LDR         R3,[R0, #+16]
   \   000003E0   6A48               LDR         R0,??DoEKF_23+0x38  ;; 0xac4
   \   000003E2   6844               ADD         R0,SP
   \   000003E4   0068               LDR         R0,[R0, #+0]
   \   000003E6   C268               LDR         R2,[R0, #+12]
   \   000003E8   0FA9               ADD         R1,SP,#+60
   \   000003EA   FFA8               ADD         R0,SP,#+1020
   \   000003EC   F030               ADD         R0,#+240
   \   000003EE   ........           _BLF        ??MulMatrix,??MulMatrix??rT
    444              // ekfParam->preEstÊÇ±¾´ÎÇóµÃµÄÂË²¨Öµ
    445              AddMatrix(ekfParam->preEst, Xhatkk_1, ekfParam->preEst, mParam->lenState, 1);
   \   000003F2   6648               LDR         R0,??DoEKF_23+0x38  ;; 0xac4
   \   000003F4   6844               ADD         R0,SP
   \   000003F6   0068               LDR         R0,[R0, #+0]
   \   000003F8   C068               LDR         R0,[R0, #+12]
   \   000003FA   0121               MOV         R1,#+1
   \   000003FC   02B4               PUSH        {R1}
   \   000003FE   6349               LDR         R1,??DoEKF_23+0x38  ;; 0xac4
   \   00000400   6944               ADD         R1,SP
   \   00000402   0968               LDR         R1,[R1, #+0]
   \   00000404   0B69               LDR         R3,[R1, #+16]
   \   00000406   021C               MOV         R2,R0
   \   00000408   04A9               ADD         R1,SP,#+16
   \   0000040A   ........           _BLF        ??AddMatrix,??AddMatrix??rT
    446          
    447              if ( model->fxu == QGFxu)     // Èç¹û×´Ì¬·½³ÌÎªËÄÔªÊýµÄÔòÐèÒª¹éÒ»Q
   \   0000040E   AC20               MOV         R0,#+172
   \   00000410   0001               LSL         R0,R0,#+4          ;; #+2752
   \   00000412   6844               ADD         R0,SP
   \   00000414   0068               LDR         R0,[R0, #+0]
   \   00000416   0068               LDR         R0,[R0, #+0]
   \   00000418   ....               LDR         R1,??DataTable10   ;; ??QGFxu
   \   0000041A   03B0               ADD         SP,#+12
   \   0000041C   8842               CMP         R0,R1
   \   0000041E   05D1               BNE         ??DoEKF_33
    448              {
    449                  Norm(ekfParam->preEst);   // ¹éÒ»Q
   \   00000420   5948               LDR         R0,??DoEKF_23+0x34  ;; 0xabc
   \   00000422   6844               ADD         R0,SP
   \   00000424   0068               LDR         R0,[R0, #+0]
   \   00000426   C068               LDR         R0,[R0, #+12]
   \   00000428   ........           BL          ??Norm
    450              }
    451          
    452              // ÂË²¨·½²î¾ØÕó
    453              // Kk±»ÓÃµ½µÄ´óÐ¡ÎªmParam->lenState * mParam->lenState
    454              MulMatrix(Kk, Hk, KkxHk, mParam->lenState, mParam->lenObs, mParam->lenState);
   \                     ??DoEKF_33:
   \   0000042C   5848               LDR         R0,??DoEKF_23+0x3C  ;; 0xab8
   \   0000042E   6844               ADD         R0,SP
   \   00000430   0068               LDR         R0,[R0, #+0]
   \   00000432   0369               LDR         R3,[R0, #+16]
   \   00000434   191C               MOV         R1,R3
   \   00000436   5648               LDR         R0,??DoEKF_23+0x3C  ;; 0xab8
   \   00000438   6844               ADD         R0,SP
   \   0000043A   0068               LDR         R0,[R0, #+0]
   \   0000043C   4069               LDR         R0,[R0, #+20]
   \   0000043E   03B4               PUSH        {R0,R1}
   \   00000440   544A               LDR         R2,??DoEKF_23+0x40  ;; 0x96c
   \   00000442   6A44               ADD         R2,SP
   \   00000444   1BA9               ADD         R1,SP,#+108
   \   00000446   FFA8               ADD         R0,SP,#+1020
   \   00000448   F030               ADD         R0,#+240
   \   0000044A   ........           _BLF        ??MulMatrix,??MulMatrix??rT
    455              for (i=0; i<mParam->lenState; i++)
   \   0000044E   0025               MOV         R5,#+0
   \   00000450   02B0               ADD         SP,#+8
   \   00000452   00E0               B           ??DoEKF_34
   \                     ??DoEKF_35:
   \   00000454   6D1C               ADD         R5,R5,#+1
   \                     ??DoEKF_34:
   \   00000456   4E48               LDR         R0,??DoEKF_23+0x3C  ;; 0xab8
   \   00000458   6844               ADD         R0,SP
   \   0000045A   0068               LDR         R0,[R0, #+0]
   \   0000045C   0769               LDR         R7,[R0, #+16]
   \   0000045E   BD42               CMP         R5,R7
   \   00000460   17DA               BGE         ??DoEKF_36
    456              {
    457                  for (j=0; j<mParam->lenState; j++)
   \   00000462   0024               MOV         R4,#+0
   \   00000464   0FE0               B           ??DoEKF_37
    458                  {
    459                      KkxHk[i * mParam->lenState + j] = (i == j) - KkxHk[i * mParam->lenState + j];
   \                     ??DoEKF_38:
   \   00000466   0020               MOV         R0,#+0
   \                     ??DoEKF_39:
   \   00000468   291C               MOV         R1,R5
   \   0000046A   7943               MUL         R1,R7
   \   0000046C   0919               ADD         R1,R1,R4
   \   0000046E   C900               LSL         R1,R1,#+3
   \   00000470   494A               LDR         R2,??DoEKF_23+0x44  ;; 0x964
   \   00000472   6A44               ADD         R2,SP
   \   00000474   5618               ADD         R6,R2,R1
   \   00000476   ........           _BLF        __ulongToDouble,??__ulongToDouble??rT
   \   0000047A   0CCE               LDMIA       R6!,{R2,R3}
   \   0000047C   083E               SUB         R6,#+8
   \   0000047E   ........           _BLF        __dSub,??__dSub??rT
   \   00000482   03C6               STMIA       R6!,{R0,R1}
   \   00000484   641C               ADD         R4,R4,#+1
   \                     ??DoEKF_37:
   \   00000486   BC42               CMP         R4,R7
   \   00000488   E4DA               BGE         ??DoEKF_35
   \   0000048A   A542               CMP         R5,R4
   \   0000048C   EBD1               BNE         ??DoEKF_38
   \   0000048E   0120               MOV         R0,#+1
   \   00000490   EAE7               B           ??DoEKF_39
    460                  }
    461              }
    462             // MulMatrix(KkxHk, Pkk_1, ekfParam->Pk, mParam->lenState, mParam->lenState, mParam->lenState);
    463              for (i=0; i<mParam->lenState; i++)
   \                     ??DoEKF_36:
   \   00000492   0022               MOV         R2,#+0
   \   00000494   10E0               B           ??DoEKF_40
    464              {
    465                  for (j=0; j<=i; j++)
   \                     ??DoEKF_41:
   \   00000496   0024               MOV         R4,#+0
    466                  {
    467                      ekfParam->Pk[i*mParam->lenState + j] = 0.0;    // PkÏÂÈý½Ç¾ØÕóÎªÁã
   \                     ??DoEKF_42:
   \   00000498   101C               MOV         R0,R2
   \   0000049A   7843               MUL         R0,R7
   \   0000049C   0019               ADD         R0,R0,R4
   \   0000049E   C000               LSL         R0,R0,#+3
   \   000004A0   3949               LDR         R1,??DoEKF_23+0x34  ;; 0xabc
   \   000004A2   6944               ADD         R1,SP
   \   000004A4   0968               LDR         R1,[R1, #+0]
   \   000004A6   8968               LDR         R1,[R1, #+8]
   \   000004A8   0B18               ADD         R3,R1,R0
   \   000004AA   0020               MOV         R0,#+0
   \   000004AC   0021               MOV         R1,#+0
   \   000004AE   03C3               STMIA       R3!,{R0,R1}
    468                  }
   \   000004B0   641C               ADD         R4,R4,#+1
   \   000004B2   A242               CMP         R2,R4
   \   000004B4   F0DA               BGE         ??DoEKF_42
    469              }
   \   000004B6   521C               ADD         R2,R2,#+1
   \                     ??DoEKF_40:
   \   000004B8   BA42               CMP         R2,R7
   \   000004BA   ECDB               BLT         ??DoEKF_41
    470          
    471              for (i=0; i<mParam->lenState; i++)        // ¾ØÕóÏà³Ë
   \   000004BC   0020               MOV         R0,#+0
   \   000004BE   2EE0               B           ??DoEKF_43
    472              {
    473                  for (j=0; j<=i; j++)
    474                  {
    475                      for (k=0; k<mParam->lenState; k++)
    476                      {
    477                          ekfParam->Pk[i*mParam->lenState + j] +=
    478                              KkxHk[i * mParam->lenState + k] *  Pkk_1[k * mParam->lenState + j];
   \                     ??DoEKF_44:
   \   000004C0   4019               ADD         R0,R0,R5
   \   000004C2   C000               LSL         R0,R0,#+3
   \   000004C4   3449               LDR         R1,??DoEKF_23+0x44  ;; 0x964
   \   000004C6   6944               ADD         R1,SP
   \   000004C8   0818               ADD         R0,R1,R0
   \   000004CA   0CC8               LDMIA       R0!,{R2,R3}
   \   000004CC   281C               MOV         R0,R5
   \   000004CE   7843               MUL         R0,R7
   \   000004D0   0019               ADD         R0,R0,R4
   \   000004D2   C000               LSL         R0,R0,#+3
   \   000004D4   F1A9               ADD         R1,SP,#+964
   \   000004D6   0818               ADD         R0,R1,R0
   \   000004D8   03C8               LDMIA       R0!,{R0,R1}
   \   000004DA   ........           _BLF        __dMul,??__dMul??rT
   \   000004DE   021C               MOV         R2,R0
   \   000004E0   0B1C               MOV         R3,R1
   \   000004E2   03CE               LDMIA       R6!,{R0,R1}
   \   000004E4   083E               SUB         R6,#+8
   \   000004E6   ........           _BLF        __dAdd,??__dAdd??rT
   \   000004EA   03C6               STMIA       R6!,{R0,R1}
    479                      }
   \   000004EC   6D1C               ADD         R5,R5,#+1
   \                     ??DoEKF_45:
   \   000004EE   0098               LDR         R0,[SP, #+0]
   \   000004F0   7843               MUL         R0,R7
   \   000004F2   2549               LDR         R1,??DoEKF_23+0x34  ;; 0xabc
   \   000004F4   6944               ADD         R1,SP
   \   000004F6   0968               LDR         R1,[R1, #+0]
   \   000004F8   8968               LDR         R1,[R1, #+8]
   \   000004FA   0219               ADD         R2,R0,R4
   \   000004FC   D200               LSL         R2,R2,#+3
   \   000004FE   8E18               ADD         R6,R1,R2
   \   00000500   BD42               CMP         R5,R7
   \   00000502   DDDB               BLT         ??DoEKF_44
    480                      // ¶Ô³ÆµÄÔªËØ
    481                      ekfParam->Pk[j*mParam->lenState + i] = ekfParam->Pk[i*mParam->lenState + j];
   \   00000504   201C               MOV         R0,R4
   \   00000506   7843               MUL         R0,R7
   \   00000508   009A               LDR         R2,[SP, #+0]
   \   0000050A   8018               ADD         R0,R0,R2
   \   0000050C   C000               LSL         R0,R0,#+3
   \   0000050E   0A18               ADD         R2,R1,R0
   \   00000510   03CE               LDMIA       R6!,{R0,R1}
   \   00000512   03C2               STMIA       R2!,{R0,R1}
   \   00000514   641C               ADD         R4,R4,#+1
   \   00000516   0098               LDR         R0,[SP, #+0]
   \   00000518   A042               CMP         R0,R4
   \   0000051A   05DA               BGE         ??DoEKF_46
   \   0000051C   401C               ADD         R0,R0,#+1
   \                     ??DoEKF_43:
   \   0000051E   0090               STR         R0,[SP, #+0]
   \   00000520   0098               LDR         R0,[SP, #+0]
   \   00000522   B842               CMP         R0,R7
   \   00000524   02DA               BGE         ??DoEKF_47
   \   00000526   0024               MOV         R4,#+0
   \                     ??DoEKF_46:
   \   00000528   0025               MOV         R5,#+0
   \   0000052A   E0E7               B           ??DoEKF_45
    482                  }
    483              }
    484          
    485              // ½«½á¹û¸´ÖÆµ½Ä¿µÄµØÖ·
    486              for (i=0; i<mParam->lenState; i++)
   \                     ??DoEKF_47:
   \   0000052C   0022               MOV         R2,#+0
   \                     ??DoEKF_48:
   \   0000052E   BA42               CMP         R2,R7
   \   00000530   ....               BLT         .+5
   \   00000532   89E5               B           ??DoEKF_5
    487              {
    488                  mParam->est[i] = ekfParam->preEst[i];
   \   00000534   D000               LSL         R0,R2,#+3
   \   00000536   1649               LDR         R1,??DoEKF_23+0x3C  ;; 0xab8
   \   00000538   6944               ADD         R1,SP
   \   0000053A   0968               LDR         R1,[R1, #+0]
   \   0000053C   8968               LDR         R1,[R1, #+8]
   \   0000053E   0B18               ADD         R3,R1,R0
   \   00000540   1149               LDR         R1,??DoEKF_23+0x34  ;; 0xabc
   \   00000542   6944               ADD         R1,SP
   \   00000544   0968               LDR         R1,[R1, #+0]
   \   00000546   C968               LDR         R1,[R1, #+12]
   \   00000548   0818               ADD         R0,R1,R0
   \   0000054A   03C8               LDMIA       R0!,{R0,R1}
   \   0000054C   03C3               STMIA       R3!,{R0,R1}
    489              }
   \   0000054E   521C               ADD         R2,R2,#+1
   \   00000550   EDE7               B           ??DoEKF_48
   \   00000552   C046               NOP         
   \                     ??DoEKF_23:
   \   00000554   24070000           DC32        0x724
   \   00000558   0C060000           DC32        0x60c
   \   0000055C   2C070000           DC32        0x72c
   \   00000560   54080000           DC32        0x854
   \   00000564   14060000           DC32        0x614
   \   00000568   44080000           DC32        0x844
   \   0000056C   4C080000           DC32        0x84c
   \   00000570   F2D4C853           DC32        0x53c8d4f2
   \   00000574   FB210940           DC32        0x400921fb
   \   00000578   F1D4C853           DC32        0x53c8d4f1
   \   0000057C   FB2119C0           DC32        0xc01921fb
   \   00000580   FB2109C0           DC32        0xc00921fb
   \   00000584   FB211940           DC32        0x401921fb
   \   00000588   BC0A0000           DC32        0xabc
   \   0000058C   C40A0000           DC32        0xac4
   \   00000590   B80A0000           DC32        0xab8
   \   00000594   6C090000           DC32        0x96c
   \   00000598   64090000           DC32        0x964
    490          
    491              return OK;
    492          }

   \                                 In segment CODE, align 4, keep-with-next
   \                     ?Subroutine19:
   \   00000000   F0BC               POP         {R4-R7}
   \   00000002   02BC               POP         {R1}
   \   00000004   0847               BX          R1                 ;; return
   \   00000006   C046               NOP         
   \                     ??Subroutine19_0:
   \   00000008   0000F0BF           DC32        0xbff00000
    493          
    494          /****************************************************************
    495           *º¯ Êý Ãû: Norm()
    496           *²Î    Êý:
    497           *         double * q: ÐèÒª¹éÒ»µÄÔªËØµÄÊ×µØÖ·
    498           *
    499           *¹¦    ÄÜ£º¶Ôq½øÐÐ¹éÒ»´¦Àí
    500           *
    501           *·µ »Ø Öµ:
    502           *          ³É¹¦: OK
    503           *          ÊäÈëÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
    504           *
    505           *×÷    Õß£ºÉêÎÄ±ó
    506           *Íê³ÉÈÕÆÚ£º2011-3-22
    507           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    508          int Norm(double *q)
    509          {
   \                     ??Norm:
   \   00000000   F1B5               PUSH        {R0,R4-R7,LR}
    510              const int N = 4;            // ÔªËØ¸öÊý
    511              double sum = 0.0;           // ±£´æÓû¹éÒ»µÄÔªËØµÄÆ½·½ºÍ£¬È»ºóÇóºÍµÄÆ½·½¸ù
   \   00000002   0026               MOV         R6,#+0
   \   00000004   0027               MOV         R7,#+0
   \   00000006   341C               MOV         R4,R6
    512              int i;
    513          
    514          #ifdef __DEBUG__
    515              if (q == NULL)
    516              {
    517                  return ERR_MEM_NONE;  // ÊäÈëÖ¸ÕëÎª¿Õ
    518              }
    519          #endif
    520          
    521              for (i=0; i<N; i++)
    522              {
    523                  sum += q[i] * q[i];
   \                     ??Norm_1:
   \   00000008   E000               LSL         R0,R4,#+3
   \   0000000A   0099               LDR         R1,[SP, #+0]
   \   0000000C   0818               ADD         R0,R1,R0
   \   0000000E   0CC8               LDMIA       R0!,{R2,R3}
   \   00000010   0838               SUB         R0,#+8
   \   00000012   03C8               LDMIA       R0!,{R0,R1}
   \   00000014   ........           _BLF        __dMul,??__dMul??rT
   \   00000018   321C               MOV         R2,R6
   \   0000001A   3B1C               MOV         R3,R7
   \   0000001C   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000020   061C               MOV         R6,R0
   \   00000022   0F1C               MOV         R7,R1
    524              }
   \   00000024   641C               ADD         R4,R4,#+1
   \   00000026   042C               CMP         R4,#+4
   \   00000028   EEDB               BLT         ??Norm_1
    525              sum = sqrt(sum);           // sum = sqrt(...)
   \   0000002A   ........           _BLF        sqrt,??sqrt??rT
   \   0000002E   041C               MOV         R4,R0
   \   00000030   0D1C               MOV         R5,R1
    526          
    527              for (i=0; i<N; i++)
   \   00000032   0026               MOV         R6,#+0
    528              {
    529                   q[i] /= sum ;         // ¹éÒ»ºóµÄÔªËØ
   \                     ??Norm_2:
   \   00000034   F000               LSL         R0,R6,#+3
   \   00000036   0099               LDR         R1,[SP, #+0]
   \   00000038   0F18               ADD         R7,R1,R0
   \   0000003A   03CF               LDMIA       R7!,{R0,R1}
   \   0000003C   083F               SUB         R7,#+8
   \   0000003E   221C               MOV         R2,R4
   \   00000040   2B1C               MOV         R3,R5
   \   00000042   ........           _BLF        __dDiv,??__dDiv??rT
   \   00000046   03C7               STMIA       R7!,{R0,R1}
    530              }
   \   00000048   761C               ADD         R6,R6,#+1
   \   0000004A   042E               CMP         R6,#+4
   \   0000004C   F2DB               BLT         ??Norm_2
    531          
    532              return OK;
   \   0000004E   0020               MOV         R0,#+0
   \   00000050   F8BC               POP         {R3-R7}
   \   00000052   02BC               POP         {R1}
   \   00000054   0847               BX          R1                 ;; return
    533          }
    534          
    535          /****************************************************************
    536           *º¯ Êý Ãû: PosVelFxu()
    537           *²Î    Êý:
    538           *         const double *state: ÊäÈë×´Ì¬x, y, z, u, v, w
    539           *         const double *param: ¸¨Öú²ÎÊýp, q, r, ax, ay, az, q0, q1, q2, q3
    540           *               double *fxu  : ×´Ì¬·½³ÌÊä³öx, y, z, u, v, w
    541           *
    542           *¹¦    ÄÜ£º¼ÆËãÎ»ÖÃºÍËÙ¶ÈµÄ×´Ì¬·½³Ì
    543           *
    544           *·µ »Ø Öµ:
    545           *          ³É¹¦: OK
    546           *          ÊäÈëÊä³öÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
    547           *
    548           *×÷    Õß£ºÉêÎÄ±ó
    549           *Íê³ÉÈÕÆÚ£º2011-3-22
    550           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    551          int PosVelFxu(const double *state, const double *param, double *fxu)
    552          {
   \                     ??PosVelFxu:
   \   00000000   F6B5               PUSH        {R1,R2,R4-R7,LR}
   \   00000002   96B0               SUB         SP,#+88
    553              double u, v, w;             // Èý¸ö·½ÏòµÄËÙ¶È
    554              double q0, q1, q2, q3;      // ËÄÔªÊý
    555              double g;                   // ÖØÁ¦¼ÓËÙ¶È
    556              double p, q, r;             // ÍÓÂÝÒÇÈý¸ö·½Ïò½Ç¼ÓËÙ¶È
    557          
    558          #ifdef __DEBUG__
    559              if ( (state == NULL) || (param == NULL) || (fxu == NULL) )
    560              {
    561                  return ERR_MEM_NONE;        // ÊäÈëÊä³öÖ¸ÕëÎª¿Õ
    562              }
    563          #endif
    564          
    565              u  = state[3];
   \   00000004   6946               MOV         R1,SP
   \   00000006   021C               MOV         R2,R0
   \   00000008   1832               ADD         R2,#+24
   \   0000000A   0CCA               LDMIA       R2!,{R2,R3}
   \   0000000C   0CC1               STMIA       R1!,{R2,R3}
    566              v  = state[4];
   \   0000000E   021C               MOV         R2,R0
   \   00000010   2032               ADD         R2,#+32
   \   00000012   0CCA               LDMIA       R2!,{R2,R3}
   \   00000014   0CC1               STMIA       R1!,{R2,R3}
    567              w  = state[5];
   \   00000016   04AA               ADD         R2,SP,#+16
   \   00000018   2830               ADD         R0,#+40
   \   0000001A   03C8               LDMIA       R0!,{R0,R1}
   \   0000001C   03C2               STMIA       R2!,{R0,R1}
    568          
    569              p  = param[0];
   \   0000001E   0CAA               ADD         R2,SP,#+48
   \   00000020   1698               LDR         R0,[SP, #+88]
   \   00000022   03C8               LDMIA       R0!,{R0,R1}
   \   00000024   03C2               STMIA       R2!,{R0,R1}
    570              q  = param[1];
   \   00000026   1698               LDR         R0,[SP, #+88]
   \   00000028   0830               ADD         R0,#+8
   \   0000002A   03C8               LDMIA       R0!,{R0,R1}
   \   0000002C   03C2               STMIA       R2!,{R0,R1}
    571              r  = param[2];
   \   0000002E   1698               LDR         R0,[SP, #+88]
   \   00000030   1030               ADD         R0,#+16
   \   00000032   03C8               LDMIA       R0!,{R0,R1}
   \   00000034   03C2               STMIA       R2!,{R0,R1}
    572          
    573              q0 = param[6];
   \   00000036   1698               LDR         R0,[SP, #+88]
   \   00000038   3030               ADD         R0,#+48
   \   0000003A   03C8               LDMIA       R0!,{R0,R1}
   \   0000003C   03C2               STMIA       R2!,{R0,R1}
    574              q1 = param[7];
   \   0000003E   06AA               ADD         R2,SP,#+24
   \   00000040   1698               LDR         R0,[SP, #+88]
   \   00000042   3830               ADD         R0,#+56
   \   00000044   03C8               LDMIA       R0!,{R0,R1}
   \   00000046   03C2               STMIA       R2!,{R0,R1}
    575              q2 = param[8];
   \   00000048   1698               LDR         R0,[SP, #+88]
   \   0000004A   4030               ADD         R0,#+64
   \   0000004C   03C8               LDMIA       R0!,{R0,R1}
   \   0000004E   03C2               STMIA       R2!,{R0,R1}
    576              q3 = param[9];
   \   00000050   14AA               ADD         R2,SP,#+80
   \   00000052   1698               LDR         R0,[SP, #+88]
   \   00000054   4830               ADD         R0,#+72
   \   00000056   03C8               LDMIA       R0!,{R0,R1}
   \   00000058   03C2               STMIA       R2!,{R0,R1}
    577          
    578              // param[3~5]·Ö±ð±íÊ¾: ax, ay, az
    579              //g = sqrt(param[3] * param[3] + param[4] * param[4] + param[5] * param[5]);//4.16
    580              g=accel_g; 
   \   0000005A   ....               LDR         R6,??DataTable12   ;; Cbn
   \   0000005C   0AAA               ADD         R2,SP,#+40
   \   0000005E   B06C               LDR         R0,[R6, #+72]
   \   00000060   F16C               LDR         R1,[R6, #+76]
   \   00000062   03C2               STMIA       R2!,{R0,R1}
    581              // Ê½(3-67)µÄµÚÒ»¶þ²¿·Ö
    582              fxu[0] = Cbn[0][0] * u + Cbn[0][1] * v + Cbn[0][2] * w;
   \   00000064   179F               LDR         R7,[SP, #+92]
   \   00000066   301C               MOV         R0,R6
   \   00000068   1030               ADD         R0,#+16
   \   0000006A   03C8               LDMIA       R0!,{R0,R1}
   \   0000006C   04AA               ADD         R2,SP,#+16
   \   0000006E   0CCA               LDMIA       R2!,{R2,R3}
   \   00000070   ........           _BLF        __dMul,??__dMul??rT
   \   00000074   03B4               PUSH        {R0,R1}
   \   00000076   301C               MOV         R0,R6
   \   00000078   0830               ADD         R0,#+8
   \   0000007A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000007C   04A8               ADD         R0,SP,#+16
   \   0000007E   03C8               LDMIA       R0!,{R0,R1}
   \   00000080   ........           _BLF        __dMul,??__dMul??rT
   \   00000084   041C               MOV         R4,R0
   \   00000086   0D1C               MOV         R5,R1
   \   00000088   0CCE               LDMIA       R6!,{R2,R3}
   \   0000008A   083E               SUB         R6,#+8
   \   0000008C   02A8               ADD         R0,SP,#+8
   \   0000008E   03C8               LDMIA       R0!,{R0,R1}
   \   00000090   ........           _BLF        __dMul,??__dMul??rT
   \   00000094   221C               MOV         R2,R4
   \   00000096   2B1C               MOV         R3,R5
   \   00000098   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000009C   0CBC               POP         {R2,R3}
   \   0000009E   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000A2   03C7               STMIA       R7!,{R0,R1}
    583              fxu[1] = Cbn[1][0] * u + Cbn[1][1] * v + Cbn[1][2] * w;
   \   000000A4   179F               LDR         R7,[SP, #+92]
   \   000000A6   0837               ADD         R7,#+8
   \   000000A8   301C               MOV         R0,R6
   \   000000AA   2830               ADD         R0,#+40
   \   000000AC   03C8               LDMIA       R0!,{R0,R1}
   \   000000AE   04AA               ADD         R2,SP,#+16
   \   000000B0   0CCA               LDMIA       R2!,{R2,R3}
   \   000000B2   ........           _BLF        __dMul,??__dMul??rT
   \   000000B6   03B4               PUSH        {R0,R1}
   \   000000B8   301C               MOV         R0,R6
   \   000000BA   2030               ADD         R0,#+32
   \   000000BC   0CC8               LDMIA       R0!,{R2,R3}
   \   000000BE   04A8               ADD         R0,SP,#+16
   \   000000C0   03C8               LDMIA       R0!,{R0,R1}
   \   000000C2   ........           _BLF        __dMul,??__dMul??rT
   \   000000C6   041C               MOV         R4,R0
   \   000000C8   0D1C               MOV         R5,R1
   \   000000CA   301C               MOV         R0,R6
   \   000000CC   1830               ADD         R0,#+24
   \   000000CE   0CC8               LDMIA       R0!,{R2,R3}
   \   000000D0   02A8               ADD         R0,SP,#+8
   \   000000D2   03C8               LDMIA       R0!,{R0,R1}
   \   000000D4   ........           _BLF        __dMul,??__dMul??rT
   \   000000D8   221C               MOV         R2,R4
   \   000000DA   2B1C               MOV         R3,R5
   \   000000DC   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000E0   0CBC               POP         {R2,R3}
   \   000000E2   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000E6   03C7               STMIA       R7!,{R0,R1}
    584              fxu[2] = Cbn[2][0] * u + Cbn[2][1] * v + Cbn[2][2] * w;
   \   000000E8   179F               LDR         R7,[SP, #+92]
   \   000000EA   1037               ADD         R7,#+16
   \   000000EC   306C               LDR         R0,[R6, #+64]
   \   000000EE   716C               LDR         R1,[R6, #+68]
   \   000000F0   04AA               ADD         R2,SP,#+16
   \   000000F2   0CCA               LDMIA       R2!,{R2,R3}
   \   000000F4   ........           _BLF        __dMul,??__dMul??rT
   \   000000F8   03B4               PUSH        {R0,R1}
   \   000000FA   301C               MOV         R0,R6
   \   000000FC   3830               ADD         R0,#+56
   \   000000FE   0CC8               LDMIA       R0!,{R2,R3}
   \   00000100   04A8               ADD         R0,SP,#+16
   \   00000102   03C8               LDMIA       R0!,{R0,R1}
   \   00000104   ........           _BLF        __dMul,??__dMul??rT
   \   00000108   041C               MOV         R4,R0
   \   0000010A   0D1C               MOV         R5,R1
   \   0000010C   3036               ADD         R6,#+48
   \   0000010E   0CCE               LDMIA       R6!,{R2,R3}
   \   00000110   02A8               ADD         R0,SP,#+8
   \   00000112   03C8               LDMIA       R0!,{R0,R1}
   \   00000114   ........           _BLF        __dMul,??__dMul??rT
   \   00000118   221C               MOV         R2,R4
   \   0000011A   2B1C               MOV         R3,R5
   \   0000011C   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000120   0CBC               POP         {R2,R3}
   \   00000122   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000126   03C7               STMIA       R7!,{R0,R1}
    585              //fxu[0] = (1-2*(q2*q2 + q3*q3)) * u + 2*(q1*q2 - q0*q3) * v + 2*(q1*q3+q0*q2) * w;
    586              //fxu[1] = 2*(q1*q2 + q0*q3) * u + (1-2*(q1*q1+q3*q3)) * v + 2*(q2*q3-q0*q1) * w;
    587              //fxu[2] = 2*(q1*q3 - q0*q2) * u + 2*(q2*q3+q0*q1) * v + (1-2*(q1*q1+q2*q2)) * w;
    588              fxu[3] = param[3] - 2 * (q1 * q3 - q0 * q2) * g - ( -r * v + q * w );
   \   00000128   179A               LDR         R2,[SP, #+92]
   \   0000012A   1832               ADD         R2,#+24
   \   0000012C   04B4               PUSH        {R2}
   \   0000012E   11A8               ADD         R0,SP,#+68
   \   00000130   0CC8               LDMIA       R0!,{R2,R3}
   \   00000132   03A8               ADD         R0,SP,#+12
   \   00000134   03C8               LDMIA       R0!,{R0,R1}
   \   00000136   ........           _BLF        __dMul,??__dMul??rT
   \   0000013A   041C               MOV         R4,R0
   \   0000013C   0D1C               MOV         R5,R1
   \   0000013E   0FA8               ADD         R0,SP,#+60
   \   00000140   0CC8               LDMIA       R0!,{R2,R3}
   \   00000142   05A8               ADD         R0,SP,#+20
   \   00000144   03C8               LDMIA       R0!,{R0,R1}
   \   00000146   ........           _BLF        __dMul,??__dMul??rT
   \   0000014A   221C               MOV         R2,R4
   \   0000014C   2B1C               MOV         R3,R5
   \   0000014E   ........           _BLF        __dSub,??__dSub??rT
   \   00000152   061C               MOV         R6,R0
   \   00000154   0F1C               MOV         R7,R1
   \   00000156   13A8               ADD         R0,SP,#+76
   \   00000158   0CC8               LDMIA       R0!,{R2,R3}
   \   0000015A   09A8               ADD         R0,SP,#+36
   \   0000015C   03C8               LDMIA       R0!,{R0,R1}
   \   0000015E   ........           _BLF        __dMul,??__dMul??rT
   \   00000162   041C               MOV         R4,R0
   \   00000164   0D1C               MOV         R5,R1
   \   00000166   07A8               ADD         R0,SP,#+28
   \   00000168   0CC8               LDMIA       R0!,{R2,R3}
   \   0000016A   15A8               ADD         R0,SP,#+84
   \   0000016C   03C8               LDMIA       R0!,{R0,R1}
   \   0000016E   ........           _BLF        __dMul,??__dMul??rT
   \   00000172   221C               MOV         R2,R4
   \   00000174   2B1C               MOV         R3,R5
   \   00000176   ........           _BLF        __dSub,??__dSub??rT
   \   0000017A   021C               MOV         R2,R0
   \   0000017C   0B1C               MOV         R3,R1
   \   0000017E   0020               MOV         R0,#+0
   \   00000180   8021               MOV         R1,#+128
   \   00000182   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   00000184   ........           _BLF        __dMul,??__dMul??rT
   \   00000188   021C               MOV         R2,R0
   \   0000018A   0B1C               MOV         R3,R1
   \   0000018C   0BA8               ADD         R0,SP,#+44
   \   0000018E   03C8               LDMIA       R0!,{R0,R1}
   \   00000190   ........           _BLF        __dMul,??__dMul??rT
   \   00000194   021C               MOV         R2,R0
   \   00000196   0B1C               MOV         R3,R1
   \   00000198   1798               LDR         R0,[SP, #+92]
   \   0000019A   1830               ADD         R0,#+24
   \   0000019C   03C8               LDMIA       R0!,{R0,R1}
   \   0000019E   ........           _BLF        __dSub,??__dSub??rT
   \   000001A2   321C               MOV         R2,R6
   \   000001A4   3B1C               MOV         R3,R7
   \   000001A6   ........           _BLF        __dSub,??__dSub??rT
   \   000001AA   04BC               POP         {R2}
   \   000001AC   03C2               STMIA       R2!,{R0,R1}
    589              fxu[4] = param[4] - 2 * (q2 * q3 + q0 * q1) * g - ( r * u - p * w );
   \   000001AE   179A               LDR         R2,[SP, #+92]
   \   000001B0   2032               ADD         R2,#+32
   \   000001B2   04B4               PUSH        {R2}
   \   000001B4   0DA8               ADD         R0,SP,#+52
   \   000001B6   0CC8               LDMIA       R0!,{R2,R3}
   \   000001B8   05A8               ADD         R0,SP,#+20
   \   000001BA   03C8               LDMIA       R0!,{R0,R1}
   \   000001BC   ........           _BLF        __dMul,??__dMul??rT
   \   000001C0   041C               MOV         R4,R0
   \   000001C2   0D1C               MOV         R5,R1
   \   000001C4   11A8               ADD         R0,SP,#+68
   \   000001C6   0CC8               LDMIA       R0!,{R2,R3}
   \   000001C8   01A8               ADD         R0,SP,#+4
   \   000001CA   03C8               LDMIA       R0!,{R0,R1}
   \   000001CC   ........           _BLF        __dMul,??__dMul??rT
   \   000001D0   221C               MOV         R2,R4
   \   000001D2   2B1C               MOV         R3,R5
   \   000001D4   ........           _BLF        __dSub,??__dSub??rT
   \   000001D8   061C               MOV         R6,R0
   \   000001DA   0F1C               MOV         R7,R1
   \   000001DC   13A8               ADD         R0,SP,#+76
   \   000001DE   0CC8               LDMIA       R0!,{R2,R3}
   \   000001E0   07A8               ADD         R0,SP,#+28
   \   000001E2   03C8               LDMIA       R0!,{R0,R1}
   \   000001E4   ........           _BLF        __dMul,??__dMul??rT
   \   000001E8   041C               MOV         R4,R0
   \   000001EA   0D1C               MOV         R5,R1
   \   000001EC   09A8               ADD         R0,SP,#+36
   \   000001EE   0CC8               LDMIA       R0!,{R2,R3}
   \   000001F0   15A8               ADD         R0,SP,#+84
   \   000001F2   03C8               LDMIA       R0!,{R0,R1}
   \   000001F4   ........           _BLF        __dMul,??__dMul??rT
   \   000001F8   221C               MOV         R2,R4
   \   000001FA   2B1C               MOV         R3,R5
   \   000001FC   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000200   021C               MOV         R2,R0
   \   00000202   0B1C               MOV         R3,R1
   \   00000204   0020               MOV         R0,#+0
   \   00000206   8021               MOV         R1,#+128
   \   00000208   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   0000020A   ........           _BLF        __dMul,??__dMul??rT
   \   0000020E   021C               MOV         R2,R0
   \   00000210   0B1C               MOV         R3,R1
   \   00000212   0BA8               ADD         R0,SP,#+44
   \   00000214   03C8               LDMIA       R0!,{R0,R1}
   \   00000216   ........           _BLF        __dMul,??__dMul??rT
   \   0000021A   021C               MOV         R2,R0
   \   0000021C   0B1C               MOV         R3,R1
   \   0000021E   1798               LDR         R0,[SP, #+92]
   \   00000220   2030               ADD         R0,#+32
   \   00000222   03C8               LDMIA       R0!,{R0,R1}
   \   00000224   ........           _BLF        __dSub,??__dSub??rT
   \   00000228   321C               MOV         R2,R6
   \   0000022A   3B1C               MOV         R3,R7
   \   0000022C   ........           _BLF        __dSub,??__dSub??rT
   \   00000230   04BC               POP         {R2}
   \   00000232   03C2               STMIA       R2!,{R0,R1}
    590              fxu[5] = param[5] - (1 - 2 * (q1 * q1 + q2 * q2)) * g - ( -q * u + p * v);
   \   00000234   179A               LDR         R2,[SP, #+92]
   \   00000236   2832               ADD         R2,#+40
   \   00000238   04B4               PUSH        {R2}
   \   0000023A   0FA8               ADD         R0,SP,#+60
   \   0000023C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000023E   01A8               ADD         R0,SP,#+4
   \   00000240   03C8               LDMIA       R0!,{R0,R1}
   \   00000242   ........           _BLF        __dMul,??__dMul??rT
   \   00000246   041C               MOV         R4,R0
   \   00000248   0D1C               MOV         R5,R1
   \   0000024A   0DA8               ADD         R0,SP,#+52
   \   0000024C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000024E   03A8               ADD         R0,SP,#+12
   \   00000250   03C8               LDMIA       R0!,{R0,R1}
   \   00000252   ........           _BLF        __dMul,??__dMul??rT
   \   00000256   221C               MOV         R2,R4
   \   00000258   2B1C               MOV         R3,R5
   \   0000025A   ........           _BLF        __dSub,??__dSub??rT
   \   0000025E   061C               MOV         R6,R0
   \   00000260   0F1C               MOV         R7,R1
   \   00000262   09A8               ADD         R0,SP,#+36
   \   00000264   0CC8               LDMIA       R0!,{R2,R3}
   \   00000266   09A8               ADD         R0,SP,#+36
   \   00000268   03C8               LDMIA       R0!,{R0,R1}
   \   0000026A   ........           _BLF        __dMul,??__dMul??rT
   \   0000026E   041C               MOV         R4,R0
   \   00000270   0D1C               MOV         R5,R1
   \   00000272   07A8               ADD         R0,SP,#+28
   \   00000274   0CC8               LDMIA       R0!,{R2,R3}
   \   00000276   07A8               ADD         R0,SP,#+28
   \   00000278   03C8               LDMIA       R0!,{R0,R1}
   \   0000027A   ........           _BLF        __dMul,??__dMul??rT
   \   0000027E   221C               MOV         R2,R4
   \   00000280   2B1C               MOV         R3,R5
   \   00000282   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000286   021C               MOV         R2,R0
   \   00000288   0B1C               MOV         R3,R1
   \   0000028A   0020               MOV         R0,#+0
   \   0000028C   8021               MOV         R1,#+128
   \   0000028E   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   00000290   ........           _BLF        __dMul,??__dMul??rT
   \   00000294   021C               MOV         R2,R0
   \   00000296   0B1C               MOV         R3,R1
   \   00000298   0020               MOV         R0,#+0
   \   0000029A   ....               LDR         R1,??Subroutine19_0  ;; 0xbff00000
   \   0000029C   ........           _BLF        __dAdd,??__dAdd??rT
   \   000002A0   021C               MOV         R2,R0
   \   000002A2   0B1C               MOV         R3,R1
   \   000002A4   0BA8               ADD         R0,SP,#+44
   \   000002A6   03C8               LDMIA       R0!,{R0,R1}
   \   000002A8   ........           _BLF        __dMul,??__dMul??rT
   \   000002AC   021C               MOV         R2,R0
   \   000002AE   0B1C               MOV         R3,R1
   \   000002B0   1798               LDR         R0,[SP, #+92]
   \   000002B2   2830               ADD         R0,#+40
   \   000002B4   03C8               LDMIA       R0!,{R0,R1}
   \   000002B6   ........           _BLF        __dAdd,??__dAdd??rT
   \   000002BA   321C               MOV         R2,R6
   \   000002BC   3B1C               MOV         R3,R7
   \   000002BE   ........           _BLF        __dSub,??__dSub??rT
   \   000002C2   04BC               POP         {R2}
   \   000002C4   03C2               STMIA       R2!,{R0,R1}
    591          
    592              return OK;
   \   000002C6   0020               MOV         R0,#+0
   \   000002C8   18B0               ADD         SP,#+96
   \   000002CA   C046               NOP         
   \   000002CC                      REQUIRE ?Subroutine19
   \   000002CC                      ;; // Fall through to label ?Subroutine19
    593          }
    594          
    595          /****************************************************************
    596           *º¯ Êý Ãû: PosVelFxDot()
    597           *²Î    Êý:
    598           *         const double *state: ÊäÈë×´Ì¬x, y, z, u, v, w
    599           *         const double *param: ¸¨Öú²ÎÊýp, q, r, ax, ay, az, q0, q1, q2, q3
    600           *               void   *fxDot: ¶ÔfxÇóµ¼¼ÆËãºóµÄ6 * 6¾ØÕó
    601           *
    602           *¹¦    ÄÜ£º¶ÔÎ»ÖÃºÍËÙ¶ÈµÄ×´Ì¬·½³ÌÇóµ¼
    603           *
    604           *·µ »Ø Öµ:
    605           *          ³É¹¦: OK
    606           *
    607           *×÷    Õß£ºÉêÎÄ±ó
    608           *Íê³ÉÈÕÆÚ£º2011-3-22
    609           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    610          int PosVelFxDot(const double *state, const double *param, void *fxDot)
    611          {
   \                     ??PosVelFxDot:
   \   00000000   70B5               PUSH        {R4-R6,LR}
   \   00000002   A8B0               SUB         SP,#+160
   \   00000004   0B1C               MOV         R3,R1
    612              // ÕâÀïÔ­±¾Ó¦¸Ã¶ÔÊäÈë²ÎÊýµÄÓÐÐ§ÐÔ½øÐÐ¼ì²éµÄ
    613              // µ«ÊÇÔÚCÓïÑÔÖÐËùÓÐµÄ±äÁ¿ÉùÃ÷±ØÐë·ÅÔÚÖ´ÐÐÓï¾äÇ°Ãæ
    614              // ÁíÍâ¹æ¶¨¶ÔÊý×éµÄÕûÌå¸³ÖµÖ»ÄÜÔÚÉùÃ÷µÄÊ±ºò²Å¿ÉÒÔ
    615              // ËùÒÔÕâÀïÈç¹ûÏÈÉùÃ÷±äÁ¿£¬ÔÙ¼ì²éÊäÈë²ÎÊýµÄÓÐÐ§ÐÔ£¬
    616              // ¾Í²»¿ÉÒÔ¶ÔÊý×éÕûÌå¸³ÖµÁË£¬´Ó¶øÆÆ»µÁË¹«Ê½µÄÕûÌåÐÔ
    617              // ËäÈ»ÓÐÐ©±àÒëÆ÷°æ±¾Ö§³ÖÓÃµÄÊ±ºòÉùÃ÷¶¨Òå±äÁ¿£¬µ«ÊÇÎªÁË
    618              // ÒÆÖ²ÐÔ£¬ÕâÀïÍ³Ò»½«ÉùÃ÷·Åµ½×îÇ°Ãæ¡£
    619              double p  = param[0];
   \   00000006   03CB               LDMIA       R3!,{R0,R1}
   \   00000008   083B               SUB         R3,#+8
    620              double q  = param[1];
   \   0000000A   6E46               MOV         R6,SP
   \   0000000C   1C1C               MOV         R4,R3
   \   0000000E   0834               ADD         R4,#+8
   \   00000010   30CC               LDMIA       R4!,{R4,R5}
   \   00000012   30C6               STMIA       R6!,{R4,R5}
    621              double r  = param[2];
   \   00000014   1033               ADD         R3,#+16
   \   00000016   30CB               LDMIA       R3!,{R4,R5}
   \   00000018   30C6               STMIA       R6!,{R4,R5}
    622          
    623              //double q0 = param[6];
    624              //double q1 = param[7];
    625              //double q2 = param[8];
    626              //double q3 = param[9];
    627          
    628              double *pfxDot = (double *)fxDot;
    629              int i, j;
    630          
    631              // Î»ÖÃËÙ¶È×´Ì¬·½³Ì¶ÔËÙ¶ÈÇóµ¼£¬Ê½(3-72)µÚÒ»¶þ²¿·Ö
    632             /* double fuvw[][3] =  { 1-2*(q2*q2+q3*q3), 2 * (q1*q2-q0*q3), 2 * (q1*q3+q0*q2),
    633                                    2 * (q1*q2+q0*q3), 1-2*(q1*q1+q3*q3), 2 * (q2*q3-q0*q1),
    634                                    2 * (q1*q3-q0*q2), 2 * (q2*q3+q0*q1), 1-2*(q1*q1+q2*q2),
    635                                              0,                 r,                -q,
    636                                             -r,                 0,                 p,
    637                                              q,                -p,                 0 };*/
    638              double fuvw[][3] =  { Cbn[0][0], Cbn[0][1], Cbn[0][2],
    639                                    Cbn[1][0], Cbn[1][1], Cbn[1][2],
    640                                    Cbn[2][0], Cbn[2][1], Cbn[2][2],
    641                                       0,          r,            -q,
    642                                      -r,          0,             p,
    643                                       q,         -p,             0 };
   \   0000001A   04AB               ADD         R3,SP,#+16
   \   0000001C   0024               MOV         R4,#+0
   \   0000001E   9025               MOV         R5,#+144
   \                     ??PosVelFxDot_1:
   \   00000020   2D1F               SUB         R5,R5,#+4
   \   00000022   5C51               STR         R4,[R3, R5]
   \   00000024   FCD1               BNE         ??PosVelFxDot_1
   \   00000026   ....               LDR         R3,??DataTable12   ;; Cbn
   \   00000028   30CB               LDMIA       R3!,{R4,R5}
   \   0000002A   083B               SUB         R3,#+8
   \   0000002C   30C6               STMIA       R6!,{R4,R5}
   \   0000002E   04AE               ADD         R6,SP,#+16
   \   00000030   0836               ADD         R6,#+8
   \   00000032   1C1C               MOV         R4,R3
   \   00000034   0834               ADD         R4,#+8
   \   00000036   30CC               LDMIA       R4!,{R4,R5}
   \   00000038   30C6               STMIA       R6!,{R4,R5}
   \   0000003A   04AE               ADD         R6,SP,#+16
   \   0000003C   0836               ADD         R6,#+8
   \   0000003E   0836               ADD         R6,#+8
   \   00000040   1C1C               MOV         R4,R3
   \   00000042   1034               ADD         R4,#+16
   \   00000044   30CC               LDMIA       R4!,{R4,R5}
   \   00000046   30C6               STMIA       R6!,{R4,R5}
   \   00000048   04AE               ADD         R6,SP,#+16
   \   0000004A   0836               ADD         R6,#+8
   \   0000004C   1036               ADD         R6,#+16
   \   0000004E   1C1C               MOV         R4,R3
   \   00000050   1834               ADD         R4,#+24
   \   00000052   30CC               LDMIA       R4!,{R4,R5}
   \   00000054   30C6               STMIA       R6!,{R4,R5}
   \   00000056   04AE               ADD         R6,SP,#+16
   \   00000058   0836               ADD         R6,#+8
   \   0000005A   1836               ADD         R6,#+24
   \   0000005C   1C1C               MOV         R4,R3
   \   0000005E   2034               ADD         R4,#+32
   \   00000060   30CC               LDMIA       R4!,{R4,R5}
   \   00000062   30C6               STMIA       R6!,{R4,R5}
   \   00000064   04AE               ADD         R6,SP,#+16
   \   00000066   0836               ADD         R6,#+8
   \   00000068   2036               ADD         R6,#+32
   \   0000006A   1C1C               MOV         R4,R3
   \   0000006C   2834               ADD         R4,#+40
   \   0000006E   30CC               LDMIA       R4!,{R4,R5}
   \   00000070   30C6               STMIA       R6!,{R4,R5}
   \   00000072   04AE               ADD         R6,SP,#+16
   \   00000074   0836               ADD         R6,#+8
   \   00000076   2836               ADD         R6,#+40
   \   00000078   1C1C               MOV         R4,R3
   \   0000007A   3034               ADD         R4,#+48
   \   0000007C   30CC               LDMIA       R4!,{R4,R5}
   \   0000007E   30C6               STMIA       R6!,{R4,R5}
   \   00000080   04AE               ADD         R6,SP,#+16
   \   00000082   0836               ADD         R6,#+8
   \   00000084   3036               ADD         R6,#+48
   \   00000086   1C1C               MOV         R4,R3
   \   00000088   3834               ADD         R4,#+56
   \   0000008A   30CC               LDMIA       R4!,{R4,R5}
   \   0000008C   30C6               STMIA       R6!,{R4,R5}
   \   0000008E   04AE               ADD         R6,SP,#+16
   \   00000090   0836               ADD         R6,#+8
   \   00000092   3836               ADD         R6,#+56
   \   00000094   4033               ADD         R3,#+64
   \   00000096   30CB               LDMIA       R3!,{R4,R5}
   \   00000098   30C6               STMIA       R6!,{R4,R5}
   \   0000009A   04AB               ADD         R3,SP,#+16
   \   0000009C   0833               ADD         R3,#+8
   \   0000009E   4833               ADD         R3,#+72
   \   000000A0   02AC               ADD         R4,SP,#+8
   \   000000A2   30CC               LDMIA       R4!,{R4,R5}
   \   000000A4   30C3               STMIA       R3!,{R4,R5}
   \   000000A6   04AB               ADD         R3,SP,#+16
   \   000000A8   0833               ADD         R3,#+8
   \   000000AA   5033               ADD         R3,#+80
   \   000000AC   6C46               MOV         R4,SP
   \   000000AE   30CC               LDMIA       R4!,{R4,R5}
   \   000000B0   8026               MOV         R6,#+128
   \   000000B2   3606               LSL         R6,R6,#+24         ;; #-2147483648
   \   000000B4   7540               EOR         R5,R6
   \   000000B6   30C3               STMIA       R3!,{R4,R5}
   \   000000B8   04AB               ADD         R3,SP,#+16
   \   000000BA   0833               ADD         R3,#+8
   \   000000BC   5833               ADD         R3,#+88
   \   000000BE   02AC               ADD         R4,SP,#+8
   \   000000C0   30CC               LDMIA       R4!,{R4,R5}
   \   000000C2   7540               EOR         R5,R6
   \   000000C4   30C3               STMIA       R3!,{R4,R5}
   \   000000C6   04AB               ADD         R3,SP,#+16
   \   000000C8   0833               ADD         R3,#+8
   \   000000CA   6833               ADD         R3,#+104
   \   000000CC   03C3               STMIA       R3!,{R0,R1}
   \   000000CE   04AB               ADD         R3,SP,#+16
   \   000000D0   0833               ADD         R3,#+8
   \   000000D2   7033               ADD         R3,#+112
   \   000000D4   6C46               MOV         R4,SP
   \   000000D6   30CC               LDMIA       R4!,{R4,R5}
   \   000000D8   30C3               STMIA       R3!,{R4,R5}
   \   000000DA   04AB               ADD         R3,SP,#+16
   \   000000DC   0833               ADD         R3,#+8
   \   000000DE   7833               ADD         R3,#+120
   \   000000E0   7140               EOR         R1,R6
   \   000000E2   03C3               STMIA       R3!,{R0,R1}
    644              double *pfuvw = fuvw[0];    // È¡µÃfuvwµÄÊ×µØÖ·
    645              
    646              // Î»ÖÃËÙ¶È×´Ì¬·½³Ì¶ÔÎ»ÖÃÇóµ¼È«ÎªÁã£¬Ê½3-71
    647              // ²¢½«Õâ¸ö½á¹û·Åµ½Êä³ö¾ØÕóÖÐ
    648              // Çóµ¼ºó¶ÔÎ»ÖÃÇóµ¼½á¹ûÔÚµÚ0¡«2ÁÐ
    649              for (i=0; i<LEN_PV_STATE; i++)
   \   000000E4   0024               MOV         R4,#+0
   \   000000E6   0021               MOV         R1,#+0
    650              {
    651                  for (j=0; j<3; j++)        // ¹²ÓÐ3¸ö·½ÏòµÄÎ»ÖÃ
   \                     ??PosVelFxDot_2:
   \   000000E8   0025               MOV         R5,#+0
    652                  {
    653                      pfxDot[i*LEN_PV_STATE+j] = 0.0;
   \                     ??PosVelFxDot_3:
   \   000000EA   0620               MOV         R0,#+6
   \   000000EC   6043               MUL         R0,R4
   \   000000EE   4019               ADD         R0,R0,R5
   \   000000F0   C000               LSL         R0,R0,#+3
   \   000000F2   1618               ADD         R6,R2,R0
   \   000000F4   0020               MOV         R0,#+0
   \   000000F6   03C6               STMIA       R6!,{R0,R1}
    654                  }
   \   000000F8   6D1C               ADD         R5,R5,#+1
   \   000000FA   032D               CMP         R5,#+3
   \   000000FC   F5DB               BLT         ??PosVelFxDot_3
    655              }
   \   000000FE   641C               ADD         R4,R4,#+1
   \   00000100   062C               CMP         R4,#+6
   \   00000102   F1DB               BLT         ??PosVelFxDot_2
    656          
    657              // ¹²ÓÐ3¸ö·½ÏòµÄËÙ¶È£¬Çóµ¼ºó¶ÔËÙ¶ÈÇóµ¼½á¹ûÔÚµÚ3¡«5ÁÐ
    658              for (j=3; j<LEN_PV_STATE; j++)
   \   00000104   0325               MOV         R5,#+3
    659              {
    660                  for (i=0; i<LEN_PV_STATE; i++)
   \                     ??PosVelFxDot_4:
   \   00000106   0024               MOV         R4,#+0
    661                  {
    662                      pfxDot[i*LEN_PV_STATE+j] = pfuvw[i*3+(j-3)];
   \                     ??PosVelFxDot_5:
   \   00000108   0620               MOV         R0,#+6
   \   0000010A   6043               MUL         R0,R4
   \   0000010C   4019               ADD         R0,R0,R5
   \   0000010E   C000               LSL         R0,R0,#+3
   \   00000110   1618               ADD         R6,R2,R0
   \   00000112   0320               MOV         R0,#+3
   \   00000114   6043               MUL         R0,R4
   \   00000116   4019               ADD         R0,R0,R5
   \   00000118   C000               LSL         R0,R0,#+3
   \   0000011A   04A9               ADD         R1,SP,#+16
   \   0000011C   1839               SUB         R1,#+24
   \   0000011E   0818               ADD         R0,R1,R0
   \   00000120   03C8               LDMIA       R0!,{R0,R1}
   \   00000122   03C6               STMIA       R6!,{R0,R1}
    663                  }
   \   00000124   641C               ADD         R4,R4,#+1
   \   00000126   062C               CMP         R4,#+6
   \   00000128   EEDB               BLT         ??PosVelFxDot_5
    664              }//for
   \   0000012A   6D1C               ADD         R5,R5,#+1
   \   0000012C   062D               CMP         R5,#+6
   \   0000012E   EADB               BLT         ??PosVelFxDot_4
    665          
    666              return OK;
   \   00000130   0020               MOV         R0,#+0
   \   00000132   28B0               ADD         SP,#+160
   \   00000134   70BC               POP         {R4-R6}
   \   00000136   02BC               POP         {R1}
   \   00000138   0847               BX          R1                 ;; return
    667          
    668          }
    669          
    670          /****************************************************************
    671           *º¯ Êý Ãû: PosVelHx()
    672           *²Î    Êý:
    673           *         const double *state: ÊäÈë×´Ì¬x, y, z, u, v, w
    674           *               double *fxu  : ¹Û²â·½³ÌÊä³öx, y, z, u, v, w
    675           *
    676           *¹¦    ÄÜ£º¼ÆËãÎ»ÖÃºÍËÙ¶ÈµÄ¹Û²â·½³Ì
    677           *
    678           *·µ »Ø Öµ:
    679           *          ³É¹¦: OK
    680           *          ÊäÈëÊä³öÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
    681           *
    682           *×÷    Õß£ºÉêÎÄ±ó
    683           *Íê³ÉÈÕÆÚ£º2011-3-22
    684           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    685          int PosVelHx(const double *state, double *hx)
    686          {
   \                     ??PosVelHx:
   \   00000000   10B5               PUSH        {R4,LR}
    687              int i;        // Ñ­»·±äÁ¿
    688               
    689               
    690          #ifdef __DEBUG__
    691              if ( (state == NULL) || (hx == NULL) )
    692              {
    693                  return ERR_MEM_NONE;        // ÊäÈëÊä³öÖ¸ÕëÎª¿Õ
    694              }
    695          #endif
    696          
    697              // Ê½(3-78)µÚÒ»¶þ²¿·Ö£¬¹Û²âÁ¿µÈÓÚ×´Ì¬Á¿
    698              for (i=0; i<LEN_PV_OBS; i++)
   \   00000002   0624               MOV         R4,#+6
    699              {
    700                  *hx++ = *state++;  
   \                     ??PosVelHx_1:
   \   00000004   0CC8               LDMIA       R0!,{R2,R3}
   \   00000006   0CC1               STMIA       R1!,{R2,R3}
    701              }
   \   00000008   641E               SUB         R4,R4,#+1
   \   0000000A   FBD1               BNE         ??PosVelHx_1
    702           
    703            return OK;
   \   0000000C   0020               MOV         R0,#+0
   \   0000000E   10BC               POP         {R4}
   \   00000010   02BC               POP         {R1}
   \   00000012   0847               BX          R1                 ;; return
    704          }
    705          
    706          /****************************************************************
    707           *º¯ Êý Ãû: PosVelHxDot()
    708           *²Î    Êý:
    709           *         const double *state: ÊäÈë×´Ì¬x, y, z, u, v, w
    710           *               void   *hxDot: ¹Û²â·½³Ì¶ÔÎ»ÖÃËÙ¶È±äÁ¿µÄÇóµ¼£¬Îª6 * 6½×µ¥Î»¾ØÕó
    711           *
    712           *¹¦    ÄÜ£ºÎ»ÖÃËÙ¶È¹Û²â·½³Ì¶ÔÎ»ÖÃËÙ¶È±äÁ¿µÄÇóµ¼
    713           *
    714           *·µ »Ø Öµ:
    715           *          ³É¹¦: OK
    716           *          ÊäÈëÊä³öÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
    717           *
    718           *×÷    Õß£ºÉêÎÄ±ó
    719           *Íê³ÉÈÕÆÚ£º2011-3-22
    720           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    721          int PosVelHxDot(const double *state, void *hxDot)
    722          {
   \                     ??PosVelHxDot:
   \   00000000   72B5               PUSH        {R1,R4-R6,LR}
    723              double *phxDot = (double *)hxDot;
    724              int i, j;                // Ñ­»·±äÁ¿
    725          
    726          #ifdef __DEBUG__
    727              if ( (state == NULL) || (hxDot == NULL) )
    728              {
    729                  return ERR_MEM_NONE;        // ÊäÈëÊä³öÖ¸ÕëÎª¿Õ
    730              }
    731          #endif
    732          
    733              for (i=0; i<LEN_PV_STATE; i++)        // Ê½3-79 3-80
   \   00000002   0024               MOV         R4,#+0
    734              {
    735                  for (j=0; j<LEN_PV_OBS; j++)
   \                     ??PosVelHxDot_1:
   \   00000004   0025               MOV         R5,#+0
    736                  {
    737                      // ¶Ô½ÇÏßÔªËØÎª1£¬ÆäËüÎªÁã
    738                      phxDot[i*LEN_PV_STATE+j] = (i == j);
   \                     ??PosVelHxDot_2:
   \   00000006   AC42               CMP         R4,R5
   \   00000008   01D1               BNE         ??PosVelHxDot_3
   \   0000000A   0120               MOV         R0,#+1
   \   0000000C   00E0               B           ??PosVelHxDot_4
   \                     ??PosVelHxDot_3:
   \   0000000E   0020               MOV         R0,#+0
   \                     ??PosVelHxDot_4:
   \   00000010   0621               MOV         R1,#+6
   \   00000012   6143               MUL         R1,R4
   \   00000014   4919               ADD         R1,R1,R5
   \   00000016   C900               LSL         R1,R1,#+3
   \   00000018   009A               LDR         R2,[SP, #+0]
   \   0000001A   5618               ADD         R6,R2,R1
   \   0000001C   ........           _BLF        __ulongToDouble,??__ulongToDouble??rT
   \   00000020   03C6               STMIA       R6!,{R0,R1}
    739                  }
   \   00000022   6D1C               ADD         R5,R5,#+1
   \   00000024   062D               CMP         R5,#+6
   \   00000026   EEDB               BLT         ??PosVelHxDot_2
    740              }//for
   \   00000028   641C               ADD         R4,R4,#+1
   \   0000002A   062C               CMP         R4,#+6
   \   0000002C   EADB               BLT         ??PosVelHxDot_1
    741          
    742              return OK;
   \   0000002E   0020               MOV         R0,#+0
   \   00000030   78BC               POP         {R3-R6}
   \   00000032   02BC               POP         {R1}
   \   00000034   0847               BX          R1                 ;; return
    743          }
    744          
    745          /****************************************************************
    746           *º¯ Êý Ãû: PosVelEKF()
    747           *²Î    Êý:
    748           *         state: ÂË²¨Ç°×´Ì¬x, y, z, u, v, w
    749           *         obs  : ¹Û²âÁ¿x, y, z, u, v, w
    750           *         param: ÐèÒªµÄ²ÎÊýp, q, r, ax, ay, az, q0, q1, q2, q3
    751           *         est  : ÂË²¨ºóµÄ×´Ì¬x, y, z, u, v, w
    752           *
    753           *¹¦    ÄÜ£ºÎ»ÖÃËÙ¶È±äÁ¿µÄEKFÂË²¨
    754           *
    755           *·µ »Ø Öµ:
    756           *          ³É¹¦: OK
    757           *          ÊäÈëÊä³öÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
    758           *
    759           *×÷    Õß£ºÉêÎÄ±ó
    760           *Íê³ÉÈÕÆÚ£º2011-3-22
    761           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    762          void PosVelEKF(const double *state, const double *obs, const double *param, double *est)
    763          {
   \                     ??PosVelEKF:
   \   00000000   F0B5               PUSH        {R4-R7,LR}
   \   00000002   A7B0               SUB         SP,#+156
    764              //const double Q[LEN_PV_STATE] = {0.08,0.08,0.08,0.5,0.5,0.05};    // QÕó
    765              //const double R[LEN_PV_OBS] =   {0.3,0.3,0.3,0.3,0.3,0.3};        // RÕó
    766              
    767              //const double Q[LEN_PV_STATE] = {0.08,0.08,0.08,0.08,0.08,0.05};    // QÕó
    768              //const double R[LEN_PV_OBS] =   {0.3,0.3,0.3,0.3,0.3,0.3};        // RÕó
    769          	
    770          	const double Q[LEN_PV_STATE] = {0.1,0.1,0.15,0.1,0.1,0.03};
   \   00000004   0FAC               ADD         R4,SP,#+60
   \   00000006   194D               LDR         R5,??PosVelEKF_1   ;; `?<Constant {(1.0E-1), (1.0E-1), (1.49999999999`
   \   00000008   3027               MOV         R7,#+48
   \                     ??PosVelEKF_2:
   \   0000000A   3F1F               SUB         R7,R7,#+4
   \   0000000C   EE59               LDR         R6,[R5, R7]
   \   0000000E   E651               STR         R6,[R4, R7]
   \   00000010   FBD1               BNE         ??PosVelEKF_2
    771              const double R[LEN_PV_OBS] =   {0.3,0.3,0.3,0.3,0.3,0.3};
   \   00000012   1BAC               ADD         R4,SP,#+108
   \   00000014   164D               LDR         R5,??PosVelEKF_1+0x4  ;; `?<Constant {(2.9999999999999998E-1), (2.999999`
   \   00000016   3027               MOV         R7,#+48
   \                     ??PosVelEKF_3:
   \   00000018   3F1F               SUB         R7,R7,#+4
   \   0000001A   EE59               LDR         R6,[R5, R7]
   \   0000001C   E651               STR         R6,[R4, R7]
   \   0000001E   FBD1               BNE         ??PosVelEKF_3
    772              
    773              //const double Q[LEN_PV_STATE] = {0.07,0.007,0.07,0.007,0.005,0.2};    // QÕó
    774              //const double R[LEN_PV_OBS] =   {0.2,0.02,0.12,0.02,0.01,1.8};    // ÐüÍ£ÎÈ 
    775              //const double Q[LEN_PV_STATE] = { 0.01, 0.03, 0.03, 0.03, 0.03, 0.03 };    // QÕó
    776              //const double R[LEN_PV_OBS] =   { 0.01, 0.08, 0.08, 0.3, 0.3, 0.3 };  //¼¤¹âÊý¾Ý  
    777              //Pk²ÎÊý³õÊ¼»¯
    778              static double s_Pk[LEN_PV_STATE][LEN_PV_STATE] = {{0.01}, {0.0, 0.01}, {0.0, 0.0, 0.01}, {0.0, 0.0, 0.0, 0.01},
    779                                 {0.0, 0.0, 0.0, 0.0, 0.01}, {0.0, 0.0, 0.0, 0.0, 0.0, 0.01} };
    780              static double s_preEst[LEN_PV_STATE];    // ÉÏ´ÎÂË²¨Öµ
    781              static int    s_isFirst = 1;             // µÚÒ»´ÎÂË²¨±êÖ¾
    782          
    783              struct Model model;                      // ÏµÍ³Ä£ÐÍ
    784              struct ModelParam mParam;                // ×´Ì¬Á¿¡¢¹Û²âÁ¿¼°¹À¼ÆÖµ±£´æµØÖ·
    785              struct EKFParam ekfParam;                // EKFÂË²¨ËùÐèÒªµÄ²ÎÊý
    786          
    787              // ÉèÖÃÏµÍ³Ä£ÐÍ
    788              model.fxu = PosVelFxu;              // ×´Ì¬·½³Ì
   \   00000020   144C               LDR         R4,??PosVelEKF_1+0x8  ;; ??PosVelFxu
   \   00000022   0094               STR         R4,[SP, #+0]
    789              model.fxDot = PosVelFxDot;          // ×´Ì¬·½³ÌÇóµ¼
   \   00000024   144C               LDR         R4,??PosVelEKF_1+0xC  ;; ??PosVelFxDot
   \   00000026   0194               STR         R4,[SP, #+4]
    790              model.hx = PosVelHx;                // ¹Û²â·½³Ì
   \   00000028   144C               LDR         R4,??PosVelEKF_1+0x10  ;; ??PosVelHx
   \   0000002A   0294               STR         R4,[SP, #+8]
    791              model.hxDot = PosVelHxDot;          // ¹Û²â·½³ÌÇóµ¼
   \   0000002C   144C               LDR         R4,??PosVelEKF_1+0x14  ;; ??PosVelHxDot
   \   0000002E   0394               STR         R4,[SP, #+12]
    792          
    793              // ÉèÖÃ×´Ì¬Á¿¡¢¹Û²âÁ¿¼°¹À¼ÆÖµ±£´æµØÖ·
    794              mParam.state = state;        // ±¾´ÎÂË²¨µÄ×´Ì¬Öµ
   \   00000030   0490               STR         R0,[SP, #+16]
    795              mParam.obs = obs;            // ¹Û²âÁ¿
   \   00000032   0591               STR         R1,[SP, #+20]
    796              mParam.est = est;            // ¹À¼ÆÖµ±£´æµØÖ·
   \   00000034   0693               STR         R3,[SP, #+24]
    797              mParam.othParam = param;     // ÂË²¨ÐèÒªµÄÆäËü²ÎÊý
   \   00000036   0792               STR         R2,[SP, #+28]
    798              mParam.lenState = LEN_PV_STATE;    // ×´Ì¬Á¿³¤¶È
   \   00000038   0620               MOV         R0,#+6
   \   0000003A   0890               STR         R0,[SP, #+32]
    799              mParam.lenObs = LEN_PV_OBS;        // ¹Û²âÁ¿³¤¶È
   \   0000003C   0990               STR         R0,[SP, #+36]
    800          
    801              // ÉèÖÃEKFÂË²¨ËùÐèÒªµÄ²ÎÊý
    802              ekfParam.Q = Q;                    // QÕó
   \   0000003E   0FA8               ADD         R0,SP,#+60
   \   00000040   0A90               STR         R0,[SP, #+40]
    803              ekfParam.R = R;                    // RÕó
   \   00000042   1BA8               ADD         R0,SP,#+108
   \   00000044   0B90               STR         R0,[SP, #+44]
    804              ekfParam.Pk = (double*)s_Pk;       // Pk²ÎÊý
   \   00000046   0F48               LDR         R0,??PosVelEKF_1+0x18  ;; ??s_Pk
   \   00000048   0C90               STR         R0,[SP, #+48]
    805              ekfParam.preEst = s_preEst;        // ÉÏÒ»´ÎµÄ¹À¼ÆÖµ
   \   0000004A   9021               MOV         R1,#+144
   \   0000004C   4900               LSL         R1,R1,#+1          ;; #+288
   \   0000004E   4118               ADD         R1,R0,R1
   \   00000050   0D91               STR         R1,[SP, #+52]
    806              ekfParam.isFirst = &s_isFirst;     // ÊÇµÚÒ»´ÎÖ´ÐÐÂË²¨Âð
   \   00000052   A821               MOV         R1,#+168
   \   00000054   4900               LSL         R1,R1,#+1          ;; #+336
   \   00000056   4018               ADD         R0,R0,R1
   \   00000058   0E90               STR         R0,[SP, #+56]
    807          
    808              DoEKF(&model, &mParam, &ekfParam);    // EKFÂË²¨
   \   0000005A   0AAA               ADD         R2,SP,#+40
   \   0000005C   04A9               ADD         R1,SP,#+16
   \   0000005E   6846               MOV         R0,SP
   \   00000060   ........           BL          ??DoEKF
    809          
    810          }
   \   00000064   27B0               ADD         SP,#+156
   \   00000066   ........           BL          ?Subroutine18
   \   0000006A   C046               NOP         
   \                     ??PosVelEKF_1:
   \   0000006C   ........           DC32        `?<Constant {(1.0E-1), (1.0E-1), (1.49999999999`
   \   00000070   ........           DC32        `?<Constant {(2.9999999999999998E-1), (2.999999`
   \   00000074   ........           DC32        ??PosVelFxu
   \   00000078   ........           DC32        ??PosVelFxDot
   \   0000007C   ........           DC32        ??PosVelHx
   \   00000080   ........           DC32        ??PosVelHxDot
   \   00000084   ........           DC32        ??s_Pk

   \                                 In segment DATA_I, align 4, align-sorted
   \                     ??s_Pk:
   \   00000000                      DS8 288
   \   00000120                      REQUIRE `?<Initializer for s_Pk>`
   \   00000120                      DS8 48
   \   00000150                      REQUIRE `?<Initializer for s_preEst>`
   \   00000150                      DS8 4
   \   00000154                      REQUIRE `?<Initializer for s_isFirst>`
    811          
    812          /****************************************************************
    813           *º¯ Êý Ãû: QGFxu()
    814           *²Î    Êý:
    815           *         const double *state: ÊäÈë×´Ì¬q0, q1, q2, q3, g
    816           *         const double *param: ¸¨Öú²ÎÊýp, q, r, ax, ay, az
    817           *               double *fxu  : ×´Ì¬·½³ÌÊä³öq0, q1, q2, q3, g
    818           *
    819           *¹¦    ÄÜ£º¼ÆËãÎ»ÖÃºÍËÙ¶ÈµÄ×´Ì¬·½³Ì
    820           *
    821           *·µ »Ø Öµ:
    822           *          ³É¹¦: OK
    823           *          ÊäÈëÊä³öÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
    824           *
    825           *×÷    Õß£ºÉêÎÄ±ó
    826           *Íê³ÉÈÕÆÚ£º2011-3-22
    827           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    828          int QGFxu(const double *state, const double *param, double *fxu)
    829          {    
   \                     ??QGFxu:
   \   00000000   F1B5               PUSH        {R0,R4-R7,LR}
   \   00000002   88B0               SUB         SP,#+32
   \   00000004   0D1C               MOV         R5,R1
   \   00000006   141C               MOV         R4,R2
    830             double q0, q1, q2, q3;        // ËÄÔªÊý
    831          
    832          #ifdef __DEBUG__
    833              if ( (state == NULL) || (param == NULL) || (fxu == NULL) )
    834              {
    835                  return ERR_MEM_NONE;        // ÊäÈëÊä³öÖ¸ÕëÎª¿Õ
    836              }
    837          #endif
    838          
    839              
    840              
    841              q0 = state[0];
   \   00000008   6A46               MOV         R2,SP
   \   0000000A   03C8               LDMIA       R0!,{R0,R1}
   \   0000000C   03C2               STMIA       R2!,{R0,R1}
    842              q1 = state[1];
   \   0000000E   0898               LDR         R0,[SP, #+32]
   \   00000010   0830               ADD         R0,#+8
   \   00000012   03C8               LDMIA       R0!,{R0,R1}
   \   00000014   03C2               STMIA       R2!,{R0,R1}
    843              q2 = state[2];
   \   00000016   0898               LDR         R0,[SP, #+32]
   \   00000018   1030               ADD         R0,#+16
   \   0000001A   03C8               LDMIA       R0!,{R0,R1}
   \   0000001C   03C2               STMIA       R2!,{R0,R1}
    844              q3 = state[3];
   \   0000001E   0898               LDR         R0,[SP, #+32]
   \   00000020   1830               ADD         R0,#+24
   \   00000022   03C8               LDMIA       R0!,{R0,R1}
   \   00000024   03C2               STMIA       R2!,{R0,R1}
    845              // Ê½(3-67)µÚÈý²¿·Ö
    846              fxu[0] = 0.5 * ( -param[0] * q1 - param[1] * q2 - param[2] * q3 );
   \   00000026   281C               MOV         R0,R5
   \   00000028   1030               ADD         R0,#+16
   \   0000002A   03C8               LDMIA       R0!,{R0,R1}
   \   0000002C   06AA               ADD         R2,SP,#+24
   \   0000002E   0CCA               LDMIA       R2!,{R2,R3}
   \   00000030   ........           _BLF        __dMul,??__dMul??rT
   \   00000034   021C               MOV         R2,R0
   \   00000036   0B1C               MOV         R3,R1
   \   00000038   0CB4               PUSH        {R2,R3}
   \   0000003A   281C               MOV         R0,R5
   \   0000003C   0830               ADD         R0,#+8
   \   0000003E   0CC8               LDMIA       R0!,{R2,R3}
   \   00000040   06A8               ADD         R0,SP,#+24
   \   00000042   03C8               LDMIA       R0!,{R0,R1}
   \   00000044   ........           _BLF        __dMul,??__dMul??rT
   \   00000048   061C               MOV         R6,R0
   \   0000004A   0F1C               MOV         R7,R1
   \   0000004C   0CCD               LDMIA       R5!,{R2,R3}
   \   0000004E   083D               SUB         R5,#+8
   \   00000050   04A8               ADD         R0,SP,#+16
   \   00000052   03C8               LDMIA       R0!,{R0,R1}
   \   00000054   ........           _BLF        __dMul,??__dMul??rT
   \   00000058   8022               MOV         R2,#+128
   \   0000005A   1206               LSL         R2,R2,#+24         ;; #-2147483648
   \   0000005C   5140               EOR         R1,R2
   \   0000005E   321C               MOV         R2,R6
   \   00000060   3B1C               MOV         R3,R7
   \   00000062   ........           _BLF        __dSub,??__dSub??rT
   \   00000066   0CBC               POP         {R2,R3}
   \   00000068   ........           _BLF        __dSub,??__dSub??rT
   \   0000006C   021C               MOV         R2,R0
   \   0000006E   0B1C               MOV         R3,R1
   \   00000070   0020               MOV         R0,#+0
   \   00000072   ....               LDR         R1,??DataTable19   ;; 0x3fe00000
   \   00000074   ........           _BLF        __dMul,??__dMul??rT
   \   00000078   03C4               STMIA       R4!,{R0,R1}
   \   0000007A   083C               SUB         R4,#+8
    847              fxu[1] = 0.5 * (  param[0] * q0 + param[2] * q2 - param[1] * q3 );
   \   0000007C   221C               MOV         R2,R4
   \   0000007E   0832               ADD         R2,#+8
   \   00000080   04B4               PUSH        {R2}
   \   00000082   281C               MOV         R0,R5
   \   00000084   0830               ADD         R0,#+8
   \   00000086   0CC8               LDMIA       R0!,{R2,R3}
   \   00000088   07A8               ADD         R0,SP,#+28
   \   0000008A   03C8               LDMIA       R0!,{R0,R1}
   \   0000008C   ........           _BLF        __dMul,??__dMul??rT
   \   00000090   021C               MOV         R2,R0
   \   00000092   0B1C               MOV         R3,R1
   \   00000094   0CB4               PUSH        {R2,R3}
   \   00000096   281C               MOV         R0,R5
   \   00000098   1030               ADD         R0,#+16
   \   0000009A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000009C   07A8               ADD         R0,SP,#+28
   \   0000009E   03C8               LDMIA       R0!,{R0,R1}
   \   000000A0   ........           _BLF        __dMul,??__dMul??rT
   \   000000A4   061C               MOV         R6,R0
   \   000000A6   0F1C               MOV         R7,R1
   \   000000A8   0CCD               LDMIA       R5!,{R2,R3}
   \   000000AA   083D               SUB         R5,#+8
   \   000000AC   03A8               ADD         R0,SP,#+12
   \   000000AE   03C8               LDMIA       R0!,{R0,R1}
   \   000000B0   ........           _BLF        __dMul,??__dMul??rT
   \   000000B4   321C               MOV         R2,R6
   \   000000B6   3B1C               MOV         R3,R7
   \   000000B8   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000BC   0CBC               POP         {R2,R3}
   \   000000BE   ........           _BLF        __dSub,??__dSub??rT
   \   000000C2   021C               MOV         R2,R0
   \   000000C4   0B1C               MOV         R3,R1
   \   000000C6   0020               MOV         R0,#+0
   \   000000C8   ....               LDR         R1,??DataTable19   ;; 0x3fe00000
   \   000000CA   ........           _BLF        __dMul,??__dMul??rT
   \   000000CE   04BC               POP         {R2}
   \   000000D0   03C2               STMIA       R2!,{R0,R1}
    848              fxu[2] = 0.5 * (  param[1] * q0 - param[2] * q1 + param[0] * q3 );
   \   000000D2   221C               MOV         R2,R4
   \   000000D4   1032               ADD         R2,#+16
   \   000000D6   04B4               PUSH        {R2}
   \   000000D8   0CCD               LDMIA       R5!,{R2,R3}
   \   000000DA   083D               SUB         R5,#+8
   \   000000DC   07A8               ADD         R0,SP,#+28
   \   000000DE   03C8               LDMIA       R0!,{R0,R1}
   \   000000E0   ........           _BLF        __dMul,??__dMul??rT
   \   000000E4   03B4               PUSH        {R0,R1}
   \   000000E6   281C               MOV         R0,R5
   \   000000E8   1030               ADD         R0,#+16
   \   000000EA   0CC8               LDMIA       R0!,{R2,R3}
   \   000000EC   05A8               ADD         R0,SP,#+20
   \   000000EE   03C8               LDMIA       R0!,{R0,R1}
   \   000000F0   ........           _BLF        __dMul,??__dMul??rT
   \   000000F4   061C               MOV         R6,R0
   \   000000F6   0F1C               MOV         R7,R1
   \   000000F8   281C               MOV         R0,R5
   \   000000FA   0830               ADD         R0,#+8
   \   000000FC   0CC8               LDMIA       R0!,{R2,R3}
   \   000000FE   03A8               ADD         R0,SP,#+12
   \   00000100   03C8               LDMIA       R0!,{R0,R1}
   \   00000102   ........           _BLF        __dMul,??__dMul??rT
   \   00000106   321C               MOV         R2,R6
   \   00000108   3B1C               MOV         R3,R7
   \   0000010A   ........           _BLF        __dSub,??__dSub??rT
   \   0000010E   0CBC               POP         {R2,R3}
   \   00000110   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000114   021C               MOV         R2,R0
   \   00000116   0B1C               MOV         R3,R1
   \   00000118   0020               MOV         R0,#+0
   \   0000011A   ....               LDR         R1,??DataTable19   ;; 0x3fe00000
   \   0000011C   ........           _BLF        __dMul,??__dMul??rT
   \   00000120   04BC               POP         {R2}
   \   00000122   03C2               STMIA       R2!,{R0,R1}
    849              fxu[3] = 0.5 * (  param[2] * q0 + param[1] * q1 - param[0] * q2 );
   \   00000124   221C               MOV         R2,R4
   \   00000126   1832               ADD         R2,#+24
   \   00000128   04B4               PUSH        {R2}
   \   0000012A   0CCD               LDMIA       R5!,{R2,R3}
   \   0000012C   083D               SUB         R5,#+8
   \   0000012E   05A8               ADD         R0,SP,#+20
   \   00000130   03C8               LDMIA       R0!,{R0,R1}
   \   00000132   ........           _BLF        __dMul,??__dMul??rT
   \   00000136   021C               MOV         R2,R0
   \   00000138   0B1C               MOV         R3,R1
   \   0000013A   0CB4               PUSH        {R2,R3}
   \   0000013C   281C               MOV         R0,R5
   \   0000013E   0830               ADD         R0,#+8
   \   00000140   0CC8               LDMIA       R0!,{R2,R3}
   \   00000142   05A8               ADD         R0,SP,#+20
   \   00000144   03C8               LDMIA       R0!,{R0,R1}
   \   00000146   ........           _BLF        __dMul,??__dMul??rT
   \   0000014A   061C               MOV         R6,R0
   \   0000014C   0F1C               MOV         R7,R1
   \   0000014E   1035               ADD         R5,#+16
   \   00000150   0CCD               LDMIA       R5!,{R2,R3}
   \   00000152   03A8               ADD         R0,SP,#+12
   \   00000154   03C8               LDMIA       R0!,{R0,R1}
   \   00000156   ........           _BLF        __dMul,??__dMul??rT
   \   0000015A   321C               MOV         R2,R6
   \   0000015C   3B1C               MOV         R3,R7
   \   0000015E   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000162   0CBC               POP         {R2,R3}
   \   00000164   ........           _BLF        __dSub,??__dSub??rT
   \   00000168   021C               MOV         R2,R0
   \   0000016A   0B1C               MOV         R3,R1
   \   0000016C   0020               MOV         R0,#+0
   \   0000016E   ....               LDR         R1,??DataTable19   ;; 0x3fe00000
   \   00000170   ........           _BLF        __dMul,??__dMul??rT
   \   00000174   04BC               POP         {R2}
   \   00000176   03C2               STMIA       R2!,{R0,R1}
    850          
    851              // Èç¹ûfx[0]~fx[3]È«²¿ÎªÁã
    852              if ( (fxu[0] < 1e-6 && fxu[0] > -1e-6) && (fxu[1] < 1e-6 && fxu[1] > -1e-6)
    853                && (fxu[2] < 1e-6 && fxu[2] > -1e-6) && (fxu[3] < 1e-6 && fxu[3] > -1e-6) )
   \   00000178   03CC               LDMIA       R4!,{R0,R1}
   \   0000017A   083C               SUB         R4,#+8
   \   0000017C   2F4A               LDR         R2,??QGFxu_1       ;; 0xa0b5ed8d
   \   0000017E   304B               LDR         R3,??QGFxu_1+0x4   ;; 0x3eb0c6f7
   \   00000180   ........           _BLF        __dLess,??__dLess??rT
   \   00000184   0028               CMP         R0,#+0
   \   00000186   53D0               BEQ         ??QGFxu_2
   \   00000188   03CC               LDMIA       R4!,{R0,R1}
   \   0000018A   083C               SUB         R4,#+8
   \   0000018C   2D4A               LDR         R2,??QGFxu_1+0x8   ;; 0xa0b5ed8c
   \   0000018E   2E4B               LDR         R3,??QGFxu_1+0xC   ;; 0xbeb0c6f7
   \   00000190   ........           _BLF        __dGreaterEqual,??__dGreaterEqual??rT
   \   00000194   0028               CMP         R0,#+0
   \   00000196   4BD0               BEQ         ??QGFxu_2
   \   00000198   201C               MOV         R0,R4
   \   0000019A   0830               ADD         R0,#+8
   \   0000019C   03C8               LDMIA       R0!,{R0,R1}
   \   0000019E   274A               LDR         R2,??QGFxu_1       ;; 0xa0b5ed8d
   \   000001A0   274B               LDR         R3,??QGFxu_1+0x4   ;; 0x3eb0c6f7
   \   000001A2   ........           _BLF        __dLess,??__dLess??rT
   \   000001A6   0028               CMP         R0,#+0
   \   000001A8   42D0               BEQ         ??QGFxu_2
   \   000001AA   201C               MOV         R0,R4
   \   000001AC   0830               ADD         R0,#+8
   \   000001AE   03C8               LDMIA       R0!,{R0,R1}
   \   000001B0   244A               LDR         R2,??QGFxu_1+0x8   ;; 0xa0b5ed8c
   \   000001B2   254B               LDR         R3,??QGFxu_1+0xC   ;; 0xbeb0c6f7
   \   000001B4   ........           _BLF        __dGreaterEqual,??__dGreaterEqual??rT
   \   000001B8   0028               CMP         R0,#+0
   \   000001BA   39D0               BEQ         ??QGFxu_2
   \   000001BC   201C               MOV         R0,R4
   \   000001BE   1030               ADD         R0,#+16
   \   000001C0   03C8               LDMIA       R0!,{R0,R1}
   \   000001C2   1E4A               LDR         R2,??QGFxu_1       ;; 0xa0b5ed8d
   \   000001C4   1E4B               LDR         R3,??QGFxu_1+0x4   ;; 0x3eb0c6f7
   \   000001C6   ........           _BLF        __dLess,??__dLess??rT
   \   000001CA   0028               CMP         R0,#+0
   \   000001CC   30D0               BEQ         ??QGFxu_2
   \   000001CE   201C               MOV         R0,R4
   \   000001D0   1030               ADD         R0,#+16
   \   000001D2   03C8               LDMIA       R0!,{R0,R1}
   \   000001D4   1B4A               LDR         R2,??QGFxu_1+0x8   ;; 0xa0b5ed8c
   \   000001D6   1C4B               LDR         R3,??QGFxu_1+0xC   ;; 0xbeb0c6f7
   \   000001D8   ........           _BLF        __dGreaterEqual,??__dGreaterEqual??rT
   \   000001DC   0028               CMP         R0,#+0
   \   000001DE   27D0               BEQ         ??QGFxu_2
   \   000001E0   201C               MOV         R0,R4
   \   000001E2   1830               ADD         R0,#+24
   \   000001E4   03C8               LDMIA       R0!,{R0,R1}
   \   000001E6   154A               LDR         R2,??QGFxu_1       ;; 0xa0b5ed8d
   \   000001E8   154B               LDR         R3,??QGFxu_1+0x4   ;; 0x3eb0c6f7
   \   000001EA   ........           _BLF        __dLess,??__dLess??rT
   \   000001EE   0028               CMP         R0,#+0
   \   000001F0   1ED0               BEQ         ??QGFxu_2
   \   000001F2   201C               MOV         R0,R4
   \   000001F4   1830               ADD         R0,#+24
   \   000001F6   03C8               LDMIA       R0!,{R0,R1}
   \   000001F8   124A               LDR         R2,??QGFxu_1+0x8   ;; 0xa0b5ed8c
   \   000001FA   134B               LDR         R3,??QGFxu_1+0xC   ;; 0xbeb0c6f7
   \   000001FC   ........           _BLF        __dGreaterEqual,??__dGreaterEqual??rT
   \   00000200   0028               CMP         R0,#+0
   \   00000202   15D0               BEQ         ??QGFxu_2
    854              {
    855                 fxu[0] = state[0];
   \   00000204   0898               LDR         R0,[SP, #+32]
   \   00000206   03C8               LDMIA       R0!,{R0,R1}
   \   00000208   03C4               STMIA       R4!,{R0,R1}
   \   0000020A   083C               SUB         R4,#+8
    856                 fxu[1] = state[1];
   \   0000020C   221C               MOV         R2,R4
   \   0000020E   0832               ADD         R2,#+8
   \   00000210   0898               LDR         R0,[SP, #+32]
   \   00000212   0830               ADD         R0,#+8
   \   00000214   03C8               LDMIA       R0!,{R0,R1}
   \   00000216   03C2               STMIA       R2!,{R0,R1}
    857                 fxu[2] = state[2];
   \   00000218   221C               MOV         R2,R4
   \   0000021A   1032               ADD         R2,#+16
   \   0000021C   0898               LDR         R0,[SP, #+32]
   \   0000021E   1030               ADD         R0,#+16
   \   00000220   03C8               LDMIA       R0!,{R0,R1}
   \   00000222   03C2               STMIA       R2!,{R0,R1}
    858                 fxu[3] = state[3];
   \   00000224   221C               MOV         R2,R4
   \   00000226   1832               ADD         R2,#+24
   \   00000228   0898               LDR         R0,[SP, #+32]
   \   0000022A   1830               ADD         R0,#+24
   \   0000022C   03C8               LDMIA       R0!,{R0,R1}
   \   0000022E   03C2               STMIA       R2!,{R0,R1}
    859              }
    860          
    861              //Norm(fxu);        // ²»¶Ô È¥µô by syc 2011.11.14
    862          
    863              fxu[4] = 0.0;    // Ê½(3-67)µÚËÄ²¿·Ö
   \                     ??QGFxu_2:
   \   00000230   2034               ADD         R4,#+32
   \   00000232   0020               MOV         R0,#+0
   \   00000234   0021               MOV         R1,#+0
   \   00000236   03C4               STMIA       R4!,{R0,R1}
    864          
    865              return OK;
   \   00000238   09B0               ADD         SP,#+36
   \   0000023A   ....               B           ?Subroutine19
   \                     ??QGFxu_1:
   \   0000023C   8DEDB5A0           DC32        0xa0b5ed8d
   \   00000240   F7C6B03E           DC32        0x3eb0c6f7
   \   00000244   8CEDB5A0           DC32        0xa0b5ed8c
   \   00000248   F7C6B0BE           DC32        0xbeb0c6f7
    866          }
    867          
    868          /****************************************************************
    869           *º¯ Êý Ãû: QGFxDot()
    870           *²Î    Êý:
    871           *         const double *state: ÊäÈë×´Ì¬q0, q1, q2, q3, g
    872           *         const double *param: ¸¨Öú²ÎÊýp, q, r, ax, ay, az
    873           *               void   *fxDot: ¶ÔfxÇóµ¼¼ÆËãºóµÄ5 * 5¾ØÕó
    874           *
    875           *¹¦    ÄÜ£ºËÄÔªÊýºÍÖØÁ¦¼ÓËÙ¶ÈÄ£ÐÍµÄ×´Ì¬·½³ÌÇóµ¼
    876           *
    877           *·µ »Ø Öµ:
    878           *          ³É¹¦: OK
    879           *
    880           *×÷    Õß£ºÉêÎÄ±ó
    881           *Íê³ÉÈÕÆÚ£º2011-3-22
    882           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    883          int QGFxDot(const double *state, const double *param, void *fxDot)
    884          {
   \                     ??QGFxDot:
   \   00000000   F0B5               PUSH        {R4-R7,LR}
   \   00000002   BAB0               SUB         SP,#+232
   \   00000004   0B1C               MOV         R3,R1
   \   00000006   141C               MOV         R4,R2
    885              // Í¬PosVelFxDotÒ»Ñù£¬ÕâÀï²»½øÐÐ²ÎÊýÓÐÐ§ÐÔ¼ì²é
    886              double p  = param[0];
   \   00000008   04AA               ADD         R2,SP,#+16
   \   0000000A   03CB               LDMIA       R3!,{R0,R1}
   \   0000000C   083B               SUB         R3,#+8
   \   0000000E   03C2               STMIA       R2!,{R0,R1}
    887              double q  = param[1];
   \   00000010   0AAA               ADD         R2,SP,#+40
   \   00000012   181C               MOV         R0,R3
   \   00000014   0830               ADD         R0,#+8
   \   00000016   03C8               LDMIA       R0!,{R0,R1}
   \   00000018   03C2               STMIA       R2!,{R0,R1}
    888              double r  = param[2];
   \   0000001A   06AA               ADD         R2,SP,#+24
   \   0000001C   1033               ADD         R3,#+16
   \   0000001E   03CB               LDMIA       R3!,{R0,R1}
   \   00000020   03C2               STMIA       R2!,{R0,R1}
    889          
    890              double *pfxDot = (double*)fxDot;
    891              int i, j;
    892          
    893              // Ê½(3-73)ÖÐ¶Ôq0~q3, gÇóµ¼²¿·Ö
    894              double fq0[LEN_QG_STATE] = {      0,
    895                                            0.5 * p,
    896                                            0.5 * q,
    897                                            0.5 * r,
    898                                                0     };
   \   00000022   12A8               ADD         R0,SP,#+72
   \   00000024   0021               MOV         R1,#+0
   \   00000026   2822               MOV         R2,#+40
   \                     ??QGFxDot_1:
   \   00000028   121F               SUB         R2,R2,#+4
   \   0000002A   8150               STR         R1,[R0, R2]
   \   0000002C   FCD1               BNE         ??QGFxDot_1
   \   0000002E   10AD               ADD         R5,SP,#+64
   \   00000030   04A8               ADD         R0,SP,#+16
   \   00000032   0CC8               LDMIA       R0!,{R2,R3}
   \   00000034   0020               MOV         R0,#+0
   \   00000036   ....               LDR         R1,??DataTable19   ;; 0x3fe00000
   \   00000038   ........           _BLF        __dMul,??__dMul??rT
   \   0000003C   03C5               STMIA       R5!,{R0,R1}
   \   0000003E   12AA               ADD         R2,SP,#+72
   \   00000040   0832               ADD         R2,#+8
   \   00000042   10A8               ADD         R0,SP,#+64
   \   00000044   03C8               LDMIA       R0!,{R0,R1}
   \   00000046   03C2               STMIA       R2!,{R0,R1}
   \   00000048   08AD               ADD         R5,SP,#+32
   \   0000004A   0AA8               ADD         R0,SP,#+40
   \   0000004C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000004E   0020               MOV         R0,#+0
   \   00000050   ....               LDR         R1,??DataTable19   ;; 0x3fe00000
   \   00000052   ........           _BLF        __dMul,??__dMul??rT
   \   00000056   03C5               STMIA       R5!,{R0,R1}
   \   00000058   12AA               ADD         R2,SP,#+72
   \   0000005A   1032               ADD         R2,#+16
   \   0000005C   08A8               ADD         R0,SP,#+32
   \   0000005E   03C8               LDMIA       R0!,{R0,R1}
   \   00000060   03C2               STMIA       R2!,{R0,R1}
   \   00000062   0CAD               ADD         R5,SP,#+48
   \   00000064   06A8               ADD         R0,SP,#+24
   \   00000066   0CC8               LDMIA       R0!,{R2,R3}
   \   00000068   0020               MOV         R0,#+0
   \   0000006A   ....               LDR         R1,??DataTable19   ;; 0x3fe00000
   \   0000006C   ........           _BLF        __dMul,??__dMul??rT
   \   00000070   03C5               STMIA       R5!,{R0,R1}
   \   00000072   12AA               ADD         R2,SP,#+72
   \   00000074   1832               ADD         R2,#+24
   \   00000076   0CA8               ADD         R0,SP,#+48
   \   00000078   03C8               LDMIA       R0!,{R0,R1}
   \   0000007A   03C2               STMIA       R2!,{R0,R1}
    899          
    900              double fq1[LEN_QG_STATE] = { -0.5 * p,
    901                                                0,
    902                                           -0.5 * r,
    903                                            0.5 * q,
    904                                                0     };
   \   0000007C   1CA8               ADD         R0,SP,#+112
   \   0000007E   0021               MOV         R1,#+0
   \   00000080   2822               MOV         R2,#+40
   \                     ??QGFxDot_2:
   \   00000082   121F               SUB         R2,R2,#+4
   \   00000084   8150               STR         R1,[R0, R2]
   \   00000086   FCD1               BNE         ??QGFxDot_2
   \   00000088   04A8               ADD         R0,SP,#+16
   \   0000008A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000008C   0020               MOV         R0,#+0
   \   0000008E   3549               LDR         R1,??QGFxDot_3     ;; 0xbfe00000
   \   00000090   ........           _BLF        __dMul,??__dMul??rT
   \   00000094   03C5               STMIA       R5!,{R0,R1}
   \   00000096   1CAA               ADD         R2,SP,#+112
   \   00000098   0EA8               ADD         R0,SP,#+56
   \   0000009A   03C8               LDMIA       R0!,{R0,R1}
   \   0000009C   03C2               STMIA       R2!,{R0,R1}
   \   0000009E   06A8               ADD         R0,SP,#+24
   \   000000A0   0CC8               LDMIA       R0!,{R2,R3}
   \   000000A2   0020               MOV         R0,#+0
   \   000000A4   2F49               LDR         R1,??QGFxDot_3     ;; 0xbfe00000
   \   000000A6   ........           _BLF        __dMul,??__dMul??rT
   \   000000AA   061C               MOV         R6,R0
   \   000000AC   0F1C               MOV         R7,R1
   \   000000AE   1CA8               ADD         R0,SP,#+112
   \   000000B0   1030               ADD         R0,#+16
   \   000000B2   C0C0               STMIA       R0!,{R6,R7}
   \   000000B4   1CAA               ADD         R2,SP,#+112
   \   000000B6   1832               ADD         R2,#+24
   \   000000B8   08A8               ADD         R0,SP,#+32
   \   000000BA   03C8               LDMIA       R0!,{R0,R1}
   \   000000BC   03C2               STMIA       R2!,{R0,R1}
    905          
    906              double fq2[LEN_QG_STATE] = { -0.5 * q,
    907                                            0.5 * r,
    908                                                0,
    909                                           -0.5 * p,
    910                                                0     }; 
   \   000000BE   26A8               ADD         R0,SP,#+152
   \   000000C0   0021               MOV         R1,#+0
   \   000000C2   2822               MOV         R2,#+40
   \                     ??QGFxDot_4:
   \   000000C4   121F               SUB         R2,R2,#+4
   \   000000C6   8150               STR         R1,[R0, R2]
   \   000000C8   FCD1               BNE         ??QGFxDot_4
   \   000000CA   0AA8               ADD         R0,SP,#+40
   \   000000CC   03C8               LDMIA       R0!,{R0,R1}
   \   000000CE   0022               MOV         R2,#+0
   \   000000D0   244B               LDR         R3,??QGFxDot_3     ;; 0xbfe00000
   \   000000D2   ........           _BLF        __dMul,??__dMul??rT
   \   000000D6   021C               MOV         R2,R0
   \   000000D8   0B1C               MOV         R3,R1
   \   000000DA   26A8               ADD         R0,SP,#+152
   \   000000DC   0CC0               STMIA       R0!,{R2,R3}
   \   000000DE   26AD               ADD         R5,SP,#+152
   \   000000E0   0835               ADD         R5,#+8
   \   000000E2   0CA8               ADD         R0,SP,#+48
   \   000000E4   03C8               LDMIA       R0!,{R0,R1}
   \   000000E6   03C5               STMIA       R5!,{R0,R1}
   \   000000E8   26AD               ADD         R5,SP,#+152
   \   000000EA   1835               ADD         R5,#+24
   \   000000EC   0EA8               ADD         R0,SP,#+56
   \   000000EE   03C8               LDMIA       R0!,{R0,R1}
   \   000000F0   03C5               STMIA       R5!,{R0,R1}
    911          
    912              double fq3[LEN_QG_STATE] = { -0.5 * r,
    913                                           -0.5 * q,
    914                                            0.5 * p,
    915                                                0,
    916                                                0     };
   \   000000F2   30A8               ADD         R0,SP,#+192
   \   000000F4   0021               MOV         R1,#+0
   \   000000F6   2825               MOV         R5,#+40
   \                     ??QGFxDot_5:
   \   000000F8   2D1F               SUB         R5,R5,#+4
   \   000000FA   4151               STR         R1,[R0, R5]
   \   000000FC   FCD1               BNE         ??QGFxDot_5
   \   000000FE   C0C0               STMIA       R0!,{R6,R7}
   \   00000100   30A8               ADD         R0,SP,#+192
   \   00000102   0830               ADD         R0,#+8
   \   00000104   0CC0               STMIA       R0!,{R2,R3}
   \   00000106   30AA               ADD         R2,SP,#+192
   \   00000108   1032               ADD         R2,#+16
   \   0000010A   10A8               ADD         R0,SP,#+64
   \   0000010C   03C8               LDMIA       R0!,{R0,R1}
   \   0000010E   03C2               STMIA       R2!,{R0,R1}
    917          
    918              int lenFq = 4;        // fq0~fq3Ò»¹²ÓÐ4¸ö
    919              // pfqÎª [fq0, fq1, fq2, fq3]'×é³ÉµÄ¾ØÕó£¬
    920              // ×¢ÒâÕâÀïµÄfq0~fq3ÎªÐÐÏòÁ¿£¬ËùÒÔÕâÀïÈô½«pfq×ªÖÃ
    921              // ¾ÍºÍÊ½(3-73)ÖÐµÄ±í´ïÊ½Ò»ÖÂÁË
    922              double *pfq[4] = { fq0, fq1, fq2, fq3 };
   \   00000110   12A8               ADD         R0,SP,#+72
   \   00000112   0090               STR         R0,[SP, #+0]
   \   00000114   1CA8               ADD         R0,SP,#+112
   \   00000116   0190               STR         R0,[SP, #+4]
   \   00000118   26A8               ADD         R0,SP,#+152
   \   0000011A   0290               STR         R0,[SP, #+8]
   \   0000011C   30A8               ADD         R0,SP,#+192
   \   0000011E   0390               STR         R0,[SP, #+12]
    923          
    924              // Ê½(3-73)
    925              for (j=0; j<lenFq; j++)
   \   00000120   0023               MOV         R3,#+0
   \   00000122   0025               MOV         R5,#+0
   \   00000124   6F46               MOV         R7,SP
    926              {
    927                  for (i=0; i<LEN_QG_STATE; i++)
   \                     ??QGFxDot_6:
   \   00000126   0026               MOV         R6,#+0
    928                  {
    929                      pfxDot[i*LEN_QG_STATE+j] = pfq[j][i];
   \                     ??QGFxDot_7:
   \   00000128   0520               MOV         R0,#+5
   \   0000012A   7043               MUL         R0,R6
   \   0000012C   4019               ADD         R0,R0,R5
   \   0000012E   C000               LSL         R0,R0,#+3
   \   00000130   2218               ADD         R2,R4,R0
   \   00000132   F000               LSL         R0,R6,#+3
   \   00000134   A900               LSL         R1,R5,#+2
   \   00000136   7958               LDR         R1,[R7, R1]
   \   00000138   0818               ADD         R0,R1,R0
   \   0000013A   03C8               LDMIA       R0!,{R0,R1}
   \   0000013C   03C2               STMIA       R2!,{R0,R1}
    930                  }
   \   0000013E   761C               ADD         R6,R6,#+1
   \   00000140   052E               CMP         R6,#+5
   \   00000142   F1DB               BLT         ??QGFxDot_7
    931              }//for
   \   00000144   6D1C               ADD         R5,R5,#+1
   \   00000146   042D               CMP         R5,#+4
   \   00000148   EDDB               BLT         ??QGFxDot_6
    932          
    933              // Ê½(3-74)
    934              for (i=0; i<LEN_QG_STATE; i++)
    935              {
    936                  pfxDot[i*LEN_QG_STATE+lenFq] = 0.0;
   \                     ??QGFxDot_8:
   \   0000014A   0520               MOV         R0,#+5
   \   0000014C   5843               MUL         R0,R3
   \   0000014E   C000               LSL         R0,R0,#+3
   \   00000150   2218               ADD         R2,R4,R0
   \   00000152   2032               ADD         R2,#+32
   \   00000154   0020               MOV         R0,#+0
   \   00000156   0021               MOV         R1,#+0
   \   00000158   03C2               STMIA       R2!,{R0,R1}
    937              }
   \   0000015A   5B1C               ADD         R3,R3,#+1
   \   0000015C   052B               CMP         R3,#+5
   \   0000015E   F4DB               BLT         ??QGFxDot_8
    938          
    939              return OK;
   \   00000160   3AB0               ADD         SP,#+232
   \   00000162   ....               B           ?Subroutine19
   \                     ??QGFxDot_3:
   \   00000164   0000E0BF           DC32        0xbfe00000
    940          }
    941          
    942          /****************************************************************
    943           *º¯ Êý Ãû: QGHx()
    944           *²Î    Êý:
    945           *         const double *state: ÊäÈë×´Ì¬q0, q1, q2, q3, g
    946           *               void      *hx: ¶Ôhx¼ÆËãºóµÄ3¸ö×´Ì¬: phi, theta, psi
    947           *
    948           *¹¦    ÄÜ£ºÇóËÄÔªÊýºÍÖØÁ¦¼ÓËÙ¶ÈÄ£ÐÍµÄ¹Û²â·½³Ì
    949           *
    950           *·µ »Ø Öµ:
    951           *          ³É¹¦: OK
    952           *
    953           *×÷    Õß£ºÉêÎÄ±ó
    954           *Íê³ÉÈÕÆÚ£º2011-3-22
    955           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    956          int QGHx(const double *state, double *hx)
    957          {
   \                     ??QGHx:
   \   00000000   F2B5               PUSH        {R1,R4-R7,LR}
   \   00000002   90B0               SUB         SP,#+64
    958              // Í¬PosVelFxDotÒ»Ñù£¬ÕâÀï²»½øÐÐ²ÎÊýÓÐÐ§ÐÔ¼ì²é
    959              double q0 = state[0];
   \   00000004   06A9               ADD         R1,SP,#+24
   \   00000006   0CC8               LDMIA       R0!,{R2,R3}
   \   00000008   0838               SUB         R0,#+8
   \   0000000A   0CC1               STMIA       R1!,{R2,R3}
    960              double q1 = state[1];
   \   0000000C   6946               MOV         R1,SP
   \   0000000E   021C               MOV         R2,R0
   \   00000010   0832               ADD         R2,#+8
   \   00000012   0CCA               LDMIA       R2!,{R2,R3}
   \   00000014   0CC1               STMIA       R1!,{R2,R3}
    961              double q2 = state[2];
   \   00000016   021C               MOV         R2,R0
   \   00000018   1032               ADD         R2,#+16
   \   0000001A   0CCA               LDMIA       R2!,{R2,R3}
   \   0000001C   0CC1               STMIA       R1!,{R2,R3}
    962              double q3 = state[3];
   \   0000001E   04AA               ADD         R2,SP,#+16
   \   00000020   1830               ADD         R0,#+24
   \   00000022   03C8               LDMIA       R0!,{R0,R1}
   \   00000024   03C2               STMIA       R2!,{R0,R1}
    963          
    964              double angular[] = { atan2( 2 * (q2 * q3 + q0 * q1) , (1 - 2 * (q1 * q1 + q2 * q2)) ),   // phi
   \   00000026   08AC               ADD         R4,SP,#+32
   \   00000028   02A8               ADD         R0,SP,#+8
   \   0000002A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000002C   02A8               ADD         R0,SP,#+8
   \   0000002E   03C8               LDMIA       R0!,{R0,R1}
   \   00000030   ........           _BLF        __dMul,??__dMul??rT
   \   00000034   03C4               STMIA       R4!,{R0,R1}
   \   00000036   6846               MOV         R0,SP
   \   00000038   0CC8               LDMIA       R0!,{R2,R3}
   \   0000003A   6846               MOV         R0,SP
   \   0000003C   03C8               LDMIA       R0!,{R0,R1}
   \   0000003E   ........           _BLF        __dMul,??__dMul??rT
   \   00000042   08AA               ADD         R2,SP,#+32
   \   00000044   0CCA               LDMIA       R2!,{R2,R3}
   \   00000046   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000004A   0022               MOV         R2,#+0
   \   0000004C   8023               MOV         R3,#+128
   \   0000004E   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   00000050   ........           _BLF        __dMul,??__dMul??rT
   \   00000054   021C               MOV         R2,R0
   \   00000056   0B1C               MOV         R3,R1
   \   00000058   0020               MOV         R0,#+0
   \   0000005A   ....               LDR         R1,??DataTable21   ;; 0x3ff00000
   \   0000005C   ........           _BLF        __dSub,??__dSub??rT
   \   00000060   061C               MOV         R6,R0
   \   00000062   0F1C               MOV         R7,R1
   \   00000064   06A8               ADD         R0,SP,#+24
   \   00000066   03C8               LDMIA       R0!,{R0,R1}
   \   00000068   6A46               MOV         R2,SP
   \   0000006A   0CCA               LDMIA       R2!,{R2,R3}
   \   0000006C   ........           _BLF        __dMul,??__dMul??rT
   \   00000070   041C               MOV         R4,R0
   \   00000072   0D1C               MOV         R5,R1
   \   00000074   02A8               ADD         R0,SP,#+8
   \   00000076   0CC8               LDMIA       R0!,{R2,R3}
   \   00000078   03C8               LDMIA       R0!,{R0,R1}
   \   0000007A   ........           _BLF        __dMul,??__dMul??rT
   \   0000007E   221C               MOV         R2,R4
   \   00000080   2B1C               MOV         R3,R5
   \   00000082   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000086   0022               MOV         R2,#+0
   \   00000088   8023               MOV         R3,#+128
   \   0000008A   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   0000008C   ........           _BLF        __dMul,??__dMul??rT
   \   00000090   321C               MOV         R2,R6
   \   00000092   3B1C               MOV         R3,R7
   \   00000094   ........           _BLF        atan2,??atan2??rT
   \   00000098   0AAA               ADD         R2,SP,#+40
   \   0000009A   03C2               STMIA       R2!,{R0,R1}
   \   0000009C   06A8               ADD         R0,SP,#+24
   \   0000009E   0CC8               LDMIA       R0!,{R2,R3}
   \   000000A0   02A8               ADD         R0,SP,#+8
   \   000000A2   03C8               LDMIA       R0!,{R0,R1}
   \   000000A4   ........           _BLF        __dMul,??__dMul??rT
   \   000000A8   041C               MOV         R4,R0
   \   000000AA   0D1C               MOV         R5,R1
   \   000000AC   6846               MOV         R0,SP
   \   000000AE   03C8               LDMIA       R0!,{R0,R1}
   \   000000B0   04AA               ADD         R2,SP,#+16
   \   000000B2   0CCA               LDMIA       R2!,{R2,R3}
   \   000000B4   ........           _BLF        __dMul,??__dMul??rT
   \   000000B8   221C               MOV         R2,R4
   \   000000BA   2B1C               MOV         R3,R5
   \   000000BC   ........           _BLF        __dSub,??__dSub??rT
   \   000000C0   0022               MOV         R2,#+0
   \   000000C2   8023               MOV         R3,#+128
   \   000000C4   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   000000C6   ........           _BLF        __dMul,??__dMul??rT
   \   000000CA   ........           _BLF        asin,??asin??rT
   \   000000CE   8022               MOV         R2,#+128
   \   000000D0   1206               LSL         R2,R2,#+24         ;; #-2147483648
   \   000000D2   5140               EOR         R1,R2
   \   000000D4   0AAA               ADD         R2,SP,#+40
   \   000000D6   0832               ADD         R2,#+8
   \   000000D8   03C2               STMIA       R2!,{R0,R1}
   \   000000DA   04A8               ADD         R0,SP,#+16
   \   000000DC   0CC8               LDMIA       R0!,{R2,R3}
   \   000000DE   04A8               ADD         R0,SP,#+16
   \   000000E0   03C8               LDMIA       R0!,{R0,R1}
   \   000000E2   ........           _BLF        __dMul,??__dMul??rT
   \   000000E6   08AA               ADD         R2,SP,#+32
   \   000000E8   0CCA               LDMIA       R2!,{R2,R3}
   \   000000EA   ........           _BLF        __dAdd,??__dAdd??rT
   \   000000EE   0022               MOV         R2,#+0
   \   000000F0   8023               MOV         R3,#+128
   \   000000F2   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   000000F4   ........           _BLF        __dMul,??__dMul??rT
   \   000000F8   021C               MOV         R2,R0
   \   000000FA   0B1C               MOV         R3,R1
   \   000000FC   0020               MOV         R0,#+0
   \   000000FE   ....               LDR         R1,??DataTable21   ;; 0x3ff00000
   \   00000100   ........           _BLF        __dSub,??__dSub??rT
   \   00000104   061C               MOV         R6,R0
   \   00000106   0F1C               MOV         R7,R1
   \   00000108   06A8               ADD         R0,SP,#+24
   \   0000010A   03C8               LDMIA       R0!,{R0,R1}
   \   0000010C   04AA               ADD         R2,SP,#+16
   \   0000010E   0CCA               LDMIA       R2!,{R2,R3}
   \   00000110   ........           _BLF        __dMul,??__dMul??rT
   \   00000114   041C               MOV         R4,R0
   \   00000116   0D1C               MOV         R5,R1
   \   00000118   6846               MOV         R0,SP
   \   0000011A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000011C   03C8               LDMIA       R0!,{R0,R1}
   \   0000011E   ........           _BLF        __dMul,??__dMul??rT
   \   00000122   221C               MOV         R2,R4
   \   00000124   2B1C               MOV         R3,R5
   \   00000126   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000012A   0022               MOV         R2,#+0
   \   0000012C   8023               MOV         R3,#+128
   \   0000012E   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   00000130   ........           _BLF        __dMul,??__dMul??rT
   \   00000134   321C               MOV         R2,R6
   \   00000136   3B1C               MOV         R3,R7
   \   00000138   ........           _BLF        atan2,??atan2??rT
   \   0000013C   0AAA               ADD         R2,SP,#+40
   \   0000013E   1032               ADD         R2,#+16
   \   00000140   03C2               STMIA       R2!,{R0,R1}
    965                                  -asin( 2 * (q1 * q3 - q0 * q2) ),                                   // theta
    966                                   atan2( 2 * (q1 * q2 + q0 * q3) , (1 - 2 * (q2 * q2 + q3 * q3)) ) }; // psi
    967              
    968              int lenAng = 3;        // ½Ç¶È¸öÊýÓÐ3¸ö
    969              int i;
    970              for (i=0; i<lenAng; i++)
   \   00000142   0022               MOV         R2,#+0
    971              {
    972                  hx[i] = angular[i];    // Èý¸ö½Ç¶È
   \                     ??QGHx_1:
   \   00000144   D000               LSL         R0,R2,#+3
   \   00000146   1099               LDR         R1,[SP, #+64]
   \   00000148   0B18               ADD         R3,R1,R0
   \   0000014A   0AA9               ADD         R1,SP,#+40
   \   0000014C   0818               ADD         R0,R1,R0
   \   0000014E   03C8               LDMIA       R0!,{R0,R1}
   \   00000150   03C3               STMIA       R3!,{R0,R1}
    973              }
   \   00000152   521C               ADD         R2,R2,#+1
   \   00000154   032A               CMP         R2,#+3
   \   00000156   F5DB               BLT         ??QGHx_1
    974          
    975              return OK;
   \   00000158   0020               MOV         R0,#+0
   \   0000015A   11B0               ADD         SP,#+68
   \   0000015C   ....               B           ?Subroutine19
    976          }
    977          
    978          /****************************************************************
    979           *º¯ Êý Ãû: QGHxDot()
    980           *²Î    Êý:
    981           *         const double *state: ÊäÈë×´Ì¬q0, q1, q2, q3, g
    982           *               void   *hxDot: ¹Û²â·½³Ì¶ÔÎ»ÖÃËÙ¶È±äÁ¿µÄÇóµ¼£¬Îª3 * 5½×µ¥Î»¾ØÕó
    983           *
    984           *¹¦    ÄÜ£ºËÄÔªÊý¡¢ÖØÁ¦¼ÓËÙ¶È¹Û²â·½³Ì¶ÔÎ»ÖÃËÙ¶È±äÁ¿µÄÇóµ¼
    985           *
    986           *·µ »Ø Öµ:
    987           *          ³É¹¦: OK
    988           *
    989           *×÷    Õß£ºÉêÎÄ±ó
    990           *Íê³ÉÈÕÆÚ£º2011-3-22
    991           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
    992          int QGHxDot(const double *state, void *hxDot)
    993          {
   \                     ??QGHxDot:
   \   00000000   F2B5               PUSH        {R1,R4-R7,LR}
   \   00000002   F6B0               SUB         SP,#+472
    994              // Í¬PosVelFxDotÒ»Ñù£¬ÕâÀï²»½øÐÐ²ÎÊýÓÐÐ§ÐÔ¼ì²é
    995          
    996              double q0 = state[0];
   \   00000004   08A9               ADD         R1,SP,#+32
   \   00000006   0CC8               LDMIA       R0!,{R2,R3}
   \   00000008   0838               SUB         R0,#+8
   \   0000000A   0CC1               STMIA       R1!,{R2,R3}
    997              double q1 = state[1];
   \   0000000C   02A9               ADD         R1,SP,#+8
   \   0000000E   021C               MOV         R2,R0
   \   00000010   0832               ADD         R2,#+8
   \   00000012   0CCA               LDMIA       R2!,{R2,R3}
   \   00000014   0CC1               STMIA       R1!,{R2,R3}
    998              double q2 = state[2];
   \   00000016   6946               MOV         R1,SP
   \   00000018   021C               MOV         R2,R0
   \   0000001A   1032               ADD         R2,#+16
   \   0000001C   0CCA               LDMIA       R2!,{R2,R3}
   \   0000001E   0CC1               STMIA       R1!,{R2,R3}
    999              double q3 = state[3];
   \   00000020   04AA               ADD         R2,SP,#+16
   \   00000022   1830               ADD         R0,#+24
   \   00000024   03C8               LDMIA       R0!,{R0,R1}
   \   00000026   03C2               STMIA       R2!,{R0,R1}
   1000              double DCM[3][3];
   1001              double C[3][4];
   1002              double err[3];
   1003              
   1004              DCM[0][0] = 1 - 2 * ( q2*q2 + q3*q3 );
   \   00000028   1CAC               ADD         R4,SP,#+112
   \   0000002A   6846               MOV         R0,SP
   \   0000002C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000002E   6846               MOV         R0,SP
   \   00000030   03C8               LDMIA       R0!,{R0,R1}
   \   00000032   ........           _BLF        __dMul,??__dMul??rT
   \   00000036   03C4               STMIA       R4!,{R0,R1}
   \   00000038   4CAC               ADD         R4,SP,#+304
   \   0000003A   04A8               ADD         R0,SP,#+16
   \   0000003C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000003E   04A8               ADD         R0,SP,#+16
   \   00000040   03C8               LDMIA       R0!,{R0,R1}
   \   00000042   ........           _BLF        __dMul,??__dMul??rT
   \   00000046   1CAA               ADD         R2,SP,#+112
   \   00000048   0CCA               LDMIA       R2!,{R2,R3}
   \   0000004A   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000004E   0022               MOV         R2,#+0
   \   00000050   8023               MOV         R3,#+128
   \   00000052   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   00000054   ........           _BLF        __dMul,??__dMul??rT
   \   00000058   021C               MOV         R2,R0
   \   0000005A   0B1C               MOV         R3,R1
   \   0000005C   0020               MOV         R0,#+0
   \   0000005E   F349               LDR         R1,??QGHxDot_1     ;; 0x3ff00000
   \   00000060   ........           _BLF        __dSub,??__dSub??rT
   \   00000064   03C4               STMIA       R4!,{R0,R1}
   1005              DCM[0][1] = 2 * ( q1*q2 + q0*q3 );
   \   00000066   0CAE               ADD         R6,SP,#+48
   \   00000068   08A8               ADD         R0,SP,#+32
   \   0000006A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000006C   04A8               ADD         R0,SP,#+16
   \   0000006E   03C8               LDMIA       R0!,{R0,R1}
   \   00000070   ........           _BLF        __dMul,??__dMul??rT
   \   00000074   041C               MOV         R4,R0
   \   00000076   0D1C               MOV         R5,R1
   \   00000078   02A8               ADD         R0,SP,#+8
   \   0000007A   0CC8               LDMIA       R0!,{R2,R3}
   \   0000007C   6846               MOV         R0,SP
   \   0000007E   03C8               LDMIA       R0!,{R0,R1}
   \   00000080   ........           _BLF        __dMul,??__dMul??rT
   \   00000084   221C               MOV         R2,R4
   \   00000086   2B1C               MOV         R3,R5
   \   00000088   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000008C   0022               MOV         R2,#+0
   \   0000008E   8023               MOV         R3,#+128
   \   00000090   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   00000092   ........           _BLF        __dMul,??__dMul??rT
   \   00000096   03C6               STMIA       R6!,{R0,R1}
   \   00000098   4CAA               ADD         R2,SP,#+304
   \   0000009A   0832               ADD         R2,#+8
   \   0000009C   0CA8               ADD         R0,SP,#+48
   \   0000009E   03C8               LDMIA       R0!,{R0,R1}
   \   000000A0   03C2               STMIA       R2!,{R0,R1}
   1006              DCM[0][2] = 2 * ( q1*q3 - q0*q2 );
   \   000000A2   10AE               ADD         R6,SP,#+64
   \   000000A4   08A8               ADD         R0,SP,#+32
   \   000000A6   0CC8               LDMIA       R0!,{R2,R3}
   \   000000A8   6846               MOV         R0,SP
   \   000000AA   03C8               LDMIA       R0!,{R0,R1}
   \   000000AC   ........           _BLF        __dMul,??__dMul??rT
   \   000000B0   041C               MOV         R4,R0
   \   000000B2   0D1C               MOV         R5,R1
   \   000000B4   02A8               ADD         R0,SP,#+8
   \   000000B6   0CC8               LDMIA       R0!,{R2,R3}
   \   000000B8   03C8               LDMIA       R0!,{R0,R1}
   \   000000BA   ........           _BLF        __dMul,??__dMul??rT
   \   000000BE   221C               MOV         R2,R4
   \   000000C0   2B1C               MOV         R3,R5
   \   000000C2   ........           _BLF        __dSub,??__dSub??rT
   \   000000C6   0022               MOV         R2,#+0
   \   000000C8   8023               MOV         R3,#+128
   \   000000CA   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   000000CC   ........           _BLF        __dMul,??__dMul??rT
   \   000000D0   03C6               STMIA       R6!,{R0,R1}
   \   000000D2   4CAA               ADD         R2,SP,#+304
   \   000000D4   1032               ADD         R2,#+16
   \   000000D6   10A8               ADD         R0,SP,#+64
   \   000000D8   03C8               LDMIA       R0!,{R0,R1}
   \   000000DA   03C2               STMIA       R2!,{R0,R1}
   1007                                                      
   1008              //DCM[1][0] = 2 * ( q1*q2 - q0*q3 );
   1009              //DCM[1][1] = 1 - 2 * ( q1*q1 + q3*q3 );
   1010              DCM[1][2] = 2 * ( q2*q3 + q0*q1 );
   \   000000DC   0AAE               ADD         R6,SP,#+40
   \   000000DE   08A8               ADD         R0,SP,#+32
   \   000000E0   0CC8               LDMIA       R0!,{R2,R3}
   \   000000E2   02A8               ADD         R0,SP,#+8
   \   000000E4   03C8               LDMIA       R0!,{R0,R1}
   \   000000E6   ........           _BLF        __dMul,??__dMul??rT
   \   000000EA   041C               MOV         R4,R0
   \   000000EC   0D1C               MOV         R5,R1
   \   000000EE   6846               MOV         R0,SP
   \   000000F0   0CC8               LDMIA       R0!,{R2,R3}
   \   000000F2   04A8               ADD         R0,SP,#+16
   \   000000F4   03C8               LDMIA       R0!,{R0,R1}
   \   000000F6   ........           _BLF        __dMul,??__dMul??rT
   \   000000FA   221C               MOV         R2,R4
   \   000000FC   2B1C               MOV         R3,R5
   \   000000FE   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000102   0022               MOV         R2,#+0
   \   00000104   8023               MOV         R3,#+128
   \   00000106   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   00000108   ........           _BLF        __dMul,??__dMul??rT
   \   0000010C   03C6               STMIA       R6!,{R0,R1}
   \   0000010E   4CAA               ADD         R2,SP,#+304
   \   00000110   2832               ADD         R2,#+40
   \   00000112   0AA8               ADD         R0,SP,#+40
   \   00000114   03C8               LDMIA       R0!,{R0,R1}
   \   00000116   03C2               STMIA       R2!,{R0,R1}
   1011                                                                              
   1012              //DCM[2][0] = 2 * ( q1*q3 + q0*q2 );
   1013              //DCM[2][1] = 2 * ( q2*q3- q0*q1 );
   1014              DCM[2][2] = 1 - 2 * ( q1*q1 + q2*q2 );
   \   00000118   06AC               ADD         R4,SP,#+24
   \   0000011A   02A8               ADD         R0,SP,#+8
   \   0000011C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000011E   02A8               ADD         R0,SP,#+8
   \   00000120   03C8               LDMIA       R0!,{R0,R1}
   \   00000122   ........           _BLF        __dMul,??__dMul??rT
   \   00000126   1CAA               ADD         R2,SP,#+112
   \   00000128   0CCA               LDMIA       R2!,{R2,R3}
   \   0000012A   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000012E   0022               MOV         R2,#+0
   \   00000130   8023               MOV         R3,#+128
   \   00000132   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   00000134   ........           _BLF        __dMul,??__dMul??rT
   \   00000138   021C               MOV         R2,R0
   \   0000013A   0B1C               MOV         R3,R1
   \   0000013C   0020               MOV         R0,#+0
   \   0000013E   BB49               LDR         R1,??QGHxDot_1     ;; 0x3ff00000
   \   00000140   ........           _BLF        __dSub,??__dSub??rT
   \   00000144   03C4               STMIA       R4!,{R0,R1}
   \   00000146   4CAA               ADD         R2,SP,#+304
   \   00000148   4032               ADD         R2,#+64
   \   0000014A   06A8               ADD         R0,SP,#+24
   \   0000014C   03C8               LDMIA       R0!,{R0,R1}
   \   0000014E   03C2               STMIA       R2!,{R0,R1}
   1015                      
   1016              err[0] = 2.0 / ( (DCM[2][2]*DCM[2][2]) + (DCM[1][2]*DCM[1][2]) );
   \   00000150   12AE               ADD         R6,SP,#+72
   \   00000152   0AA8               ADD         R0,SP,#+40
   \   00000154   0CC8               LDMIA       R0!,{R2,R3}
   \   00000156   0AA8               ADD         R0,SP,#+40
   \   00000158   03C8               LDMIA       R0!,{R0,R1}
   \   0000015A   ........           _BLF        __dMul,??__dMul??rT
   \   0000015E   041C               MOV         R4,R0
   \   00000160   0D1C               MOV         R5,R1
   \   00000162   06A8               ADD         R0,SP,#+24
   \   00000164   0CC8               LDMIA       R0!,{R2,R3}
   \   00000166   06A8               ADD         R0,SP,#+24
   \   00000168   03C8               LDMIA       R0!,{R0,R1}
   \   0000016A   ........           _BLF        __dMul,??__dMul??rT
   \   0000016E   221C               MOV         R2,R4
   \   00000170   2B1C               MOV         R3,R5
   \   00000172   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000176   021C               MOV         R2,R0
   \   00000178   0B1C               MOV         R3,R1
   \   0000017A   0020               MOV         R0,#+0
   \   0000017C   8021               MOV         R1,#+128
   \   0000017E   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   00000180   ........           _BLF        __dDiv,??__dDiv??rT
   \   00000184   03C6               STMIA       R6!,{R0,R1}
   1017              err[1] = 1.0 / sqrt(1.0 - (DCM[0][2]*DCM[0][2]) );
   \   00000186   10A8               ADD         R0,SP,#+64
   \   00000188   0CC8               LDMIA       R0!,{R2,R3}
   \   0000018A   10A8               ADD         R0,SP,#+64
   \   0000018C   03C8               LDMIA       R0!,{R0,R1}
   \   0000018E   ........           _BLF        __dMul,??__dMul??rT
   \   00000192   021C               MOV         R2,R0
   \   00000194   0B1C               MOV         R3,R1
   \   00000196   0020               MOV         R0,#+0
   \   00000198   A449               LDR         R1,??QGHxDot_1     ;; 0x3ff00000
   \   0000019A   ........           _BLF        __dSub,??__dSub??rT
   \   0000019E   ........           _BLF        sqrt,??sqrt??rT
   \   000001A2   021C               MOV         R2,R0
   \   000001A4   0B1C               MOV         R3,R1
   \   000001A6   0020               MOV         R0,#+0
   \   000001A8   A049               LDR         R1,??QGHxDot_1     ;; 0x3ff00000
   \   000001AA   ........           _BLF        __dDiv,??__dDiv??rT
   \   000001AE   12AA               ADD         R2,SP,#+72
   \   000001B0   0832               ADD         R2,#+8
   \   000001B2   03C2               STMIA       R2!,{R0,R1}
   1018              err[2] = 2.0 / ((DCM[0][0]*DCM[0][0]) + (DCM[0][1]*DCM[0][1]));
   \   000001B4   0EAE               ADD         R6,SP,#+56
   \   000001B6   0CA8               ADD         R0,SP,#+48
   \   000001B8   0CC8               LDMIA       R0!,{R2,R3}
   \   000001BA   0CA8               ADD         R0,SP,#+48
   \   000001BC   03C8               LDMIA       R0!,{R0,R1}
   \   000001BE   ........           _BLF        __dMul,??__dMul??rT
   \   000001C2   041C               MOV         R4,R0
   \   000001C4   0D1C               MOV         R5,R1
   \   000001C6   4CA8               ADD         R0,SP,#+304
   \   000001C8   0CC8               LDMIA       R0!,{R2,R3}
   \   000001CA   4CA8               ADD         R0,SP,#+304
   \   000001CC   03C8               LDMIA       R0!,{R0,R1}
   \   000001CE   ........           _BLF        __dMul,??__dMul??rT
   \   000001D2   221C               MOV         R2,R4
   \   000001D4   2B1C               MOV         R3,R5
   \   000001D6   ........           _BLF        __dAdd,??__dAdd??rT
   \   000001DA   021C               MOV         R2,R0
   \   000001DC   0B1C               MOV         R3,R1
   \   000001DE   0020               MOV         R0,#+0
   \   000001E0   8021               MOV         R1,#+128
   \   000001E2   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   000001E4   ........           _BLF        __dDiv,??__dDiv??rT
   \   000001E8   03C6               STMIA       R6!,{R0,R1}
   \   000001EA   12AA               ADD         R2,SP,#+72
   \   000001EC   1032               ADD         R2,#+16
   \   000001EE   0EA8               ADD         R0,SP,#+56
   \   000001F0   03C8               LDMIA       R0!,{R0,R1}
   \   000001F2   03C2               STMIA       R2!,{R0,R1}
   1019              
   1020              C[0][0] = err[0]*( q1 * DCM[2][2] );
   \   000001F4   34AC               ADD         R4,SP,#+208
   \   000001F6   02A8               ADD         R0,SP,#+8
   \   000001F8   0CC8               LDMIA       R0!,{R2,R3}
   \   000001FA   06A8               ADD         R0,SP,#+24
   \   000001FC   03C8               LDMIA       R0!,{R0,R1}
   \   000001FE   ........           _BLF        __dMul,??__dMul??rT
   \   00000202   12AA               ADD         R2,SP,#+72
   \   00000204   0CCA               LDMIA       R2!,{R2,R3}
   \   00000206   ........           _BLF        __dMul,??__dMul??rT
   \   0000020A   03C4               STMIA       R4!,{R0,R1}
   1021              C[1][0] = err[1]*2.0 * q2;
   \   0000020C   12A8               ADD         R0,SP,#+72
   \   0000020E   0830               ADD         R0,#+8
   \   00000210   30C8               LDMIA       R0!,{R4,R5}
   \   00000212   1EAE               ADD         R6,SP,#+120
   \   00000214   0020               MOV         R0,#+0
   \   00000216   8021               MOV         R1,#+128
   \   00000218   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   0000021A   221C               MOV         R2,R4
   \   0000021C   2B1C               MOV         R3,R5
   \   0000021E   ........           _BLF        __dMul,??__dMul??rT
   \   00000222   03C6               STMIA       R6!,{R0,R1}
   \   00000224   22AE               ADD         R6,SP,#+136
   \   00000226   1EA8               ADD         R0,SP,#+120
   \   00000228   0CC8               LDMIA       R0!,{R2,R3}
   \   0000022A   6846               MOV         R0,SP
   \   0000022C   03C8               LDMIA       R0!,{R0,R1}
   \   0000022E   ........           _BLF        __dMul,??__dMul??rT
   \   00000232   03C6               STMIA       R6!,{R0,R1}
   \   00000234   34AA               ADD         R2,SP,#+208
   \   00000236   2032               ADD         R2,#+32
   \   00000238   22A8               ADD         R0,SP,#+136
   \   0000023A   03C8               LDMIA       R0!,{R0,R1}
   \   0000023C   03C2               STMIA       R2!,{R0,R1}
   1022              C[2][0] = err[2]*( q3 * DCM[0][0] );
   \   0000023E   04A8               ADD         R0,SP,#+16
   \   00000240   0CC8               LDMIA       R0!,{R2,R3}
   \   00000242   4CA8               ADD         R0,SP,#+304
   \   00000244   03C8               LDMIA       R0!,{R0,R1}
   \   00000246   ........           _BLF        __dMul,??__dMul??rT
   \   0000024A   021C               MOV         R2,R0
   \   0000024C   0B1C               MOV         R3,R1
   \   0000024E   0EA8               ADD         R0,SP,#+56
   \   00000250   03C8               LDMIA       R0!,{R0,R1}
   \   00000252   ........           _BLF        __dMul,??__dMul??rT
   \   00000256   03C6               STMIA       R6!,{R0,R1}
   \   00000258   34AA               ADD         R2,SP,#+208
   \   0000025A   4032               ADD         R2,#+64
   \   0000025C   24A8               ADD         R0,SP,#+144
   \   0000025E   03C8               LDMIA       R0!,{R0,R1}
   \   00000260   03C2               STMIA       R2!,{R0,R1}
   1023              
   1024              C[0][1] = err[0]*( q0 * DCM[2][2] + 2.0 * q1 * DCM[1][2] );
   \   00000262   26AA               ADD         R2,SP,#+152
   \   00000264   04B4               PUSH        {R2}
   \   00000266   03A8               ADD         R0,SP,#+12
   \   00000268   03C8               LDMIA       R0!,{R0,R1}
   \   0000026A   0022               MOV         R2,#+0
   \   0000026C   8023               MOV         R3,#+128
   \   0000026E   DB05               LSL         R3,R3,#+23         ;; #+1073741824
   \   00000270   ........           _BLF        __dMul,??__dMul??rT
   \   00000274   021C               MOV         R2,R0
   \   00000276   0B1C               MOV         R3,R1
   \   00000278   0BA8               ADD         R0,SP,#+44
   \   0000027A   03C8               LDMIA       R0!,{R0,R1}
   \   0000027C   ........           _BLF        __dMul,??__dMul??rT
   \   00000280   061C               MOV         R6,R0
   \   00000282   0F1C               MOV         R7,R1
   \   00000284   09A8               ADD         R0,SP,#+36
   \   00000286   0CC8               LDMIA       R0!,{R2,R3}
   \   00000288   07A8               ADD         R0,SP,#+28
   \   0000028A   03C8               LDMIA       R0!,{R0,R1}
   \   0000028C   ........           _BLF        __dMul,??__dMul??rT
   \   00000290   321C               MOV         R2,R6
   \   00000292   3B1C               MOV         R3,R7
   \   00000294   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000298   021C               MOV         R2,R0
   \   0000029A   0B1C               MOV         R3,R1
   \   0000029C   13A8               ADD         R0,SP,#+76
   \   0000029E   03C8               LDMIA       R0!,{R0,R1}
   \   000002A0   ........           _BLF        __dMul,??__dMul??rT
   \   000002A4   04BC               POP         {R2}
   \   000002A6   03C2               STMIA       R2!,{R0,R1}
   \   000002A8   34AA               ADD         R2,SP,#+208
   \   000002AA   0832               ADD         R2,#+8
   \   000002AC   26A8               ADD         R0,SP,#+152
   \   000002AE   03C8               LDMIA       R0!,{R0,R1}
   \   000002B0   03C2               STMIA       R2!,{R0,R1}
   1025              C[1][1] = err[1]*(-2.0)*q3;
   \   000002B2   20AE               ADD         R6,SP,#+128
   \   000002B4   0020               MOV         R0,#+0
   \   000002B6   C021               MOV         R1,#+192
   \   000002B8   0906               LSL         R1,R1,#+24         ;; #-1073741824
   \   000002BA   221C               MOV         R2,R4
   \   000002BC   2B1C               MOV         R3,R5
   \   000002BE   ........           _BLF        __dMul,??__dMul??rT
   \   000002C2   03C6               STMIA       R6!,{R0,R1}
   \   000002C4   28AC               ADD         R4,SP,#+160
   \   000002C6   20A8               ADD         R0,SP,#+128
   \   000002C8   0CC8               LDMIA       R0!,{R2,R3}
   \   000002CA   04A8               ADD         R0,SP,#+16
   \   000002CC   03C8               LDMIA       R0!,{R0,R1}
   \   000002CE   ........           _BLF        __dMul,??__dMul??rT
   \   000002D2   03C4               STMIA       R4!,{R0,R1}
   \   000002D4   34AA               ADD         R2,SP,#+208
   \   000002D6   2832               ADD         R2,#+40
   \   000002D8   28A8               ADD         R0,SP,#+160
   \   000002DA   03C8               LDMIA       R0!,{R0,R1}
   \   000002DC   03C2               STMIA       R2!,{R0,R1}
   1026              C[2][1] = err[2]*( q2 * DCM[0][0] );
   \   000002DE   6846               MOV         R0,SP
   \   000002E0   0CC8               LDMIA       R0!,{R2,R3}
   \   000002E2   4CA8               ADD         R0,SP,#+304
   \   000002E4   03C8               LDMIA       R0!,{R0,R1}
   \   000002E6   ........           _BLF        __dMul,??__dMul??rT
   \   000002EA   0EAA               ADD         R2,SP,#+56
   \   000002EC   0CCA               LDMIA       R2!,{R2,R3}
   \   000002EE   ........           _BLF        __dMul,??__dMul??rT
   \   000002F2   03C4               STMIA       R4!,{R0,R1}
   \   000002F4   34AA               ADD         R2,SP,#+208
   \   000002F6   4832               ADD         R2,#+72
   \   000002F8   2AA8               ADD         R0,SP,#+168
   \   000002FA   03C8               LDMIA       R0!,{R0,R1}
   \   000002FC   03C2               STMIA       R2!,{R0,R1}
   1027              
   1028              C[0][2] = err[0]*( q3 * DCM[2][2] + 2.0 * q2 * DCM[1][2] );
   \   000002FE   6846               MOV         R0,SP
   \   00000300   0CC8               LDMIA       R0!,{R2,R3}
   \   00000302   0020               MOV         R0,#+0
   \   00000304   8021               MOV         R1,#+128
   \   00000306   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   00000308   ........           _BLF        __dMul,??__dMul??rT
   \   0000030C   041C               MOV         R4,R0
   \   0000030E   0D1C               MOV         R5,R1
   \   00000310   2CAA               ADD         R2,SP,#+176
   \   00000312   04B4               PUSH        {R2}
   \   00000314   0BA8               ADD         R0,SP,#+44
   \   00000316   03C8               LDMIA       R0!,{R0,R1}
   \   00000318   221C               MOV         R2,R4
   \   0000031A   2B1C               MOV         R3,R5
   \   0000031C   ........           _BLF        __dMul,??__dMul??rT
   \   00000320   061C               MOV         R6,R0
   \   00000322   0F1C               MOV         R7,R1
   \   00000324   05A8               ADD         R0,SP,#+20
   \   00000326   0CC8               LDMIA       R0!,{R2,R3}
   \   00000328   03C8               LDMIA       R0!,{R0,R1}
   \   0000032A   ........           _BLF        __dMul,??__dMul??rT
   \   0000032E   321C               MOV         R2,R6
   \   00000330   3B1C               MOV         R3,R7
   \   00000332   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000336   021C               MOV         R2,R0
   \   00000338   0B1C               MOV         R3,R1
   \   0000033A   13A8               ADD         R0,SP,#+76
   \   0000033C   03C8               LDMIA       R0!,{R0,R1}
   \   0000033E   ........           _BLF        __dMul,??__dMul??rT
   \   00000342   04BC               POP         {R2}
   \   00000344   03C2               STMIA       R2!,{R0,R1}
   \   00000346   34AA               ADD         R2,SP,#+208
   \   00000348   1032               ADD         R2,#+16
   \   0000034A   2CA8               ADD         R0,SP,#+176
   \   0000034C   03C8               LDMIA       R0!,{R0,R1}
   \   0000034E   03C2               STMIA       R2!,{R0,R1}
   1029              C[1][2] = err[1]*2.0 * q0;
   \   00000350   2EAE               ADD         R6,SP,#+184
   \   00000352   1EA8               ADD         R0,SP,#+120
   \   00000354   0CC8               LDMIA       R0!,{R2,R3}
   \   00000356   08A8               ADD         R0,SP,#+32
   \   00000358   03C8               LDMIA       R0!,{R0,R1}
   \   0000035A   ........           _BLF        __dMul,??__dMul??rT
   \   0000035E   03C6               STMIA       R6!,{R0,R1}
   \   00000360   34AA               ADD         R2,SP,#+208
   \   00000362   3032               ADD         R2,#+48
   \   00000364   2EA8               ADD         R0,SP,#+184
   \   00000366   03C8               LDMIA       R0!,{R0,R1}
   \   00000368   03C2               STMIA       R2!,{R0,R1}
   1030              C[2][2] = err[2]*( q1 * DCM[0][0] + 2.0 * q2 * DCM[0][1] );
   \   0000036A   0CA8               ADD         R0,SP,#+48
   \   0000036C   03C8               LDMIA       R0!,{R0,R1}
   \   0000036E   221C               MOV         R2,R4
   \   00000370   2B1C               MOV         R3,R5
   \   00000372   ........           _BLF        __dMul,??__dMul??rT
   \   00000376   041C               MOV         R4,R0
   \   00000378   0D1C               MOV         R5,R1
   \   0000037A   02A8               ADD         R0,SP,#+8
   \   0000037C   0CC8               LDMIA       R0!,{R2,R3}
   \   0000037E   4CA8               ADD         R0,SP,#+304
   \   00000380   03C8               LDMIA       R0!,{R0,R1}
   \   00000382   ........           _BLF        __dMul,??__dMul??rT
   \   00000386   221C               MOV         R2,R4
   \   00000388   2B1C               MOV         R3,R5
   \   0000038A   ........           _BLF        __dAdd,??__dAdd??rT
   \   0000038E   0EAA               ADD         R2,SP,#+56
   \   00000390   0CCA               LDMIA       R2!,{R2,R3}
   \   00000392   ........           _BLF        __dMul,??__dMul??rT
   \   00000396   03C6               STMIA       R6!,{R0,R1}
   \   00000398   34AA               ADD         R2,SP,#+208
   \   0000039A   5032               ADD         R2,#+80
   \   0000039C   30A8               ADD         R0,SP,#+192
   \   0000039E   03C8               LDMIA       R0!,{R0,R1}
   \   000003A0   03C2               STMIA       R2!,{R0,R1}
   1031               
   1032              C[0][3] = err[0]*( q2 * DCM[2][2]);
   \   000003A2   32AC               ADD         R4,SP,#+200
   \   000003A4   6846               MOV         R0,SP
   \   000003A6   0CC8               LDMIA       R0!,{R2,R3}
   \   000003A8   06A8               ADD         R0,SP,#+24
   \   000003AA   03C8               LDMIA       R0!,{R0,R1}
   \   000003AC   ........           _BLF        __dMul,??__dMul??rT
   \   000003B0   12AA               ADD         R2,SP,#+72
   \   000003B2   0CCA               LDMIA       R2!,{R2,R3}
   \   000003B4   ........           _BLF        __dMul,??__dMul??rT
   \   000003B8   03C4               STMIA       R4!,{R0,R1}
   \   000003BA   34AA               ADD         R2,SP,#+208
   \   000003BC   1832               ADD         R2,#+24
   \   000003BE   32A8               ADD         R0,SP,#+200
   \   000003C0   03C8               LDMIA       R0!,{R0,R1}
   \   000003C2   03C2               STMIA       R2!,{R0,R1}
   1033              C[1][3] = err[1]*(-2.0) * q1; 
   \   000003C4   20A8               ADD         R0,SP,#+128
   \   000003C6   0CC8               LDMIA       R0!,{R2,R3}
   \   000003C8   02A8               ADD         R0,SP,#+8
   \   000003CA   03C8               LDMIA       R0!,{R0,R1}
   \   000003CC   ........           _BLF        __dMul,??__dMul??rT
   \   000003D0   041C               MOV         R4,R0
   \   000003D2   0D1C               MOV         R5,R1
   \   000003D4   34A8               ADD         R0,SP,#+208
   \   000003D6   3830               ADD         R0,#+56
   \   000003D8   30C0               STMIA       R0!,{R4,R5}
   1034              C[2][3] = err[2]*( q0 * DCM[0][0] + 2.0 * q3 * DCM[0][1] );
   \   000003DA   04A8               ADD         R0,SP,#+16
   \   000003DC   0CC8               LDMIA       R0!,{R2,R3}
   \   000003DE   0020               MOV         R0,#+0
   \   000003E0   8021               MOV         R1,#+128
   \   000003E2   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   000003E4   ........           _BLF        __dMul,??__dMul??rT
   \   000003E8   0CAA               ADD         R2,SP,#+48
   \   000003EA   0CCA               LDMIA       R2!,{R2,R3}
   \   000003EC   ........           _BLF        __dMul,??__dMul??rT
   \   000003F0   061C               MOV         R6,R0
   \   000003F2   0F1C               MOV         R7,R1
   \   000003F4   08A8               ADD         R0,SP,#+32
   \   000003F6   0CC8               LDMIA       R0!,{R2,R3}
   \   000003F8   4CA8               ADD         R0,SP,#+304
   \   000003FA   03C8               LDMIA       R0!,{R0,R1}
   \   000003FC   ........           _BLF        __dMul,??__dMul??rT
   \   00000400   321C               MOV         R2,R6
   \   00000402   3B1C               MOV         R3,R7
   \   00000404   ........           _BLF        __dAdd,??__dAdd??rT
   \   00000408   0EAA               ADD         R2,SP,#+56
   \   0000040A   0CCA               LDMIA       R2!,{R2,R3}
   \   0000040C   ........           _BLF        __dMul,??__dMul??rT
   \   00000410   34AA               ADD         R2,SP,#+208
   \   00000412   5832               ADD         R2,#+88
   \   00000414   03C2               STMIA       R2!,{R0,R1}
   1035                  
   1036              // dh/dq0Ê½(3-83)
   1037              double  HQ0[LEN_QG_OBS] = {C[0][0],C[1][0],C[2][0]};
   \   00000416   5EAE               ADD         R6,SP,#+376
   \   00000418   34AA               ADD         R2,SP,#+208
   \   0000041A   0CCA               LDMIA       R2!,{R2,R3}
   \   0000041C   0CC6               STMIA       R6!,{R2,R3}
   \   0000041E   5EAE               ADD         R6,SP,#+376
   \   00000420   0836               ADD         R6,#+8
   \   00000422   22AA               ADD         R2,SP,#+136
   \   00000424   0CCA               LDMIA       R2!,{R2,R3}
   \   00000426   0CC6               STMIA       R6!,{R2,R3}
   \   00000428   5EAE               ADD         R6,SP,#+376
   \   0000042A   01E0               B           ??QGHxDot_2
   \                     ??QGHxDot_1:
   \   0000042C   0000F03F           DC32        0x3ff00000
   \                     ??QGHxDot_2:
   \   00000430   1036               ADD         R6,#+16
   \   00000432   24AA               ADD         R2,SP,#+144
   \   00000434   0CCA               LDMIA       R2!,{R2,R3}
   \   00000436   0CC6               STMIA       R6!,{R2,R3}
   1038              // dh/dq1Ê½(3-84)
   1039              double  HQ1[LEN_QG_OBS] = {C[0][1],C[1][1],C[2][1]};
   \   00000438   26AA               ADD         R2,SP,#+152
   \   0000043A   0CCA               LDMIA       R2!,{R2,R3}
   \   0000043C   0CC6               STMIA       R6!,{R2,R3}
   \   0000043E   64AE               ADD         R6,SP,#+400
   \   00000440   0836               ADD         R6,#+8
   \   00000442   28AA               ADD         R2,SP,#+160
   \   00000444   0CCA               LDMIA       R2!,{R2,R3}
   \   00000446   0CC6               STMIA       R6!,{R2,R3}
   \   00000448   64AE               ADD         R6,SP,#+400
   \   0000044A   1036               ADD         R6,#+16
   \   0000044C   2AAA               ADD         R2,SP,#+168
   \   0000044E   0CCA               LDMIA       R2!,{R2,R3}
   \   00000450   0CC6               STMIA       R6!,{R2,R3}
   1040              // dh/dq2Ê½(3-85)
   1041              double  HQ2[LEN_QG_OBS] = {C[0][2],C[1][2],C[2][2]};  
   \   00000452   2CAA               ADD         R2,SP,#+176
   \   00000454   0CCA               LDMIA       R2!,{R2,R3}
   \   00000456   0CC6               STMIA       R6!,{R2,R3}
   \   00000458   6AAE               ADD         R6,SP,#+424
   \   0000045A   0836               ADD         R6,#+8
   \   0000045C   2EAA               ADD         R2,SP,#+184
   \   0000045E   0CCA               LDMIA       R2!,{R2,R3}
   \   00000460   0CC6               STMIA       R6!,{R2,R3}
   \   00000462   6AAE               ADD         R6,SP,#+424
   \   00000464   1036               ADD         R6,#+16
   \   00000466   30AA               ADD         R2,SP,#+192
   \   00000468   0CCA               LDMIA       R2!,{R2,R3}
   \   0000046A   0CC6               STMIA       R6!,{R2,R3}
   1042              // dh/dq3Ê½(3-86)
   1043              double  HQ3[LEN_QG_OBS] = {C[0][3],C[1][3],C[2][3]};  
   \   0000046C   32AA               ADD         R2,SP,#+200
   \   0000046E   0CCA               LDMIA       R2!,{R2,R3}
   \   00000470   0CC6               STMIA       R6!,{R2,R3}
   \   00000472   70AA               ADD         R2,SP,#+448
   \   00000474   0832               ADD         R2,#+8
   \   00000476   30C2               STMIA       R2!,{R4,R5}
   \   00000478   70AA               ADD         R2,SP,#+448
   \   0000047A   1032               ADD         R2,#+16
   \   0000047C   03C2               STMIA       R2!,{R0,R1}
   1044          
   1045              int i, j;
   1046              double *phxDot = (double*)hxDot;
   1047              int lenHQ = 4;        // HQ0~HQ3¸öÊýÓÐ4¸ö
   1048              // pHQÎª [HQ0, HQ1, HQ2, HQ3]'×é³ÉµÄ¾ØÕó£¬
   1049              // ×¢ÒâÕâÀïµÄHQ0~HQ3ÎªÐÐÏòÁ¿£¬ËùÒÔÕâÀïÈô½«pHQ×ªÖÃ
   1050              // ¾ÍºÍÊ½(3-83)~(3-86)ÖÐµÄ±í´ïÊ½Ò»ÖÂÁË
   1051              double *pHQ[4] = { HQ0, HQ1, HQ2, HQ3 };
   \   0000047E   5EA8               ADD         R0,SP,#+376
   \   00000480   1890               STR         R0,[SP, #+96]
   \   00000482   64A8               ADD         R0,SP,#+400
   \   00000484   1990               STR         R0,[SP, #+100]
   \   00000486   6AA8               ADD         R0,SP,#+424
   \   00000488   1A90               STR         R0,[SP, #+104]
   \   0000048A   70A8               ADD         R0,SP,#+448
   \   0000048C   1B90               STR         R0,[SP, #+108]
   1052          
   1053              for (j=0; j<lenHQ; j++)        // Ê½3-83µ½3-86
   \   0000048E   0022               MOV         R2,#+0
   \   00000490   0023               MOV         R3,#+0
   \   00000492   18AD               ADD         R5,SP,#+96
   1054              {
   1055                  for (i=0; i<LEN_QG_OBS; i++)        // °´ÁÐ¸³Öµ
   \                     ??QGHxDot_3:
   \   00000494   0026               MOV         R6,#+0
   1056                  {
   1057                      phxDot[i*LEN_QG_STATE+j] = pHQ[j][i];
   \                     ??QGHxDot_4:
   \   00000496   0520               MOV         R0,#+5
   \   00000498   7043               MUL         R0,R6
   \   0000049A   C018               ADD         R0,R0,R3
   \   0000049C   C000               LSL         R0,R0,#+3
   \   0000049E   7699               LDR         R1,[SP, #+472]
   \   000004A0   0C18               ADD         R4,R1,R0
   \   000004A2   F000               LSL         R0,R6,#+3
   \   000004A4   9900               LSL         R1,R3,#+2
   \   000004A6   6958               LDR         R1,[R5, R1]
   \   000004A8   0818               ADD         R0,R1,R0
   \   000004AA   03C8               LDMIA       R0!,{R0,R1}
   \   000004AC   03C4               STMIA       R4!,{R0,R1}
   1058                  }
   \   000004AE   761C               ADD         R6,R6,#+1
   \   000004B0   032E               CMP         R6,#+3
   \   000004B2   F0DB               BLT         ??QGHxDot_4
   1059              }//for
   \   000004B4   5B1C               ADD         R3,R3,#+1
   \   000004B6   042B               CMP         R3,#+4
   \   000004B8   ECDB               BLT         ??QGHxDot_3
   1060          
   1061              // hx¶ÔgÇóµ¼
   1062              for (i=0; i<LEN_QG_OBS; i++)
   1063              {
   1064                  phxDot[i*LEN_QG_STATE+lenHQ] = 0.0;
   \                     ??QGHxDot_5:
   \   000004BA   0520               MOV         R0,#+5
   \   000004BC   5043               MUL         R0,R2
   \   000004BE   C000               LSL         R0,R0,#+3
   \   000004C0   7699               LDR         R1,[SP, #+472]
   \   000004C2   0B18               ADD         R3,R1,R0
   \   000004C4   2033               ADD         R3,#+32
   \   000004C6   0020               MOV         R0,#+0
   \   000004C8   0021               MOV         R1,#+0
   \   000004CA   03C3               STMIA       R3!,{R0,R1}
   1065              }
   \   000004CC   521C               ADD         R2,R2,#+1
   \   000004CE   032A               CMP         R2,#+3
   \   000004D0   F3DB               BLT         ??QGHxDot_5
   1066          
   1067              return OK;
   \   000004D2   77B0               ADD         SP,#+476
   \   000004D4   ........           BL          ?Subroutine19
   1068          }
   1069          
   1070          /****************************************************************
   1071           *º¯ Êý Ãû: QGEKF()
   1072           *²Î    Êý:
   1073           *         state: ÂË²¨Ç°×´Ì¬q0, q1, q2, q3, g
   1074           *         obs  : ¹Û²âÁ¿ phi, theta, psi
   1075           *         param: ÐèÒªµÄ²ÎÊý p, q, r, ax, ay, az
   1076           *         est  : ÂË²¨ºóµÄ×´Ì¬ q0, q1, q2, q3, g
   1077           *
   1078           *¹¦    ÄÜ£º¶ÔËÄÔªÊý¡¢ÖØÁ¦¼ÓËÙ¶È½øÐÐEKFÂË²¨
   1079           *
   1080           *·µ »Ø Öµ:
   1081           *          ³É¹¦: OK
   1082           *          ÊäÈëÊä³öÖ¸ÕëÎª¿Õ£ºERR_MEM_NONE
   1083           *
   1084           *×÷    Õß£ºÉêÎÄ±ó
   1085           *Íê³ÉÈÕÆÚ£º2011-3-22
   1086           ****************************************************************/

   \                                 In segment CODE, align 4, keep-with-next
   1087          void QGEKF(const double *state, const double *obs, const double *param, double *est)
   1088          {   
   \                     ??QGEKF:
   \   00000000   F0B5               PUSH        {R4-R7,LR}
   \   00000002   9FB0               SUB         SP,#+124
   1089              //double Q[LEN_QG_STATE] = { 0.005,0.01,0.01,0.001,0.03};    // QÕó
   1090              //double R[LEN_QG_OBS] = { 1,1,2}; //2011 12 14
   1091             
   1092              //double Q[LEN_QG_STATE] = { 0.0008,0.0008,0.0008,0.0008,0.03};    // QÕó 12.9last
   1093              double Q[LEN_QG_STATE] = { 0.001,0.001,0.001,0.001,0.03};
   \   00000004   0FAC               ADD         R4,SP,#+60
   \   00000006   184D               LDR         R5,??QGEKF_1       ;; `?<Constant {(1.0E-3), (1.0E-3), (1.0E-3), (1.0`
   \   00000008   2827               MOV         R7,#+40
   \                     ??QGEKF_2:
   \   0000000A   3F1F               SUB         R7,R7,#+4
   \   0000000C   EE59               LDR         R6,[R5, R7]
   \   0000000E   E651               STR         R6,[R4, R7]
   \   00000010   FBD1               BNE         ??QGEKF_2
   1094              double R[LEN_QG_OBS] = {1,1,0.1};
   \   00000012   19AC               ADD         R4,SP,#+100
   \   00000014   154D               LDR         R5,??QGEKF_1+0x4   ;; `?<Constant {(1.0), (1.0), (1.0E-1)}>`
   \   00000016   1827               MOV         R7,#+24
   \                     ??QGEKF_3:
   \   00000018   3F1F               SUB         R7,R7,#+4
   \   0000001A   EE59               LDR         R6,[R5, R7]
   \   0000001C   E651               STR         R6,[R4, R7]
   \   0000001E   FBD1               BNE         ??QGEKF_3
   1095              // Pk²ÎÊý³õÊ¼»¯
   1096              static double s_Pk[LEN_QG_STATE][LEN_QG_STATE] = { {0.01}, {0.0, 0.01}, {0.0, 0.0, 0.01},{0.0, 0.0, 0.0, 0.01},{0.0, 0.0, 0.0,0.0,0.01} };
   1097              static double s_preEst[LEN_QG_STATE];    // ÉÏ´ÎÂË²¨Öµ
   1098              static int s_isFirst = 1;                // µÚÒ»´ÎÂË²¨
   1099          
   1100              struct Model model;                      // ÏµÍ³Ä£ÐÍ
   1101              struct ModelParam mParam;                // ×´Ì¬Á¿¡¢¹Û²âÁ¿¼°¹À¼ÆÖµ±£´æµØÖ·
   1102              struct EKFParam ekfParam;                // EKFÂË²¨ËùÐèÒªµÄ²ÎÊý
   1103          
   1104              //int i = 0;                               // Ñ­»·±äÁ¿
   1105              //double err;                              // ÂË²¨ÖµÓëÔ­ÖµµÄÆ«²î
   1106              //double INF = 2e-3;                       // Ò»¸öºÜÐ¡µÄÖµ
   1107          
   1108              // ÉèÖÃÏµÍ³Ä£ÐÍ
   1109              model.fxu = QGFxu;                // ×´Ì¬·½³Ì
   \   00000020   ....               LDR         R4,??DataTable22   ;; ??QGFxu
   \   00000022   0094               STR         R4,[SP, #+0]
   1110              model.fxDot = QGFxDot;            // ×´Ì¬·½³ÌÇóµ¼
   \   00000024   124C               LDR         R4,??QGEKF_1+0x8   ;; ??QGFxDot
   \   00000026   0194               STR         R4,[SP, #+4]
   1111              model.hx = QGHx;                  // ¹Û²â·½³Ì
   \   00000028   124C               LDR         R4,??QGEKF_1+0xC   ;; ??QGHx
   \   0000002A   0294               STR         R4,[SP, #+8]
   1112              model.hxDot = QGHxDot;            // ¹Û²â·½³ÌÇóµ¼
   \   0000002C   124C               LDR         R4,??QGEKF_1+0x10  ;; ??QGHxDot
   \   0000002E   0394               STR         R4,[SP, #+12]
   1113          
   1114              // ÉèÖÃ×´Ì¬Á¿¡¢¹Û²âÁ¿¼°¹À¼ÆÖµ±£´æµØÖ·
   1115              mParam.state = state;        // ±¾´ÎÂË²¨µÄ×´Ì¬Öµ
   \   00000030   0490               STR         R0,[SP, #+16]
   1116              mParam.obs = obs;            // ¹Û²âÁ¿
   \   00000032   0591               STR         R1,[SP, #+20]
   1117              mParam.est = est;            // ¹À¼ÆÖµ±£´æµØÖ·
   \   00000034   0693               STR         R3,[SP, #+24]
   1118              mParam.othParam = param;     // ÂË²¨ÐèÒªµÄÆäËü²ÎÊý
   \   00000036   0792               STR         R2,[SP, #+28]
   1119              mParam.lenState = LEN_QG_STATE;    // ×´Ì¬Á¿³¤¶È
   \   00000038   0520               MOV         R0,#+5
   \   0000003A   0890               STR         R0,[SP, #+32]
   1120              mParam.lenObs = LEN_QG_OBS;        // ¹Û²âÁ¿³¤¶È
   \   0000003C   0320               MOV         R0,#+3
   \   0000003E   0990               STR         R0,[SP, #+36]
   1121          
   1122              // ÉèÖÃEKFÂË²¨ËùÐèÒªµÄ²ÎÊý
   1123              ekfParam.Q = Q;                    // QÕó
   \   00000040   0FA8               ADD         R0,SP,#+60
   \   00000042   0A90               STR         R0,[SP, #+40]
   1124              ekfParam.R = R;                    // RÕó
   \   00000044   19A8               ADD         R0,SP,#+100
   \   00000046   0B90               STR         R0,[SP, #+44]
   1125              ekfParam.Pk = (double*)s_Pk;       // Pk²ÎÊý
   \   00000048   0C48               LDR         R0,??QGEKF_1+0x14  ;; ??s_Pk_1
   \   0000004A   0C90               STR         R0,[SP, #+48]
   1126              ekfParam.preEst = s_preEst;        // ÉÏÒ»´ÎµÄ¹À¼ÆÖµ
   \   0000004C   011C               MOV         R1,R0
   \   0000004E   C831               ADD         R1,#+200
   \   00000050   0D91               STR         R1,[SP, #+52]
   1127              ekfParam.isFirst = &s_isFirst;     // ÊÇµÚÒ»´ÎÖ´ÐÐÂË²¨Âð
   \   00000052   F030               ADD         R0,#+240
   \   00000054   0E90               STR         R0,[SP, #+56]
   1128          
   1129              DoEKF(&model, &mParam, &ekfParam);    // EKFÂË²¨
   \   00000056   0AAA               ADD         R2,SP,#+40
   \   00000058   04A9               ADD         R1,SP,#+16
   \   0000005A   6846               MOV         R0,SP
   \   0000005C   ........           BL          ??DoEKF
   1130          
   1131              // Èç¹ûq0~q3µÄÂË²¨ÖµÓëÔ­Öµ²îµÄÌ«¶à¾ÍÓÃÔ­Öµ
   1132              /*for ( i=0; i<4; i++)
   1133              {
   1134                  err = est[i] - state[i];
   1135                  if ( (err > INF) || (err < -INF) )
   1136                  {
   1137                      est[i] = state[i];
   1138                      s_preEst[i] = state[i];
   1139                  }
   1140              
   1141              }*/  //by  sycÈ¥µô
   1142             
   1143          }
   \   00000060   1FB0               ADD         SP,#+124
   \   00000062   ........           BL          ?Subroutine18
   \   00000066   C046               NOP         
   \                     ??QGEKF_1:
   \   00000068   ........           DC32        `?<Constant {(1.0E-3), (1.0E-3), (1.0E-3), (1.0`
   \   0000006C   ........           DC32        `?<Constant {(1.0), (1.0), (1.0E-1)}>`
   \   00000070   ........           DC32        ??QGFxDot
   \   00000074   ........           DC32        ??QGHx
   \   00000078   ........           DC32        ??QGHxDot
   \   0000007C   ........           DC32        ??s_Pk_1

   \                                 In segment DATA_I, align 4, align-sorted
   \                     ??s_Pk_1:
   \   00000000                      DS8 200
   \   000000C8                      REQUIRE `?<Initializer for s_Pk>_1`
   \   000000C8                      DS8 40
   \   000000F0                      REQUIRE `?<Initializer for s_preEst>_1`
   \   000000F0                      DS8 4
   \   000000F4                      REQUIRE `?<Initializer for s_isFirst>_1`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable2:
   \   00000000   ........           DC32        Cbn

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable3:
   \   00000000   ........           DC32        ahrs_compass

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable4:
   \   00000000   ........           DC32        Cbn

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable7:
   \   00000000   0000F03F           DC32        0x3ff00000

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable9:
   \   00000000   ........           DC32        Cnb

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable10:
   \   00000000   ........           DC32        ??QGFxu

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable12:
   \   00000000   ........           DC32        Cbn

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable19:
   \   00000000   0000E03F           DC32        0x3fe00000

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable21:
   \   00000000   0000F03F           DC32        0x3ff00000

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable22:
   \   00000000   ........           DC32        ??QGFxu

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for window_vel_z>`:
   \   00000000   00000000           DC32 0H
   \   00000004   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0000        
   \                     `?<Initializer for UVW2_LEN>`:
   \   0000000C   01000000           DC32 1

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for s_Pk>`:
   \   00000000   7B14AE47E17A       DC32 47AE147BH, 3F847AE1H
   \              843F        
   \   00000008   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000018   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000028   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0000        
   \   00000030   000000000000       DC32 0H, 0H, 47AE147BH, 3F847AE1H
   \              00007B14AE47
   \              E17A843F    
   \   00000040   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000050   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000060   000000000000       DC32 0H, 0H, 0H, 0H, 47AE147BH, 3F847AE1H
   \              000000000000
   \              000000007B14
   \              AE47E17A843F
   \   00000078   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000088   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0000        
   \   00000090   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 47AE147BH, 3F847AE1H
   \              000000000000
   \              000000000000
   \              000000000000
   \              7B14AE47E17A
   \              843F        
   \   000000B0   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   000000C0   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 47AE147BH, 3F847AE1H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              00007B14AE47
   \              E17A843F    
   \   000000E8   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0000        
   \   000000F0   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 47AE147BH, 3F847AE1H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000007B14
   \              AE47E17A843F
   \                     `?<Initializer for s_preEst>`:
   \   00000120   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000130   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000140   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \                     `?<Initializer for s_isFirst>`:
   \   00000150   01000000           DC32 1

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for s_Pk>_1`:
   \   00000000   7B14AE47E17A       DC32 47AE147BH, 3F847AE1H
   \              843F        
   \   00000008   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000018   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000028   000000000000       DC32 0H, 0H, 47AE147BH, 3F847AE1H
   \              00007B14AE47
   \              E17A843F    
   \   00000038   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000048   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0000        
   \   00000050   000000000000       DC32 0H, 0H, 0H, 0H, 47AE147BH, 3F847AE1H
   \              000000000000
   \              000000007B14
   \              AE47E17A843F
   \   00000068   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000078   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 47AE147BH, 3F847AE1H
   \              000000000000
   \              000000000000
   \              000000000000
   \              7B14AE47E17A
   \              843F        
   \   00000098   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0000        
   \   000000A0   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 47AE147BH, 3F847AE1H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              00007B14AE47
   \              E17A843F    
   \                     `?<Initializer for s_preEst>_1`:
   \   000000C8   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   000000D8   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   000000E8   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0000        
   \                     `?<Initializer for s_isFirst>_1`:
   \   000000F0   01000000           DC32 1

   \                                 In segment DATA_C, align 4, align-sorted
   \   00000000   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              0000        
   \   00000044   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              0000        
   \   00000088   000000000000       DC32 0H, 0H
   \              0000        

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant {(1.0E-1), (1.0E-1), (1.49999999999`:
   \   00000000   9A9999999999       DC32 9999999AH, 3FB99999H, 9999999AH, 3FB99999H, 33333333H, 3FC33333H
   \              B93F9A999999
   \              9999B93F3333
   \              33333333C33F
   \   00000018   9A9999999999       DC32 9999999AH, 3FB99999H, 9999999AH, 3FB99999H, 0EB851EB8H, 3F9EB851H
   \              B93F9A999999
   \              9999B93FB81E
   \              85EB51B89E3F

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant {(2.9999999999999998E-1), (2.999999`:
   \   00000000   333333333333       DC32 33333333H, 3FD33333H, 33333333H, 3FD33333H, 33333333H, 3FD33333H
   \              D33F33333333
   \              3333D33F3333
   \              33333333D33F
   \   00000018   333333333333       DC32 33333333H, 3FD33333H, 33333333H, 3FD33333H, 33333333H, 3FD33333H
   \              D33F33333333
   \              3333D33F3333
   \              33333333D33F

   \                                 In segment DATA_C, align 4, align-sorted
   \   00000000   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              00000000    

   \                                 In segment DATA_C, align 4, align-sorted
   \   00000000   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              00000000    

   \                                 In segment DATA_C, align 4, align-sorted
   \   00000000   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              00000000    

   \                                 In segment DATA_C, align 4, align-sorted
   \   00000000   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              00000000    

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant {(1.0E-3), (1.0E-3), (1.0E-3), (1.0`:
   \   00000000   FCA9F1D24D62       DC32 0D2F1A9FCH, 3F50624DH, 0D2F1A9FCH, 3F50624DH, 0D2F1A9FCH
   \              503FFCA9F1D2
   \              4D62503FFCA9
   \              F1D2        
   \   00000014   4D62503FFCA9       DC32 3F50624DH, 0D2F1A9FCH, 3F50624DH, 0EB851EB8H, 3F9EB851H
   \              F1D24D62503F
   \              B81E85EB51B8
   \              9E3F        

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant {(1.0), (1.0), (1.0E-1)}>`:
   \   00000000   000000000000       DC32 0H, 3FF00000H, 0H, 3FF00000H, 9999999AH, 3FB99999H
   \              F03F00000000
   \              0000F03F9A99
   \              99999999B93F

   Maximum stack usage in bytes:

     Function                       CSTACK
     --------                       ------
     Cnb_update(double *)             100
     DoEKF(pModel, pModelParam, pEKFParam)
                                     2788
     EKF(double const *, double const *, double const *, double *)
                                      292
     Norm(double *)                    24
     PosVelEKF(double const *, double const *, double const *, double *)
                                      176
     PosVelFxDot(double const *, double const *, void *)
                                      176
     PosVelFxu(double const *, double const *, double *)
                                      124
     PosVelHx(double const *, double *)
                                        8
     PosVelHxDot(double const *, void *)
                                       24
     QGEKF(double const *, double const *, double const *, double *)
                                      144
     QGFxDot(double const *, double const *, void *)
                                      252
     QGFxu(double const *, double const *, double *)
                                       68
     QGHx(double const *, double *)    88
     QGHxDot(double const *, void *)
                                      500
     ahrs_init()                        8
     ahrs_update()                      4
     state_init()                      28
     uvw2_update(double)               36


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     K_Quat                           32
     ahrs_theta                       24
     Cbn                             136
     est_Kalman_State                 88
     raw_input_uvw                    24
     Cnb                              72
     offset_x                          8
     offset_y                          8
     Z_K_Quat                         32
     ahrs_init()                      48
     state_init()                    116
     ?Subroutine18                     6
     uvw2_update(double)             112
     window_vel_z                     16
     Cnb_update(double *)            528
     ahrs_update()                    10
     EKF(double const *, double const *, double const *, double *)
                                     438
     DoEKF(pModel, pModelParam, pEKFParam)
                                    1436
     ?Subroutine19                    12
     Norm(double *)                   86
     PosVelFxu(double const *, double const *, double *)
                                     716
     PosVelFxDot(double const *, double const *, void *)
                                     314
     PosVelHx(double const *, double *)
                                      20
     PosVelHxDot(double const *, void *)
                                      54
     PosVelEKF(double const *, double const *, double const *, double *)
                                     136
     s_Pk                            340
     QGFxu(double const *, double const *, double *)
                                     588
     QGFxDot(double const *, double const *, void *)
                                     360
     QGHx(double const *, double *)  350
     QGHxDot(double const *, void *)
                                    1240
     QGEKF(double const *, double const *, double const *, double *)
                                     128
     s_Pk                            244
     ??DataTable2                      4
     ??DataTable3                      4
     ??DataTable4                      4
     ??DataTable7                      4
     ??DataTable9                      4
     ??DataTable10                     4
     ??DataTable12                     4
     ??DataTable19                     4
     ??DataTable21                     4
     ??DataTable22                     4
     ?<Initializer for window_vel_z>
                                      16
     ?<Initializer for s_Pk>         340
     ?<Initializer for s_Pk>_1       244
     ?<Constant {{(0.0), (0.0), (0.0)}, {(0.0), (0.
                                     144
     ?<Constant {(1.0E-1), (1.0E-1), (1.49999999999
                                      48
     ?<Constant {(2.9999999999999998E-1), (2.999999
                                      48
     ?<Constant {(0.0), (0.0), (0.0), (0.0), (0.0)}
                                      40
     ?<Constant {(0.0), (0.0), (0.0), (0.0), (0.0)}_1
                                      40
     ?<Constant {(0.0), (0.0), (0.0), (0.0), (0.0)}_2
                                      40
     ?<Constant {(0.0), (0.0), (0.0), (0.0), (0.0)}_3
                                      40
     ?<Constant {(1.0E-3), (1.0E-3), (1.0E-3), (1.0
                                      40
     ?<Constant {(1.0), (1.0), (1.0E-1)}>
                                      24
      Others                         444

 
 7 158 bytes in segment CODE
   464 bytes in segment DATA_C
   600 bytes in segment DATA_I
   600 bytes in segment DATA_ID
   424 bytes in segment DATA_Z
    24 bytes in segment INITTAB
 
 6 738 bytes of CODE  memory (+ 444 bytes shared)
 1 064 bytes of CONST memory
 1 024 bytes of DATA  memory

Errors: none
Warnings: none
