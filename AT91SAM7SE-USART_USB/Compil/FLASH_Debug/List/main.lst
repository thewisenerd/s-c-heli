##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.31A/W32 EVALUATION    07/Jan/2016  21:50:25 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\src\main.c             #
#    Command line    =  H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\src\main.c -lC         #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Lis #
#                       t\ -o H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6- #
#                       27ËøÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»® #
#                       +LQR_2014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Deb #
#                       ug\Obj\ -z9 --debug --cpu_mode thumb --endian        #
#                       little --cpu ARM7TDMI --stack_align 4 --interwork    #
#                       -e --fpu None --ec++ --dlib_config                   #
#                       D:\IAREWE431\ARM\LIB\dl4tptinl8n.h -I                #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\srcIAR\ -I      #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\src\ -I      #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\ -I       #
#                       H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\kalman\   #
#                       -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27Ë #
#                       øÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\pcm\   #
#                       -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27Ë #
#                       øÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\spi\   #
#                       -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27Ë #
#                       øÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\timer\ #
#                        -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27 #
#                       ËøÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+L #
#                       QR_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\pid\  #
#                       -I H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27Ë #
#                       øÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\avcs\  #
#                       -I D:\IAREWE431\ARM\INC\                             #
#    List file       =  H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Lis #
#                       t\main.lst                                           #
#    Object file     =  H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ² #
#                       \Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Obj #
#                       \main.r79                                            #
#                                                                            #
#                                                                            #
##############################################################################

H:\ÊµÑéÊÒ¹¤×÷2015-8-20\2014-10-1ÊµÑéÊÒ\2015-6-27ËøÎ²\Ð¡Ö±Éý»ú´úÂë²âÊÔ1-6\Ð¡Ö±Éý»ú´úÂë²âÊÔ\Â·¾¶¹æ»®+LQR_2014_7_31\AT91SAM7SE-USART_USB\src\main.c
      1          //*--------------------------------------------------------------------------------------
      2          //*      ATMEL Microcontroller Software Support  -  ROUSSET  -
      3          //*--------------------------------------------------------------------------------------
      4          //* The software is delivered "AS IS" without warranty or condition of any
      5          //* kind, either express, implied or statutory. This includes without
      6          //* limitation any warranty or condition with respect to merchantability or
      7          //* fitness for any particular purpose, or against the infringements of
      8          //* intellectual property rights of others.
      9          //*--------------------------------------------------------------------------------------
     10          //* File Name           : main file
     11          //* Object              :
     12          //* Translator          :
     13          //* 1.0 02/Mar/05 JPP	: Creation
     14          //*--------------------------------------------------------------------------------------
     15          
     16          #include <includs.h>
     17          extern int first_entry_circle;
     18          int round_count;
     19          
     20          extern struct bmp085_t  bmp085;
     21          
     22          extern void Usart_init ( void );
     23          extern void AT91F_US_Put( char *buffer); // \arg pointer to a string ending by \0
     24          extern void AT91F_DBGU_Init(void);
     25          extern void AT91F_DBGU_Put(char *buffer);
     26          
     27          
     28          struct  Target_Command     target_command;
     29          struct  Target_Queue       target_queue;
     30          struct  Position           position;
     31          struct  Trajectory         trajectory;
     32          
     33          double theta[ 3 ];

   \                                 In segment DATA_I, align 4, align-sorted
     34          double angle_offset[3] = {3.0,1.0,0.0};//roll pitch yaw
   \                     angle_offset:
   \   00000000                      DS8 24
   \   00000018                      REQUIRE `?<Initializer for angle_offset>`
     35          int first_receive_target;
     36          int manual_to_hover;
     37          enum  Heli_mod
     38          {	
     39              Off,
     40              Manual,
     41              Begin_Auto,
     42              Auto
     43          } heli_mod;                     //·É»ú·ÉÐÐÄ£Ê½£º×Ô¿Ø£¬ÊÖ¿Ø..
     44          /*
     45          enum  Trajectory_mod
     46          {
     47          	Hover,
     48          	Point_to_point,
     49          	Circle,
     50          	Mixture,
     51          	Test
     52          }trajectory_mod;
     53          */
     54          //---------------------------------------------------------------------------------//     
     55          
     56          //*--------------------------------------------------------------------------------------
     57          //* Function Name       : main
     58          //* Object              :
     59          //*--------------------------------------------------------------------------------------

   \                                 In segment CODE, align 4, keep-with-next
     60          int main ( void )
     61          {
   \                     main:
   \   00000000   F3B5               PUSH        {R0,R1,R4-R7,LR}
     62             
     63              char ahrs_init_count=0;
   \   00000002   0025               MOV         R5,#+0
     64              char ahrs_init_flag=1;
   \   00000004   0126               MOV         R6,#+1
     65              heli_mod = Manual;
   \   00000006   AB4C               LDR         R4,??main_0        ;; heli_mod
   \   00000008   2670               STRB        R6,[R4, #+0]
     66                
     67              AT91C_BASE_RSTC->RSTC_RMR = AT91C_RSTC_URSTEN | (0x4<<8) | (unsigned int)(0xA5<<24);
   \   0000000A   AB48               LDR         R0,??main_0+0x4    ;; 0xfffffd08
   \   0000000C   AB49               LDR         R1,??main_0+0x8    ;; 0xa5000401
   \   0000000E   0160               STR         R1,[R0, #+0]
     68          //----------------------systerm initial--------------------------------------//  
     69              init_translator();
   \   00000010   ........           _BLF        ??init_translator,??init_translator??rT
     70              //PIOB0_init(); //È¥µôcompassÍâ²¿ÖÐ¶Ï10.30 syc
     71              AT91F_SpiInit();
   \   00000014   ........           _BLF        ??AT91F_SpiInit,??AT91F_SpiInit??rT
     72              Usart1_init(); 
   \   00000018   ........           _BLF        ??Usart1_init,??Usart1_init??rT
   \   0000001C   A848               LDR         R0,??main_0+0xC    ;; 0xfffff434
   \   0000001E   0221               MOV         R1,#+2
   \   00000020   0160               STR         R1,[R0, #+0]
     73              CDCLKRESET;//PA1=0;
     74              Usart_init();
   \   00000022   ........           _BLF        ??Usart_init,??Usart_init??rT
     75              AT91F_DBGU_Init();
   \   00000026   ........           _BLF        ??AT91F_DBGU_Init,??AT91F_DBGU_Init??rT
     76              //FIQ_init();//10.30 syc
     77              CDCLKSET;//PA1=1;
   \   0000002A   A64F               LDR         R7,??main_0+0x10   ;; 0xfffff430
   \   0000002C   0220               MOV         R0,#+2
   \   0000002E   3860               STR         R0,[R7, #+0]
     78              timer_init();
   \   00000030   ........           _BLF        ??timer_init,??timer_init??rT
     79              twi_init();
   \   00000034   ........           _BLF        ??twi_init,??twi_init??rT
     80              scp1000_init();
   \   00000038   ........           _BLF        ??scp1000_init,??scp1000_init??rT
     81          
     82              SSSET;//PA31Ã»ÓÃµ½£¬Õâ¸öÃ»ÓÃ
   \   0000003C   8020               MOV         R0,#+128
   \   0000003E   0006               LSL         R0,R0,#+24         ;; #-2147483648
   \   00000040   3860               STR         R0,[R7, #+0]
     83              //COMPASSRESET; //syc compass¶ÁÈ¡·½Ê½¸Ä±ä²»ÐèÒª¹Ü½ÅÖÐ¶Ï
     84             // CDCLKRESET; 
     85               reset_controller();
   \   00000042   ........           _BLF        ??reset_controller,??reset_controller??rT
     86               target_command.reset();
   \   00000046   201C               MOV         R0,R4
   \   00000048   3030               ADD         R0,#+48
   \   0000004A   ........           _BLF        ??reset,??reset??rT
   \   0000004E   9E48               LDR         R0,??main_0+0x14   ;; trajectory + 48
   \   00000050   0090               STR         R0,[SP, #+0]
   \   00000052   9E49               LDR         R1,??main_0+0x18   ;; position
   \   00000054   4160               STR         R1,[R0, #+4]
     87               trajectory.position_t = & position;
     88               trajectory.target_queue_t = &target_queue;
   \   00000056   201C               MOV         R0,R4
   \   00000058   F430               ADD         R0,#+244
   \   0000005A   0190               STR         R0,[SP, #+4]
   \   0000005C   0098               LDR         R0,[SP, #+0]
   \   0000005E   0199               LDR         R1,[SP, #+4]
   \   00000060   0160               STR         R1,[R0, #+0]
     89               trajectory.reset();
   \   00000062   9B48               LDR         R0,??main_0+0x1C   ;; trajectory
   \   00000064   ........           _BLF        ??reset_1,??reset??rT_1
   \   00000068   0AE0               B           ??main_1
     90              
     91          //-----------------------------------------------------------------------------//
     92            
     93          //-------------------kalman initial--------------------------------------------// 
     94          while(1)
     95          {
     96              if(READY_30HZ==1)
     97                {
     98                  READY_30HZ=0;
     99                // AT91C_BASE_PIOA->PIO_SODR = AT91C_PIO_PA11;
    100                 AT91F_TC_InterruptEnable(AT91C_BASE_TC0,AT91C_TC_CPAS);
    101                 AT91C_BASE_TC0->TC_RA =312+AT91C_BASE_TC0 -> TC_CV; 
    102                 HDG=1;
    103                if(ahrs_init_flag==1&&raw_imu_update==true&&ahrs_init_count<20)
    104                     {
    105                           //IMU_OUTPUT();
    106                            ahrs_init_count++;
   \                     ??main_2:
   \   0000006A   6D1C               ADD         R5,R5,#+1
   \   0000006C   2D06               LSL         R5,R5,#+24
   \   0000006E   2D0E               LSR         R5,R5,#+24
    107                            raw_imu_update=false;
   \   00000070   9848               LDR         R0,??main_0+0x20   ;; raw_imu_update
   \   00000072   0021               MOV         R1,#+0
   \   00000074   0170               STRB        R1,[R0, #+0]
    108                            if(ahrs_init_count==20)
   \   00000076   142D               CMP         R5,#+20
   \   00000078   00D1               BNE         ??main_3
    109                             ahrs_init_flag=0;
   \   0000007A   0026               MOV         R6,#+0
    110                            sensor_update();
   \                     ??main_3:
   \   0000007C   ........           _BLF        ??sensor_update,??sensor_update??rT
    111                     }
   \                     ??main_1:
   \   00000080   9548               LDR         R0,??main_0+0x24   ;; READY_30HZ
   \   00000082   0078               LDRB        R0,[R0, #+0]
   \   00000084   0128               CMP         R0,#+1
   \   00000086   FBD1               BNE         ??main_1
   \   00000088   9348               LDR         R0,??main_0+0x24   ;; READY_30HZ
   \   0000008A   0021               MOV         R1,#+0
   \   0000008C   0170               STRB        R1,[R0, #+0]
   \   0000008E   9348               LDR         R0,??main_0+0x28   ;; 0xfffa0024
   \   00000090   0421               MOV         R1,#+4
   \   00000092   0160               STR         R1,[R0, #+0]
   \   00000094   9248               LDR         R0,??main_0+0x2C   ;; 0xfffa0014
   \   00000096   9349               LDR         R1,??main_0+0x30   ;; 0xfffa0010
   \   00000098   0968               LDR         R1,[R1, #+0]
   \   0000009A   9C22               MOV         R2,#+156
   \   0000009C   5200               LSL         R2,R2,#+1          ;; #+312
   \   0000009E   8918               ADD         R1,R1,R2
   \   000000A0   0160               STR         R1,[R0, #+0]
   \   000000A2   9148               LDR         R0,??main_0+0x34   ;; HDG
   \   000000A4   0121               MOV         R1,#+1
   \   000000A6   0170               STRB        R1,[R0, #+0]
   \   000000A8   012E               CMP         R6,#+1
   \   000000AA   05D1               BNE         ??main_4
   \   000000AC   8948               LDR         R0,??main_0+0x20   ;; raw_imu_update
   \   000000AE   0078               LDRB        R0,[R0, #+0]
   \   000000B0   0028               CMP         R0,#+0
   \   000000B2   01D0               BEQ         ??main_4
   \   000000B4   142D               CMP         R5,#+20
   \   000000B6   D8D3               BCC         ??main_2
    112                else if(ahrs_init_count >= 20)
   \                     ??main_4:
   \   000000B8   142D               CMP         R5,#+20
   \   000000BA   E1D3               BCC         ??main_1
    113                    {
    114                      raw_imu_update=false;
   \   000000BC   8548               LDR         R0,??main_0+0x20   ;; raw_imu_update
   \   000000BE   0021               MOV         R1,#+0
   \   000000C0   0170               STRB        R1,[R0, #+0]
   \   000000C2   8A48               LDR         R0,??main_0+0x38   ;; timer0_num
   \   000000C4   0160               STR         R1,[R0, #+0]
    115                      timer0_num=0;
    116                      HDG=2;
   \   000000C6   8848               LDR         R0,??main_0+0x34   ;; HDG
   \   000000C8   0221               MOV         R1,#+2
   \   000000CA   0170               STRB        R1,[R0, #+0]
    117                      break;
    118                    }
    119                }//end if(READY_30HZ==1)
    120          }//while(1)
    121          ahrs_init();
   \   000000CC   ........           _BLF        ??ahrs_init,??ahrs_init??rT
   \   000000D0   28E0               B           ??main_5
    122            
    123          //-----------------------------------------------------------------------------//
    124          
    125          for(;;)//main loop
    126          {   
    127          //---------- sycÔÚ¶¨Ê±Æ÷T0ÀïÃæ read IMU(SPI)  bmp(I2C) compass(I2C) £¨ÓëÊ¦ÐÖÇø±ð×î´óµØ·½£©--------//
    128                  
    129              
    130               if(HDG==2 && raw_imu_update==false)
    131               {
    132                 HDG=1;   
    133                 AT91C_BASE_TC0->TC_RA = 312+AT91C_BASE_TC0 -> TC_CV;
    134                 if(timer0_num == 0)
    135                 AT91F_TC_InterruptEnable(AT91C_BASE_TC0,AT91C_TC_CPAS); 
    136               }
    137               
    138                 gps_update();
    139          
    140          //*-----------------------------------------------------------------------------*//
    141                if(READY_30HZ==1)
    142                { 
    143                   READY_30HZ=0;
    144                   imu_monitor();
    145                   gps_monitor();
    146                          
    147                   if(raw_imu_update==true)//raw_imu_update  in timer.c
    148                   {
    149                    
    150                       raw_imu_update = false;
    151                       sensor_update();
    152                       accel_filter(ahrs_accel,imu_accel,15); 
    153          			 ahrs_accel[2] = imu_accel[2];
    154                       ahrs_update();     //kalman filter   
    155                       //---------sycÆøÑ¹¼Æ¸üÐÂ-------------// 
    156                       if(bmp_update_flag==2)
    157                       {
    158                          bmp_update_flag=1;
    159                          scp1000_update();
    160                          static double last_bmp_height = 0.0;
    161                          if(bmp_height - last_bmp_height > 5.0 || bmp_height - last_bmp_height < -5.0) bmp_height = last_bmp_height;
    162                          last_bmp_height = bmp_height;
    163                       }
    164                        
    165                      //-----PID parameter update--------------//
    166                         //-----PID parameter update--------------//
    167                      if(groundtoarm_flag==1)
    168                       {
    169                         deal_groundtoarm_date_auto();//in pcm.c
    170                         groundtoarm_flag = 0;
    171                       }
    172          
    173          
    174                      //-----------target update ----------------//
    175                       if ( target_receive_flag == true )
    176                       {
    177          		if (false == target_queue.push_target(&target_command))   
    178                            	trajectory.brake_down_step();
    179          
    180                          first_receive_target ++;
    181                          target_receive_flag = false;
    182                       }
    183                     //-----------control step------------------//
    184                       if( (control_mode==1) || (control_mode==0) ) //manual 
    185                       {   
    186                           target_command.reset();
    187                           trajectory.reset();
    188                           first_receive_target  = 0;//
    189                           manual_to_hover = 0;
    190                           heli_mod = Manual ;			 
    191          //----------------------Â·¾¶¹æ»®Ä£Ê½Ñ¡Ôñ---------------------------//			 
    192          		 trajectory.trajectory_mod = Point_to_point;
    193          //-----------------------------------------------------------------//		          			  
    194                           pwm_coll_mid = manual_servo_widths[1];//syc 4.16 ¸ß¶ÈÏî»ùÖµÈ¡ÊÖ¿ØÖµ
    195                           temp_pwm_coll_mid = manual_servo_widths[1];//Ç°·É¸ß¶È²¹³¥ÓÃ 
    196                       }
    197                  
    198                      if( control_mode==3 && last_control_mode==1 )
    199                           heli_mod = Begin_Auto;
    200                       
    201                       if( heli_mod == Begin_Auto )
    202                       {
    203                           heli_mod = Auto;
    204                           trajectory.heli_step = 1;
    205                           first_entry_circle = 1;
    206                           set_init_state();		 
    207                       }
    208                       if (heli_mod == Auto)
    209                       {
    210                           manual_to_hover ++;
    211                           if(manual_to_hover == 100)
    212                           {
    213                              trajectory.hover_xyz[0] = position.current_xyz[0] ;
    214                              trajectory.hover_xyz[1] = position.current_xyz[1] ;
    215                              trajectory.hover_xyz[2] = position.current_xyz[2] ;
    216                              manual_to_hover = 200;
    217                           }
    218                           if(manual_to_hover >= 10000)
   \                     ??main_6:
   \   000000D2   8749               LDR         R1,??main_0+0x3C   ;; 0x2710
   \   000000D4   8842               CMP         R0,R1
   \   000000D6   00DB               BLT         ??main_7
    219                              manual_to_hover = 200;
   \                     ??main_8:
   \   000000D8   E262               STR         R2,[R4, #+44]
    220                           //if(manual_to_hover>= 200)
    221                              trajectory.step(trajectory.trajectory_mod);
   \                     ??main_7:
   \   000000DA   297C               LDRB        R1,[R5, #+16]
   \   000000DC   7C48               LDR         R0,??main_0+0x1C   ;; trajectory
   \   000000DE   ........           _BLF        ??step,??step??rT
    222          		//hoverµãÔÚ×Ô¿Ø100´Îºó±ä ²»ÉÏ´«Ä¿±êµã ·É»úÎ»ÖÃÊÇÏà¶ÔÓÚµÚÒ»´ÎÊ±·É»úÐüÍ£µã
    223          		//ÉÏ´«Ä¿±êµãÊ± ÊÇÏà¶ÔÓÚ100´ÎºóµÄÐüÍ£µã
    224                       }
    225                      //ahrs_adjust(ahrs_theta,angle_offset);//×ËÌ¬½ÃÕý
    226          //            input_yaw = yaw_convert(ahrs_theta[2],position.heading);  //heading ÊÇÄ¿±êº½ÐÐ£¬¼´yawÍ¨µÀÊäÈëÖµ
    227          //	    xyz_transform(input_xyz, &position, &trajectory);//update input_xyz  //¸ù¾Ýµ±Ç°×ø±êºÍµ±Ç°Ä¿±ê¼ÆËãµÃµ½»úÌå×ø±ê
    228                                               
    229          //***************************question*************************************************//
    230                      //ahrs_theta[0] = ahrs_theta[0] - (double)amplify/572.9578;
    231          //************************************************************************************//			
    232          	    theta[2] = input_yaw;       //·´À¡Öµ
   \                     ??main_9:
   \   000000E2   221C               MOV         R2,R4
   \   000000E4   1432               ADD         R2,#+20
   \   000000E6   8348               LDR         R0,??main_0+0x40   ;; input_yaw
   \   000000E8   03C8               LDMIA       R0!,{R0,R1}
   \   000000EA   03C2               STMIA       R2!,{R0,R1}
    233                      theta[1] = ahrs_theta[1];
   \   000000EC   824A               LDR         R2,??main_0+0x44   ;; ahrs_theta
   \   000000EE   231C               MOV         R3,R4
   \   000000F0   0C33               ADD         R3,#+12
   \   000000F2   101C               MOV         R0,R2
   \   000000F4   0830               ADD         R0,#+8
   \   000000F6   03C8               LDMIA       R0!,{R0,R1}
   \   000000F8   03C3               STMIA       R3!,{R0,R1}
    234                      theta[0] = ahrs_theta[0];     
   \   000000FA   231D               ADD         R3,R4,#+4
   \   000000FC   03CA               LDMIA       R2!,{R0,R1}
   \   000000FE   03C3               STMIA       R3!,{R0,R1}
    235                       
    236                       if(round_count > 300)
   \   00000100   606A               LDR         R0,[R4, #+36]
   \   00000102   FF21               MOV         R1,#+255
   \   00000104   2E31               ADD         R1,#+46            ;; #+301
   \   00000106   8842               CMP         R0,R1
   \   00000108   05DB               BLT         ??main_10
    237                       if(round_count > 10000)
   \   0000010A   7C49               LDR         R1,??main_0+0x48   ;; 0x2711
   \   0000010C   8842               CMP         R0,R1
   \   0000010E   02DB               BLT         ??main_10
    238                          round_count = 500;   
   \   00000110   FA20               MOV         R0,#+250
   \   00000112   4000               LSL         R0,R0,#+1          ;; #+500
   \   00000114   6062               STR         R0,[R4, #+36]
    239                          
    240                   }//end if(raw_imu_update == 1)  
    241                  round_count ++;
   \                     ??main_10:
   \   00000116   606A               LDR         R0,[R4, #+36]
   \   00000118   401C               ADD         R0,R0,#+1
   \   0000011A   6062               STR         R0,[R4, #+36]
    242                  servo_update_auto();
   \   0000011C   ........           _BLF        ??servo_update_auto,??servo_update_auto??rT
    243                  output2ground();     
   \   00000120   ........           _BLF        ??output2ground,??output2ground??rT
   \                     ??main_5:
   \   00000124   7048               LDR         R0,??main_0+0x34   ;; HDG
   \   00000126   0078               LDRB        R0,[R0, #+0]
   \   00000128   0228               CMP         R0,#+2
   \   0000012A   14D1               BNE         ??main_11
   \   0000012C   6948               LDR         R0,??main_0+0x20   ;; raw_imu_update
   \   0000012E   0078               LDRB        R0,[R0, #+0]
   \   00000130   0028               CMP         R0,#+0
   \   00000132   10D1               BNE         ??main_11
   \   00000134   6C48               LDR         R0,??main_0+0x34   ;; HDG
   \   00000136   0121               MOV         R1,#+1
   \   00000138   0170               STRB        R1,[R0, #+0]
   \   0000013A   6948               LDR         R0,??main_0+0x2C   ;; 0xfffa0014
   \   0000013C   6949               LDR         R1,??main_0+0x30   ;; 0xfffa0010
   \   0000013E   0968               LDR         R1,[R1, #+0]
   \   00000140   9C22               MOV         R2,#+156
   \   00000142   5200               LSL         R2,R2,#+1          ;; #+312
   \   00000144   8918               ADD         R1,R1,R2
   \   00000146   0160               STR         R1,[R0, #+0]
   \   00000148   6848               LDR         R0,??main_0+0x38   ;; timer0_num
   \   0000014A   0068               LDR         R0,[R0, #+0]
   \   0000014C   0028               CMP         R0,#+0
   \   0000014E   02D1               BNE         ??main_11
   \   00000150   6248               LDR         R0,??main_0+0x28   ;; 0xfffa0024
   \   00000152   0421               MOV         R1,#+4
   \   00000154   0160               STR         R1,[R0, #+0]
   \                     ??main_11:
   \   00000156   ........           _BLF        ??gps_update,??gps_update??rT
   \   0000015A   5F48               LDR         R0,??main_0+0x24   ;; READY_30HZ
   \   0000015C   0078               LDRB        R0,[R0, #+0]
   \   0000015E   0128               CMP         R0,#+1
   \   00000160   E0D1               BNE         ??main_5
   \   00000162   5D48               LDR         R0,??main_0+0x24   ;; READY_30HZ
   \   00000164   0021               MOV         R1,#+0
   \   00000166   0170               STRB        R1,[R0, #+0]
   \   00000168   ........           _BLF        ??imu_monitor,??imu_monitor??rT
   \   0000016C   ........           _BLF        ??gps_monitor,??gps_monitor??rT
   \   00000170   5848               LDR         R0,??main_0+0x20   ;; raw_imu_update
   \   00000172   0078               LDRB        R0,[R0, #+0]
   \   00000174   0028               CMP         R0,#+0
   \   00000176   CED0               BEQ         ??main_10
   \   00000178   5648               LDR         R0,??main_0+0x20   ;; raw_imu_update
   \   0000017A   0021               MOV         R1,#+0
   \   0000017C   0170               STRB        R1,[R0, #+0]
   \   0000017E   ........           _BLF        ??sensor_update,??sensor_update??rT
   \   00000182   5F4D               LDR         R5,??main_0+0x4C   ;; ahrs_accel
   \   00000184   5F4E               LDR         R6,??main_0+0x50   ;; imu_accel
   \   00000186   0F22               MOV         R2,#+15
   \   00000188   311C               MOV         R1,R6
   \   0000018A   281C               MOV         R0,R5
   \   0000018C   ........           _BLF        ??accel_filter,??accel_filter??rT
   \   00000190   1035               ADD         R5,#+16
   \   00000192   1036               ADD         R6,#+16
   \   00000194   03CE               LDMIA       R6!,{R0,R1}
   \   00000196   03C5               STMIA       R5!,{R0,R1}
   \   00000198   ........           _BLF        ??ahrs_update,??ahrs_update??rT
   \   0000019C   5A48               LDR         R0,??main_0+0x54   ;; bmp_update_flag
   \   0000019E   0178               LDRB        R1,[R0, #+0]
   \   000001A0   0229               CMP         R1,#+2
   \   000001A2   24D1               BNE         ??main_12
   \   000001A4   0121               MOV         R1,#+1
   \   000001A6   0170               STRB        R1,[R0, #+0]
   \   000001A8   ........           _BLF        ??scp1000_update,??scp1000_update??rT
   \   000001AC   574D               LDR         R5,??main_0+0x58   ;; bmp_height
   \   000001AE   03CD               LDMIA       R5!,{R0,R1}
   \   000001B0   083D               SUB         R5,#+8
   \   000001B2   221C               MOV         R2,R4
   \   000001B4   1C32               ADD         R2,#+28
   \   000001B6   0CCA               LDMIA       R2!,{R2,R3}
   \   000001B8   ........           _BLF        __dSub,??__dSub??rT
   \   000001BC   061C               MOV         R6,R0
   \   000001BE   0F1C               MOV         R7,R1
   \   000001C0   0122               MOV         R2,#+1
   \   000001C2   534B               LDR         R3,??main_0+0x5C   ;; 0x40140000
   \   000001C4   ........           _BLF        __dGreaterEqual,??__dGreaterEqual??rT
   \   000001C8   0028               CMP         R0,#+0
   \   000001CA   07D1               BNE         ??main_13
   \   000001CC   301C               MOV         R0,R6
   \   000001CE   391C               MOV         R1,R7
   \   000001D0   0022               MOV         R2,#+0
   \   000001D2   504B               LDR         R3,??main_0+0x60   ;; 0xc0140000
   \   000001D4   ........           _BLF        __dLess,??__dLess??rT
   \   000001D8   0028               CMP         R0,#+0
   \   000001DA   04D0               BEQ         ??main_14
   \                     ??main_13:
   \   000001DC   201C               MOV         R0,R4
   \   000001DE   1C30               ADD         R0,#+28
   \   000001E0   03C8               LDMIA       R0!,{R0,R1}
   \   000001E2   03C5               STMIA       R5!,{R0,R1}
   \   000001E4   083D               SUB         R5,#+8
   \                     ??main_14:
   \   000001E6   221C               MOV         R2,R4
   \   000001E8   1C32               ADD         R2,#+28
   \   000001EA   03CD               LDMIA       R5!,{R0,R1}
   \   000001EC   03C2               STMIA       R2!,{R0,R1}
   \                     ??main_12:
   \   000001EE   4A4D               LDR         R5,??main_0+0x64   ;; groundtoarm_flag
   \   000001F0   2878               LDRB        R0,[R5, #+0]
   \   000001F2   0128               CMP         R0,#+1
   \   000001F4   03D1               BNE         ??main_15
   \   000001F6   ........           _BLF        ??deal_groundtoarm_date_auto,??deal_groundtoarm_date_auto??rT
   \   000001FA   0020               MOV         R0,#+0
   \   000001FC   2870               STRB        R0,[R5, #+0]
   \                     ??main_15:
   \   000001FE   474D               LDR         R5,??main_0+0x68   ;; target_receive_flag
   \   00000200   2878               LDRB        R0,[R5, #+0]
   \   00000202   0028               CMP         R0,#+0
   \   00000204   0ED0               BEQ         ??main_16
   \   00000206   211C               MOV         R1,R4
   \   00000208   3031               ADD         R1,#+48
   \   0000020A   0198               LDR         R0,[SP, #+4]
   \   0000020C   ........           _BLF        ??push_target,??push_target??rT
   \   00000210   0028               CMP         R0,#+0
   \   00000212   02D1               BNE         ??main_17
   \   00000214   2E48               LDR         R0,??main_0+0x1C   ;; trajectory
   \   00000216   ........           _BLF        ??brake_down_step,??brake_down_step??rT
   \                     ??main_17:
   \   0000021A   A06A               LDR         R0,[R4, #+40]
   \   0000021C   401C               ADD         R0,R0,#+1
   \   0000021E   A062               STR         R0,[R4, #+40]
   \   00000220   0020               MOV         R0,#+0
   \   00000222   2870               STRB        R0,[R5, #+0]
   \                     ??main_16:
   \   00000224   3E4D               LDR         R5,??main_0+0x6C   ;; trajectory + 224
   \   00000226   3F4E               LDR         R6,??main_0+0x70   ;; control_mode
   \   00000228   3078               LDRB        R0,[R6, #+0]
   \   0000022A   0128               CMP         R0,#+1
   \   0000022C   01D0               BEQ         ??main_18
   \   0000022E   0028               CMP         R0,#+0
   \   00000230   12D1               BNE         ??main_19
   \                     ??main_18:
   \   00000232   201C               MOV         R0,R4
   \   00000234   3030               ADD         R0,#+48
   \   00000236   ........           _BLF        ??reset,??reset??rT
   \   0000023A   2548               LDR         R0,??main_0+0x1C   ;; trajectory
   \   0000023C   ........           _BLF        ??reset_1,??reset??rT_1
   \   00000240   0020               MOV         R0,#+0
   \   00000242   A062               STR         R0,[R4, #+40]
   \   00000244   E062               STR         R0,[R4, #+44]
   \   00000246   0120               MOV         R0,#+1
   \   00000248   2070               STRB        R0,[R4, #+0]
   \   0000024A   2874               STRB        R0,[R5, #+16]
   \   0000024C   3648               LDR         R0,??main_0+0x74   ;; manual_servo_widths + 4
   \   0000024E   0068               LDR         R0,[R0, #+0]
   \   00000250   3649               LDR         R1,??main_0+0x78   ;; pwm_coll_mid
   \   00000252   0860               STR         R0,[R1, #+0]
   \   00000254   3649               LDR         R1,??main_0+0x7C   ;; temp_pwm_coll_mid
   \   00000256   0860               STR         R0,[R1, #+0]
   \                     ??main_19:
   \   00000258   3078               LDRB        R0,[R6, #+0]
   \   0000025A   0328               CMP         R0,#+3
   \   0000025C   03D1               BNE         ??main_20
   \   0000025E   3548               LDR         R0,??main_0+0x80   ;; last_control_mode
   \   00000260   0078               LDRB        R0,[R0, #+0]
   \   00000262   0128               CMP         R0,#+1
   \   00000264   02D0               BEQ         ??main_21
   \                     ??main_20:
   \   00000266   2078               LDRB        R0,[R4, #+0]
   \   00000268   0228               CMP         R0,#+2
   \   0000026A   07D1               BNE         ??main_22
   \                     ??main_21:
   \   0000026C   0320               MOV         R0,#+3
   \   0000026E   2070               STRB        R0,[R4, #+0]
   \   00000270   0120               MOV         R0,#+1
   \   00000272   2860               STR         R0,[R5, #+0]
   \   00000274   3049               LDR         R1,??main_0+0x84   ;; first_entry_circle
   \   00000276   0860               STR         R0,[R1, #+0]
   \   00000278   ........           _BLF        ??set_init_state,??set_init_state??rT
   \                     ??main_22:
   \   0000027C   2078               LDRB        R0,[R4, #+0]
   \   0000027E   0328               CMP         R0,#+3
   \   00000280   ....               BEQ         .+5
   \   00000282   2EE7               B           ??main_9
   \   00000284   E06A               LDR         R0,[R4, #+44]
   \   00000286   401C               ADD         R0,R0,#+1
   \   00000288   E062               STR         R0,[R4, #+44]
   \   0000028A   C822               MOV         R2,#+200
   \   0000028C   6428               CMP         R0,#+100
   \   0000028E   ....               BEQ         .+5
   \   00000290   1FE7               B           ??main_6
   \   00000292   009B               LDR         R3,[SP, #+0]
   \   00000294   3833               ADD         R3,#+56
   \   00000296   0D48               LDR         R0,??main_0+0x18   ;; position
   \   00000298   03C8               LDMIA       R0!,{R0,R1}
   \   0000029A   03C3               STMIA       R3!,{R0,R1}
   \   0000029C   009B               LDR         R3,[SP, #+0]
   \   0000029E   4033               ADD         R3,#+64
   \   000002A0   2648               LDR         R0,??main_0+0x88   ;; position + 8
   \   000002A2   03C8               LDMIA       R0!,{R0,R1}
   \   000002A4   03C3               STMIA       R3!,{R0,R1}
   \   000002A6   009B               LDR         R3,[SP, #+0]
   \   000002A8   4833               ADD         R3,#+72
   \   000002AA   2548               LDR         R0,??main_0+0x8C   ;; position + 16
   \   000002AC   03C8               LDMIA       R0!,{R0,R1}
   \   000002AE   03C3               STMIA       R3!,{R0,R1}
   \   000002B0   12E7               B           ??main_8
   \   000002B2   C046               NOP         
   \                     ??main_0:
   \   000002B4   ........           DC32        heli_mod
   \   000002B8   08FDFFFF           DC32        0xfffffd08
   \   000002BC   010400A5           DC32        0xa5000401
   \   000002C0   34F4FFFF           DC32        0xfffff434
   \   000002C4   30F4FFFF           DC32        0xfffff430
   \   000002C8   ........           DC32        trajectory + 48
   \   000002CC   ........           DC32        position
   \   000002D0   ........           DC32        trajectory
   \   000002D4   ........           DC32        raw_imu_update
   \   000002D8   ........           DC32        READY_30HZ
   \   000002DC   2400FAFF           DC32        0xfffa0024
   \   000002E0   1400FAFF           DC32        0xfffa0014
   \   000002E4   1000FAFF           DC32        0xfffa0010
   \   000002E8   ........           DC32        HDG
   \   000002EC   ........           DC32        timer0_num
   \   000002F0   10270000           DC32        0x2710
   \   000002F4   ........           DC32        input_yaw
   \   000002F8   ........           DC32        ahrs_theta
   \   000002FC   11270000           DC32        0x2711
   \   00000300   ........           DC32        ahrs_accel
   \   00000304   ........           DC32        imu_accel
   \   00000308   ........           DC32        bmp_update_flag
   \   0000030C   ........           DC32        bmp_height
   \   00000310   00001440           DC32        0x40140000
   \   00000314   000014C0           DC32        0xc0140000
   \   00000318   ........           DC32        groundtoarm_flag
   \   0000031C   ........           DC32        target_receive_flag
   \   00000320   ........           DC32        trajectory + 224
   \   00000324   ........           DC32        control_mode
   \   00000328   ........           DC32        manual_servo_widths + 4
   \   0000032C   ........           DC32        pwm_coll_mid
   \   00000330   ........           DC32        temp_pwm_coll_mid
   \   00000334   ........           DC32        last_control_mode
   \   00000338   ........           DC32        first_entry_circle
   \   0000033C   ........           DC32        position + 8
   \   00000340   ........           DC32        position + 16
    244               }//end if(READY_30HZ==1)
    245               
    246            }//end for(;;) ,end mainloop
    247          
    248          }//end all

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     heli_mod:
   \   00000000                      DS8 1
   \   00000001                      DS8 3
   \                     theta:
   \   00000004                      DS8 24
   \   0000001C                      DS8 8
   \                     round_count:
   \   00000024                      DS8 4
   \                     first_receive_target:
   \   00000028                      DS8 4
   \                     manual_to_hover:
   \   0000002C                      DS8 4
   \                     target_command:
   \   00000030                      DS8 196
   \                     target_queue:
   \   000000F4                      DS8 644

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     position:
   \   00000000                      DS8 200

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     trajectory:
   \   00000000                      DS8 312

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for angle_offset>`:
   \   00000000   000000000000       DC32 0H, 40080000H, 0H, 3FF00000H, 0H, 0H
   \              084000000000
   \              0000F03F0000
   \              000000000000
    249          

   Maximum stack usage in bytes:

     Function CSTACK
     -------- ------
     main()      28


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     angle_offset                     24
     main()                          836
     heli_mod                        888
     position                        200
     trajectory                      312
     ?<Initializer for angle_offset>
                                      24
      Others                         288

 
 1 100 bytes in segment CODE
    24 bytes in segment DATA_I
    24 bytes in segment DATA_ID
 1 400 bytes in segment DATA_Z
    24 bytes in segment INITTAB
 
   836 bytes of CODE  memory (+ 288 bytes shared)
    24 bytes of CONST memory
 1 424 bytes of DATA  memory

Errors: none
Warnings: none
