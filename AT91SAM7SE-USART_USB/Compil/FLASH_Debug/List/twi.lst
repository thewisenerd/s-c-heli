##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.31A/W32 EVALUATION    07/Jan/2016  21:50:34 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\twi\twi.c                                   #
#    Command line    =  H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\twi\twi.c -lC H:\สตั้สานคื๗2015-8-20\2014-1 #
#                       0-1สตั้สา\2015-6-27ห๘ฮฒ\ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ #
#                       ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2014_7_31\AT91SAM7SE-USART_USB #
#                       \Compil\FLASH_Debug\List\ -o                         #
#                       H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Obj #
#                       \ -z9 --debug --cpu_mode thumb --endian little       #
#                       --cpu ARM7TDMI --stack_align 4 --interwork -e --fpu  #
#                       None --ec++ --dlib_config                            #
#                       D:\IAREWE431\ARM\LIB\dl4tptinl8n.h -I                #
#                       H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\srcIAR\ -I      #
#                       H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\src\ -I      #
#                       H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\ -I       #
#                       H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\kalman\   #
#                       -I H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห #
#                       ๘ฮฒ\ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\pcm\   #
#                       -I H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห #
#                       ๘ฮฒ\ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\spi\   #
#                       -I H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห #
#                       ๘ฮฒ\ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\timer\ #
#                        -I H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27 #
#                       ห๘ฮฒ\ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+L #
#                       QR_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\pid\  #
#                       -I H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห #
#                       ๘ฮฒ\ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQ #
#                       R_2014_7_31\AT91SAM7SE-USART_USB\Compil\..\..\avcs\  #
#                       -I D:\IAREWE431\ARM\INC\                             #
#    List file       =  H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Lis #
#                       t\twi.lst                                            #
#    Object file     =  H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ #
#                       \ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2 #
#                       014_7_31\AT91SAM7SE-USART_USB\Compil\FLASH_Debug\Obj #
#                       \twi.r79                                             #
#                                                                            #
#                                                                            #
##############################################################################

H:\สตั้สานคื๗2015-8-20\2014-10-1สตั้สา\2015-6-27ห๘ฮฒ\ะกึฑษป๚ด๚ย๋ฒโสิ1-6\ะกึฑษป๚ด๚ย๋ฒโสิ\ยทพถนๆปฎ+LQR_2014_7_31\twi\twi.c
      1          #include  <includs.h>

   \                                 In segment CODE, align 4, keep-with-next
   \   __??Code16?? __code __interwork __atpcs double pow(double, int)
   \                     ??pow:
   \   00000000   FFB5               PUSH        {R0-R7,LR}
   \   00000002   041C               MOV         R4,R0
   \   00000004   0D1C               MOV         R5,R1
   \   00000006   161C               MOV         R6,R2
   \   00000008   171C               MOV         R7,R2
   \   0000000A   00D5               BPL         ??pow_1
   \   0000000C   7F42               NEG         R7,R7
   \                     ??pow_1:
   \   0000000E   6A46               MOV         R2,SP
   \   00000010   0020               MOV         R0,#+0
   \   00000012   1749               LDR         R1,??pow_2         ;; 0x3ff00000
   \   00000014   03C2               STMIA       R2!,{R0,R1}
   \   00000016   07E0               B           ??pow_3
   \                     ??pow_4:
   \   00000018   221C               MOV         R2,R4
   \   0000001A   2B1C               MOV         R3,R5
   \   0000001C   201C               MOV         R0,R4
   \   0000001E   291C               MOV         R1,R5
   \   00000020   ........           _BLF        __dMul,??__dMul??rT
   \   00000024   041C               MOV         R4,R0
   \   00000026   0D1C               MOV         R5,R1
   \                     ??pow_3:
   \   00000028   F807               LSL         R0,R7,#+31
   \   0000002A   09D5               BPL         ??pow_5
   \   0000002C   6A46               MOV         R2,SP
   \   0000002E   04B4               PUSH        {R2}
   \   00000030   01A8               ADD         R0,SP,#+4
   \   00000032   03C8               LDMIA       R0!,{R0,R1}
   \   00000034   221C               MOV         R2,R4
   \   00000036   2B1C               MOV         R3,R5
   \   00000038   ........           _BLF        __dMul,??__dMul??rT
   \   0000003C   04BC               POP         {R2}
   \   0000003E   03C2               STMIA       R2!,{R0,R1}
   \                     ??pow_5:
   \   00000040   7F08               LSR         R7,R7,#+1
   \   00000042   E9D1               BNE         ??pow_4
   \   00000044   002E               CMP         R6,#+0
   \   00000046   08D5               BPL         ??pow_6
   \   00000048   02AE               ADD         R6,SP,#+8
   \   0000004A   0020               MOV         R0,#+0
   \   0000004C   0849               LDR         R1,??pow_2         ;; 0x3ff00000
   \   0000004E   6A46               MOV         R2,SP
   \   00000050   0CCA               LDMIA       R2!,{R2,R3}
   \   00000052   ........           _BLF        __dDiv,??__dDiv??rT
   \   00000056   03C6               STMIA       R6!,{R0,R1}
   \   00000058   03E0               B           ??pow_7
   \                     ??pow_6:
   \   0000005A   02AA               ADD         R2,SP,#+8
   \   0000005C   6846               MOV         R0,SP
   \   0000005E   03C8               LDMIA       R0!,{R0,R1}
   \   00000060   03C2               STMIA       R2!,{R0,R1}
   \                     ??pow_7:
   \   00000062   02A8               ADD         R0,SP,#+8
   \   00000064   03C8               LDMIA       R0!,{R0,R1}
   \   00000066   04B0               ADD         SP,#+16
   \   00000068   F0BC               POP         {R4-R7}
   \   0000006A   04BC               POP         {R2}
   \   0000006C   1047               BX          R2                 ;; return
   \   0000006E   C046               NOP         
   \                     ??pow_2:
   \   00000070   0000F03F           DC32        0x3ff00000
      2          
      3          /*----------------------------------------------------------------------------
      4          Function: AT91F_SetTwiClock (int TwiClock)
      5          Arguments: - <TwiClock> TWI bus clock in Hertz
      6          Comments : TO DO:
      7          
      8          Return Value: none
      9          -----------------------------------------------------------------------------*/

   \                                 In segment CODE, align 4, keep-with-next
     10          void AT91F_SetTwiClock(int TwiClock)
     11          {
   \                     ??AT91F_SetTwiClock:
   \   00000000   F0B5               PUSH        {R4-R7,LR}
   \   00000002   051C               MOV         R5,R0
     12            int cldiv,ckdiv=1 ;
   \   00000004   0124               MOV         R4,#+1
   \   00000006   00E0               B           ??AT91F_SetTwiClock_1
     13          
     14            /* CLDIV = ((Tlow x 2^CKDIV) -4) x Tmck */
     15            /* CHDIV = ((THigh x 2^CKDIV) -4) x Tmck */
     16            /* Only CLDIV is computed since CLDIV = CHDIV (50% duty cycle) */
     17          
     18            while ( ( cldiv = ( (AT91B_MCK/(2*TwiClock))-4 ) / pow(2.0,ckdiv)) > 255 )
     19             ckdiv++ ;
   \                     ??AT91F_SetTwiClock_2:
   \   00000008   641C               ADD         R4,R4,#+1
   \                     ??AT91F_SetTwiClock_1:
   \   0000000A   221C               MOV         R2,R4
   \   0000000C   0020               MOV         R0,#+0
   \   0000000E   8021               MOV         R1,#+128
   \   00000010   C905               LSL         R1,R1,#+23         ;; #+1073741824
   \   00000012   ........           _BLF        ??pow,??pow??rT
   \   00000016   061C               MOV         R6,R0
   \   00000018   0F1C               MOV         R7,R1
   \   0000001A   0D48               LDR         R0,??AT91F_SetTwiClock_3  ;; 0x3921000
   \   0000001C   6900               LSL         R1,R5,#+1
   \   0000001E   ........           _BLF        ??div32_t,??rT??div32_t
   \   00000022   081F               SUB         R0,R1,#+4
   \   00000024   ........           _BLF        __longToDouble,??__longToDouble??rT
   \   00000028   321C               MOV         R2,R6
   \   0000002A   3B1C               MOV         R3,R7
   \   0000002C   ........           _BLF        __dDiv,??__dDiv??rT
   \   00000030   ........           _BLF        __doubleToLong,??__doubleToLong??rT
   \   00000034   8021               MOV         R1,#+128
   \   00000036   4900               LSL         R1,R1,#+1          ;; #+256
   \   00000038   8842               CMP         R0,R1
   \   0000003A   E5DA               BGE         ??AT91F_SetTwiClock_2
     20          
     21            AT91C_BASE_TWI->TWI_CWGR =(ckdiv<<16)|((unsigned int)cldiv << 8)|(unsigned int)cldiv  ;
   \   0000003C   0549               LDR         R1,??AT91F_SetTwiClock_3+0x4  ;; 0xfffb8010
   \   0000003E   2204               LSL         R2,R4,#+16
   \   00000040   0302               LSL         R3,R0,#+8
   \   00000042   1343               ORR         R3,R2
   \   00000044   1843               ORR         R0,R3
   \   00000046   0860               STR         R0,[R1, #+0]
     22          }
   \   00000048   F0BC               POP         {R4-R7}
   \   0000004A   01BC               POP         {R0}
   \   0000004C   0047               BX          R0                 ;; return
   \   0000004E   C046               NOP         
   \                     ??AT91F_SetTwiClock_3:
   \   00000050   00109203           DC32        0x3921000
   \   00000054   1080FBFF           DC32        0xfffb8010
     23          
     24          
     25          
     26          /*----------------------------------------------------------------------------
     27          Function : AT91F_TWI_ProbeDevices
     28          Arguments: 
     29                     <SlaveAddr>: Address of the slave device to probe.
     30          
     31          Comments : Write a single data into a slave device to see if it is connected on
     32                     the bus.
     33          
     34          Return Value: AT91C_TWI_NACK_MASTER if so, SlaveAddress otherwise.
     35          -----------------------------------------------------------------------------*/

   \                                 In segment CODE, align 4, keep-with-next
     36          int AT91F_TWI_ProbeDevices(int SlaveAddr)
     37          {
   \                     ??AT91F_TWI_ProbeDevices:
   \   00000000   011C               MOV         R1,R0
     38              unsigned int end = 0, status, Return;
     39          
     40              /* Enable Master Mode */
     41              AT91C_BASE_TWI->TWI_CR = AT91C_TWI_MSEN|AT91C_TWI_SVDIS ;
   \   00000002   ....               LDR         R0,??DataTable1    ;; 0xfffb8000
   \   00000004   2422               MOV         R2,#+36
   \   00000006   0260               STR         R2,[R0, #+0]
     42          
     43              /* Set the TWI Master Mode Register */
     44              AT91C_BASE_TWI->TWI_MMR =  SlaveAddr & ~AT91C_TWI_MREAD;
   \   00000008   0A48               LDR         R0,??AT91F_TWI_ProbeDevices_1  ;; 0xfffb8004
   \   0000000A   0B4A               LDR         R2,??AT91F_TWI_ProbeDevices_1+0x4  ;; 0xffffefff
   \   0000000C   0A40               AND         R2,R1
   \   0000000E   0260               STR         R2,[R0, #+0]
     45          
     46              /* Write the data to send into THR. Start conditionn DADDR and R/W bit
     47                 are sent automatically */
     48              AT91C_BASE_TWI->TWI_THR = 0x55;
   \   00000010   0A48               LDR         R0,??AT91F_TWI_ProbeDevices_1+0x8  ;; 0xfffb8034
   \   00000012   5522               MOV         R2,#+85
   \   00000014   0260               STR         R2,[R0, #+0]
   \   00000016   0A4A               LDR         R2,??AT91F_TWI_ProbeDevices_1+0xC  ;; 0xfffb8020
     49          
     50              while (!end)
     51              {
     52                status = AT91C_BASE_TWI->TWI_SR;
   \                     ??AT91F_TWI_ProbeDevices_2:
   \   00000018   1368               LDR         R3,[R2, #+0]
     53                if ((status & AT91C_TWI_NACK_MASTER) == AT91C_TWI_NACK_MASTER)
   \   0000001A   8020               MOV         R0,#+128
   \   0000001C   4000               LSL         R0,R0,#+1          ;; #+256
   \   0000001E   0342               TST         R3,R0
   \   00000020   02D1               BNE         ??AT91F_TWI_ProbeDevices_3
     54                {
     55                  Return = AT91C_TWI_NACK_MASTER ;
     56                  end=1;
     57                }
     58                /*  Wait for the Transmit ready is set */
     59                else if ((status & AT91C_TWI_TXRDY_MASTER) == AT91C_TWI_TXRDY_MASTER)
   \   00000022   5807               LSL         R0,R3,#+29
   \   00000024   F8D5               BPL         ??AT91F_TWI_ProbeDevices_2
     60                {
     61                  end=1;
     62                  Return = SlaveAddr>>16;
   \   00000026   0814               ASR         R0,R1,#+16
     63                }
     64              }
     65          
     66              /* Wait for the Transmit complete is set */
     67              status = AT91C_BASE_TWI->TWI_SR;
     68              while (!(status & AT91C_TWI_TXCOMP_MASTER))
     69                status = AT91C_BASE_TWI->TWI_SR;
   \                     ??AT91F_TWI_ProbeDevices_3:
   \                     ??AT91F_TWI_ProbeDevices_4:
   \   00000028   1168               LDR         R1,[R2, #+0]
   \   0000002A   C907               LSL         R1,R1,#+31
   \   0000002C   FCD5               BPL         ??AT91F_TWI_ProbeDevices_4
     70          
     71              return (Return);
   \   0000002E   00B0               ADD         SP,#+0
   \   00000030   7047               BX          LR                 ;; return
   \   00000032   C046               NOP         
   \                     ??AT91F_TWI_ProbeDevices_1:
   \   00000034   0480FBFF           DC32        0xfffb8004
   \   00000038   FFEFFFFF           DC32        0xffffefff
   \   0000003C   3480FBFF           DC32        0xfffb8034
   \   00000040   2080FBFF           DC32        0xfffb8020
     72          }
     73          
     74          //*----------------------------------------------------------------------------
     75          //* \fn twi_init
     76          //* \brief Initializes TWI device
     77          //*----------------------------------------------------------------------------

   \                                 In segment CODE, align 4, keep-with-next
     78          void twi_init(void)
     79          {
   \                     ??twi_init:
   \   00000000   00B5               PUSH        {LR}
     80              /* Configure the PIO pins corresponding to the TWI pins */
     81              AT91F_TWI_CfgPIO ();
   \   00000002   1820               MOV         R0,#+24
   \   00000004   0C49               LDR         R1,??twi_init_1    ;; 0xfffff470
   \   00000006   0860               STR         R0,[R1, #+0]
   \   00000008   0C49               LDR         R1,??twi_init_1+0x4  ;; 0xfffff474
   \   0000000A   0022               MOV         R2,#+0
   \   0000000C   0A60               STR         R2,[R1, #+0]
   \   0000000E   0C49               LDR         R1,??twi_init_1+0x8  ;; 0xfffff404
   \   00000010   0860               STR         R0,[R1, #+0]
     82          
     83              /* Configure PMC by enabling TWI clock */
     84              AT91F_TWI_CfgPMC ();
   \   00000012   0C48               LDR         R0,??twi_init_1+0xC  ;; 0xfffffc10
   \   00000014   8021               MOV         R1,#+128
   \   00000016   8900               LSL         R1,R1,#+2          ;; #+512
   \   00000018   0160               STR         R1,[R0, #+0]
     85          
     86              /* Reset the TWI */
     87              AT91C_BASE_TWI->TWI_CR = AT91C_TWI_SWRST;
   \   0000001A   ....               LDR         R0,??DataTable1    ;; 0xfffb8000
   \   0000001C   8021               MOV         R1,#+128
   \   0000001E   0160               STR         R1,[R0, #+0]
     88          
     89              /* Configure TWI in master mode */
     90              AT91F_TWI_Configure (AT91C_BASE_TWI);
   \   00000020   094A               LDR         R2,??twi_init_1+0x10  ;; 0xfffb8028
   \   00000022   0023               MOV         R3,#+0
   \   00000024   DB43               MVN         R3,R3              ;; #-1
   \   00000026   1360               STR         R3,[R2, #+0]
   \   00000028   0160               STR         R1,[R0, #+0]
   \   0000002A   0421               MOV         R1,#+4
   \   0000002C   0160               STR         R1,[R0, #+0]
     91          
     92              /* Set TWI Clock Waveform Generator Register */
     93              AT91F_SetTwiClock(TWI_BUS_CLOCK);
   \   0000002E   0748               LDR         R0,??twi_init_1+0x14  ;; 0x61a80
   \   00000030   ........           BL          ??AT91F_SetTwiClock
     94          }
   \   00000034   01BC               POP         {R0}
   \   00000036   0047               BX          R0                 ;; return
   \                     ??twi_init_1:
   \   00000038   70F4FFFF           DC32        0xfffff470
   \   0000003C   74F4FFFF           DC32        0xfffff474
   \   00000040   04F4FFFF           DC32        0xfffff404
   \   00000044   10FCFFFF           DC32        0xfffffc10
   \   00000048   2880FBFF           DC32        0xfffb8028
   \   0000004C   801A0600           DC32        0x61a80

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable1:
   \   00000000   0080FBFF           DC32        0xfffb8000
     95          

   Maximum stack usage in bytes:

     Function                    CSTACK
     --------                    ------
     AT91F_SetTwiClock(int)         20
     AT91F_TWI_ProbeDevices(int)     4
     pow(double, int)               40
     twi_init()                      4


   Segment part sizes:

     Function/Label              Bytes
     --------------              -----
     pow(double, int)             116
     AT91F_SetTwiClock(int)        88
     AT91F_TWI_ProbeDevices(int)   68
     twi_init()                    80
     ??DataTable1                   4
      Others                       96

 
 452 bytes in segment CODE
 
 240 bytes of CODE memory (+ 212 bytes shared)

Errors: none
Warnings: none
